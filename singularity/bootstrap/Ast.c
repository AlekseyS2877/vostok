/* Generated by Vostok - Oberon-07 translator */

#include <stdbool.h>

#define O7_BOOL_UNDEFINED
#include <o7.h>

#include "Ast.h"

#define LastId_cnst 34

#define Ast_RProvider_tag V_Base_tag
extern void Ast_RProvider_undef(struct Ast_RProvider *r) {
	V_Base_undef(&r->_);
	r->get = NULL;
	r->reg = NULL;
}
#define Ast_Node_tag V_Base_tag
extern void Ast_Node_undef(struct Ast_Node *r) {
	V_Base_undef(&r->_);
	r->id = O7_INT_UNDEF;
	StringStore_String_undef(&r->comment);
	r->emptyLines = O7_INT_UNDEF;
	r->ext = NULL;
}
#define Ast_Error_s_tag Ast_Node_tag
extern void Ast_Error_s_undef(struct Ast_Error_s *r) {
	Ast_Node_undef(&r->_);
	r->code = O7_INT_UNDEF;
	r->line = O7_INT_UNDEF;
	r->column = O7_INT_UNDEF;
	r->tabs = O7_INT_UNDEF;
	r->bytes = O7_INT_UNDEF;
	r->next = NULL;
}
#define Ast_RDeclaration_tag Ast_Node_tag
extern void Ast_RDeclaration_undef(struct Ast_RDeclaration *r) {
	Ast_Node_undef(&r->_);
	r->module = NULL;
	r->up = NULL;
	StringStore_String_undef(&r->name);
	r->mark = O7_BOOL_UNDEF;
	r->used = O7_BOOL_UNDEF;
	r->type = NULL;
	r->next = NULL;
}
o7_tag_t Ast_RType_tag;
extern void Ast_RType_undef(struct Ast_RType *r) {
	Ast_RDeclaration_undef(&r->_);
	r->array_ = NULL;
}
#define Ast_Byte_s_tag Ast_RType_tag
extern void Ast_Byte_s_undef(struct Ast_Byte_s *r) {
	Ast_RType_undef(&r->_);
}
o7_tag_t Ast_Const_s_tag;
extern void Ast_Const_s_undef(struct Ast_Const_s *r) {
	Ast_RDeclaration_undef(&r->_);
	r->expr = NULL;
	r->finished = O7_BOOL_UNDEF;
}
o7_tag_t Ast_RConstruct_tag;
extern void Ast_RConstruct_undef(struct Ast_RConstruct *r) {
	Ast_RType_undef(&r->_);
}
o7_tag_t Ast_RArray_tag;
extern void Ast_RArray_undef(struct Ast_RArray *r) {
	Ast_RConstruct_undef(&r->_);
	r->count = NULL;
}
#define Ast_VarState_s_tag o7_base_tag
extern void Ast_VarState_s_undef(struct Ast_VarState_s *r) {
	r->inited = 0u;
	r->used = O7_BOOL_UNDEF;
	r->inCondition = O7_BOOL_UNDEF;
	r->root = NULL;
	r->if_ = NULL;
	r->else_ = NULL;
}
o7_tag_t Ast_RVar_tag;
extern void Ast_RVar_undef(struct Ast_RVar *r) {
	Ast_RDeclaration_undef(&r->_);
	r->state = NULL;
	r->checkInit = O7_BOOL_UNDEF;
}
o7_tag_t Ast_Record_s_tag;
extern void Ast_Record_s_undef(struct Ast_Record_s *r) {
	Ast_RConstruct_undef(&r->_);
	r->base = NULL;
	r->vars = NULL;
	r->pointer = NULL;
	r->needTag = O7_BOOL_UNDEF;
}
o7_tag_t Ast_RPointer_tag;
extern void Ast_RPointer_undef(struct Ast_RPointer *r) {
	Ast_RConstruct_undef(&r->_);
}
o7_tag_t Ast_FormalParam_s_tag;
extern void Ast_FormalParam_s_undef(struct Ast_FormalParam_s *r) {
	Ast_RVar_undef(&r->_);
	r->access = 0u;
	r->needTag = NULL;
	r->link = NULL;
}
#define Ast_RNeedTagList_tag V_Base_tag
extern void Ast_RNeedTagList_undef(struct Ast_RNeedTagList *r) {
	V_Base_undef(&r->_);
	r->value_ = O7_BOOL_UNDEF;
	r->count = O7_INT_UNDEF;
	r->first = NULL;
	r->last = NULL;
}
o7_tag_t Ast_RProcType_tag;
extern void Ast_RProcType_undef(struct Ast_RProcType *r) {
	Ast_RConstruct_undef(&r->_);
	r->params = NULL;
	r->end = NULL;
}

typedef struct FormalProcType_s {
	Ast_RProcType _;
} *FormalProcType;
static o7_tag_t FormalProcType_s_tag;

static void FormalProcType_s_undef(struct FormalProcType_s *r) {
	Ast_RProcType_undef(&r->_);
}
#define Ast_RDeclarations_tag Ast_RDeclaration_tag
extern void Ast_RDeclarations_undef(struct Ast_RDeclarations *r) {
	Ast_RDeclaration_undef(&r->_);
	r->start = NULL;
	r->end = NULL;
	r->consts = NULL;
	r->types = NULL;
	r->vars = NULL;
	r->procedures = NULL;
	r->recordForwardCount = O7_INT_UNDEF;
	r->stats = NULL;
}
o7_tag_t Ast_Import_s_tag;
extern void Ast_Import_s_undef(struct Ast_Import_s *r) {
	Ast_RDeclaration_undef(&r->_);
}
o7_tag_t Ast_RModule_tag;
extern void Ast_RModule_undef(struct Ast_RModule *r) {
	Ast_RDeclarations_undef(&r->_);
	StringStore_Store_undef(&r->store);
	r->provider = NULL;
	r->script = O7_BOOL_UNDEF;
	r->errorHide = O7_BOOL_UNDEF;
	r->handleImport = O7_BOOL_UNDEF;
	r->import_ = NULL;
	r->fixed = O7_BOOL_UNDEF;
	r->spec = O7_BOOL_UNDEF;
	r->errors = NULL;
	r->errLast = NULL;
}
o7_tag_t Ast_RGeneralProcedure_tag;
extern void Ast_RGeneralProcedure_undef(struct Ast_RGeneralProcedure *r) {
	Ast_RDeclarations_undef(&r->_);
	r->header = NULL;
	r->return_ = NULL;
}
o7_tag_t Ast_RProcedure_tag;
extern void Ast_RProcedure_undef(struct Ast_RProcedure *r) {
	Ast_RGeneralProcedure_undef(&r->_);
	r->deep = O7_INT_UNDEF;
}
o7_tag_t Ast_PredefinedProcedure_s_tag;
extern void Ast_PredefinedProcedure_s_undef(struct Ast_PredefinedProcedure_s *r) {
	Ast_RGeneralProcedure_undef(&r->_);
}
#define Ast_RExpression_tag Ast_Node_tag
extern void Ast_RExpression_undef(struct Ast_RExpression *r) {
	Ast_Node_undef(&r->_);
	r->type = NULL;
	r->value_ = NULL;
}
#define Ast_RSelector_tag Ast_Node_tag
extern void Ast_RSelector_undef(struct Ast_RSelector *r) {
	Ast_Node_undef(&r->_);
	r->type = NULL;
	r->next = NULL;
}
o7_tag_t Ast_SelPointer_s_tag;
extern void Ast_SelPointer_s_undef(struct Ast_SelPointer_s *r) {
	Ast_RSelector_undef(&r->_);
}
o7_tag_t Ast_SelGuard_s_tag;
extern void Ast_SelGuard_s_undef(struct Ast_SelGuard_s *r) {
	Ast_RSelector_undef(&r->_);
}
o7_tag_t Ast_SelArray_s_tag;
extern void Ast_SelArray_s_undef(struct Ast_SelArray_s *r) {
	Ast_RSelector_undef(&r->_);
	r->index = NULL;
}
o7_tag_t Ast_SelRecord_s_tag;
extern void Ast_SelRecord_s_undef(struct Ast_SelRecord_s *r) {
	Ast_RSelector_undef(&r->_);
	r->var_ = NULL;
}
o7_tag_t Ast_RFactor_tag;
extern void Ast_RFactor_undef(struct Ast_RFactor *r) {
	Ast_RExpression_undef(&r->_);
}
o7_tag_t Ast_Designator_s_tag;
extern void Ast_Designator_s_undef(struct Ast_Designator_s *r) {
	Ast_RFactor_undef(&r->_);
	r->decl = NULL;
	r->inited = 0u;
	r->sel = NULL;
}
#define Ast_ExprNumber_tag Ast_RFactor_tag
extern void Ast_ExprNumber_undef(struct Ast_ExprNumber *r) {
	Ast_RFactor_undef(&r->_);
}
o7_tag_t Ast_RExprInteger_tag;
extern void Ast_RExprInteger_undef(struct Ast_RExprInteger *r) {
	Ast_ExprNumber_undef(&r->_);
	r->int_ = O7_INT_UNDEF;
}
o7_tag_t Ast_ExprReal_s_tag;
extern void Ast_ExprReal_s_undef(struct Ast_ExprReal_s *r) {
	Ast_ExprNumber_undef(&r->_);
	r->real = O7_DBL_UNDEF;
	StringStore_String_undef(&r->str);
}
o7_tag_t Ast_ExprBoolean_s_tag;
extern void Ast_ExprBoolean_s_undef(struct Ast_ExprBoolean_s *r) {
	Ast_RFactor_undef(&r->_);
	r->bool_ = O7_BOOL_UNDEF;
}
o7_tag_t Ast_ExprString_s_tag;
extern void Ast_ExprString_s_undef(struct Ast_ExprString_s *r) {
	Ast_RExprInteger_undef(&r->_);
	StringStore_String_undef(&r->string);
	r->asChar = O7_BOOL_UNDEF;
}
#define Ast_ExprNil_s_tag Ast_RFactor_tag
extern void Ast_ExprNil_s_undef(struct Ast_ExprNil_s *r) {
	Ast_RFactor_undef(&r->_);
}
o7_tag_t Ast_ExprSet_s_tag;
extern void Ast_ExprSet_s_undef(struct Ast_ExprSet_s *r) {
	Ast_RFactor_undef(&r->_);
	memset(&r->set, 0, sizeof(r->set));
	memset(&r->exprs, 0, sizeof(r->exprs));
	r->next = NULL;
}
o7_tag_t Ast_ExprNegate_s_tag;
extern void Ast_ExprNegate_s_undef(struct Ast_ExprNegate_s *r) {
	Ast_RFactor_undef(&r->_);
	r->expr = NULL;
}
o7_tag_t Ast_ExprBraces_s_tag;
extern void Ast_ExprBraces_s_undef(struct Ast_ExprBraces_s *r) {
	Ast_RFactor_undef(&r->_);
	r->expr = NULL;
}
o7_tag_t Ast_ExprRelation_s_tag;
extern void Ast_ExprRelation_s_undef(struct Ast_ExprRelation_s *r) {
	Ast_RExpression_undef(&r->_);
	r->relation = O7_INT_UNDEF;
	r->distance = O7_INT_UNDEF;
	memset(&r->exprs, 0, sizeof(r->exprs));
}
o7_tag_t Ast_ExprIsExtension_s_tag;
extern void Ast_ExprIsExtension_s_undef(struct Ast_ExprIsExtension_s *r) {
	Ast_RExpression_undef(&r->_);
	r->designator = NULL;
	r->extType = NULL;
}
o7_tag_t Ast_ExprSum_s_tag;
extern void Ast_ExprSum_s_undef(struct Ast_ExprSum_s *r) {
	Ast_RExpression_undef(&r->_);
	r->add = O7_INT_UNDEF;
	r->term = NULL;
	r->next = NULL;
}
o7_tag_t Ast_ExprTerm_s_tag;
extern void Ast_ExprTerm_s_undef(struct Ast_ExprTerm_s *r) {
	Ast_RExpression_undef(&r->_);
	r->factor = NULL;
	r->mult = O7_INT_UNDEF;
	r->expr = NULL;
}
#define Ast_Parameter_s_tag Ast_Node_tag
extern void Ast_Parameter_s_undef(struct Ast_Parameter_s *r) {
	Ast_Node_undef(&r->_);
	r->expr = NULL;
	r->next = NULL;
	r->distance = O7_INT_UNDEF;
}
o7_tag_t Ast_ExprCall_s_tag;
extern void Ast_ExprCall_s_undef(struct Ast_ExprCall_s *r) {
	Ast_RFactor_undef(&r->_);
	r->designator = NULL;
	r->params = NULL;
}
#define Ast_RStatement_tag Ast_Node_tag
extern void Ast_RStatement_undef(struct Ast_RStatement *r) {
	Ast_Node_undef(&r->_);
	r->expr = NULL;
	r->next = NULL;
}
o7_tag_t Ast_RWhileIf_tag;
extern void Ast_RWhileIf_undef(struct Ast_RWhileIf *r) {
	Ast_RStatement_undef(&r->_);
	r->stats = NULL;
	r->elsif = NULL;
}
o7_tag_t Ast_If_s_tag;
extern void Ast_If_s_undef(struct Ast_If_s *r) {
	Ast_RWhileIf_undef(&r->_);
}
#define Ast_CaseLabel_s_tag Ast_Node_tag
extern void Ast_CaseLabel_s_undef(struct Ast_CaseLabel_s *r) {
	Ast_Node_undef(&r->_);
	r->value_ = O7_INT_UNDEF;
	r->qual = NULL;
	r->right = NULL;
	r->next = NULL;
}
#define Ast_CaseElement_s_tag Ast_Node_tag
extern void Ast_CaseElement_s_undef(struct Ast_CaseElement_s *r) {
	Ast_Node_undef(&r->_);
	r->labels = NULL;
	r->stats = NULL;
	r->next = NULL;
}
o7_tag_t Ast_Case_s_tag;
extern void Ast_Case_s_undef(struct Ast_Case_s *r) {
	Ast_RStatement_undef(&r->_);
	r->elements = NULL;
	r->else_ = NULL;
}
o7_tag_t Ast_Repeat_s_tag;
extern void Ast_Repeat_s_undef(struct Ast_Repeat_s *r) {
	Ast_RStatement_undef(&r->_);
	r->stats = NULL;
}
o7_tag_t Ast_For_s_tag;
extern void Ast_For_s_undef(struct Ast_For_s *r) {
	Ast_RStatement_undef(&r->_);
	r->to = NULL;
	r->var_ = NULL;
	r->by = O7_INT_UNDEF;
	r->stats = NULL;
}
#define Ast_While_s_tag Ast_RWhileIf_tag
extern void Ast_While_s_undef(struct Ast_While_s *r) {
	Ast_RWhileIf_undef(&r->_);
}
o7_tag_t Ast_Assign_s_tag;
extern void Ast_Assign_s_undef(struct Ast_Assign_s *r) {
	Ast_RStatement_undef(&r->_);
	r->designator = NULL;
	r->distance = O7_INT_UNDEF;
}
o7_tag_t Ast_Call_s_tag;
extern void Ast_Call_s_undef(struct Ast_Call_s *r) {
	Ast_RStatement_undef(&r->_);
}
#define Ast_StatementError_s_tag Ast_RStatement_tag
extern void Ast_StatementError_s_undef(struct Ast_StatementError_s *r) {
	Ast_RStatement_undef(&r->_);
}

static struct Ast_RType *types[Ast_PredefinedTypesCount_cnst];
static struct Ast_RDeclaration *predefined[Scanner_PredefinedLast_cnst - Scanner_PredefinedFirst_cnst + 1];
static struct Ast_ExprBoolean_s *booleans[2];
static struct Ast_ExprNil_s *nil = NULL;

extern void Ast_PutChars(struct Ast_RModule *m, struct StringStore_String *w, int s_len0, o7_char s[/*len0*/], int begin, int end) {
	if (begin >= 0) {
		StringStore_Put(&O7_REF(m)->store, &(*w), s_len0, s, begin, end);
	} else {
		StringStore_Put(&O7_REF(m)->store, &(*w), 6, (o7_char *)"#error", 0, 5);
	}
}

static void NodeInit(struct Ast_Node *n, int id) {
	O7_ASSERT((Ast_NoId_cnst <= id) && (id <= LastId_cnst) || (Scanner_PredefinedFirst_cnst <= id) && (id <= Scanner_PredefinedLast_cnst));
	V_Init(&(*n)._);
	(*n).id = id;
	(*n).emptyLines = 0;
	StringStore_Undef(&(*n).comment);
	(*n).ext = NULL;
}

extern void Ast_NodeSetComment(struct Ast_Node *n, struct Ast_RModule *m, int com_len0, o7_char com[/*len0*/], int ofs, int end) {
	O7_ASSERT(!StringStore_IsDefined(&(*n).comment));
	Ast_PutChars(m, &(*n).comment, com_len0, com, ofs, end);
}

extern void Ast_DeclSetComment(struct Ast_RDeclaration *d, int com_len0, o7_char com[/*len0*/], int ofs, int end) {
	Ast_NodeSetComment(&(*O7_REF(d))._, O7_REF(d)->module, com_len0, com, ofs, end);
}

extern void Ast_ModuleSetComment(struct Ast_RModule *m, int com_len0, o7_char com[/*len0*/], int ofs, int end) {
	Ast_NodeSetComment(&(*O7_REF(m))._._._, m, com_len0, com, ofs, end);
}

static void DeclInit(struct Ast_RDeclaration *d, struct Ast_RDeclarations *ds) {
	if (ds == NULL) {
		O7_REF(d)->module = NULL;
	} else if ((O7_REF(ds)->_.module == NULL) && (o7_is(ds, Ast_RModule_tag))) {
		O7_REF(d)->module = O7_GUARD(Ast_RModule, &ds);
	} else {
		O7_REF(d)->module = O7_REF(ds)->_.module;
	}
	O7_REF(d)->up = ds;
	O7_REF(d)->mark = false;
	O7_REF(d)->used = false;
	StringStore_Undef(&O7_REF(d)->name);
	O7_REF(d)->type = NULL;
	O7_REF(d)->next = NULL;
}

static void DeclConnect(struct Ast_RDeclaration *d, struct Ast_RDeclarations *ds, int name_len0, o7_char name[/*len0*/], int start, int end) {
	O7_ASSERT(d != NULL);
	O7_ASSERT(name[0] != 0x00u);
	O7_ASSERT(!(o7_is(d, Ast_RModule_tag)));
	O7_ASSERT((O7_REF(ds)->start == NULL) || !(o7_is(O7_REF(ds)->start, Ast_RModule_tag)));
	DeclInit(d, ds);
	if (O7_REF(ds)->end != NULL) {
		O7_ASSERT(O7_REF(O7_REF(ds)->end)->next == NULL);
		O7_REF(O7_REF(ds)->end)->next = d;
	} else {
		O7_ASSERT(O7_REF(ds)->start == NULL);
		O7_REF(ds)->start = d;
	}
	O7_ASSERT(!(o7_is(O7_REF(ds)->start, Ast_RModule_tag)));
	O7_REF(ds)->end = d;
	if (start >= 0) {
		Ast_PutChars(O7_REF(d)->module, &O7_REF(d)->name, name_len0, name, start, end);
	} else {
		Ast_PutChars(O7_REF(d)->module, &O7_REF(d)->name, 7, (o7_char *)"#ERROR ", 0, 5);
	}
}

static void DeclarationsInit(struct Ast_RDeclarations *d, struct Ast_RDeclarations *up) {
	DeclInit(&d->_, NULL);
	O7_REF(d)->_.up = NULL;
	O7_REF(d)->start = NULL;
	O7_REF(d)->end = NULL;

	O7_REF(d)->consts = NULL;
	O7_REF(d)->types = NULL;
	O7_REF(d)->vars = NULL;
	O7_REF(d)->procedures = NULL;
	O7_REF(d)->_.up = up;
	O7_REF(d)->stats = NULL;

	O7_REF(d)->recordForwardCount = 0;
}

static void DeclarationsConnect(struct Ast_RDeclarations *d, struct Ast_RDeclarations *up, int name_len0, o7_char name[/*len0*/], int start, int end) {
	DeclarationsInit(d, up);
	if (name[0] != 0x00u) {
		DeclConnect(&d->_, up, name_len0, name, start, end);
	} else {
		DeclInit(&d->_, up);
	}
	O7_REF(d)->_.up = up;
}

extern struct Ast_RModule *Ast_ModuleNew(int name_len0, o7_char name[/*len0*/], int begin, int end, struct Ast_RProvider *p) {
	struct Ast_RModule *m;

	O7_NEW(&m, Ast_RModule);
	NodeInit(&(*O7_REF(m))._._._, Ast_NoId_cnst);
	DeclarationsInit(&m->_, NULL);
	O7_REF(m)->fixed = false;
	O7_REF(m)->spec = false;
	O7_REF(m)->import_ = NULL;
	O7_REF(m)->errors = NULL;
	O7_REF(m)->errLast = NULL;
	StringStore_StoreInit(&O7_REF(m)->store);

	Ast_PutChars(m, &O7_REF(m)->_._.name, name_len0, name, begin, end);
	O7_REF(m)->_._.module = m;
	O7_REF(m)->provider = p;
	O7_REF(m)->errorHide = true;
	O7_REF(m)->handleImport = false;
	O7_REF(m)->script = false;
	Log_Str(7, (o7_char *)"Module ");
	Log_Str(StringStore_BlockSize_cnst + 1, O7_REF(O7_REF(m)->_._.name.block)->s);
	Log_StrLn(1, (o7_char *)"\x20");
	return m;
}

extern struct Ast_RModule *Ast_ScriptNew(struct Ast_RProvider *p) {
	struct Ast_RModule *m;

	m = Ast_ModuleNew(8, (o7_char *)"script  ", 0, 6, p);
	O7_REF(m)->script = true;
	return m;
}

extern struct Ast_RModule *Ast_GetModuleByName(struct Ast_RModule *host, int name_len0, o7_char name[/*len0*/], int ofs, int end) {
	return O7_REF(O7_REF(host)->provider)->get(O7_REF(host)->provider, host, name_len0, name, ofs, end);
}

extern o7_bool Ast_RegModule(struct Ast_RProvider *provider, struct Ast_RModule *m) {
	return O7_REF(provider)->reg(provider, m);
}

static int CheckUnusedDeclarations(struct Ast_RDeclarations *ds) {
	struct Ast_RDeclaration *d;
	int err, i;
	o7_char str[256];
	memset(&str, 0, sizeof(str));

	d = O7_REF(ds)->start;
	while ((d != NULL) && (o7_is(d, Ast_Import_s_tag))) {
		d = O7_REF(d)->next;
	}
	while ((d != NULL) && (o7_bl(O7_REF(d)->mark) || o7_bl(O7_REF(d)->used) || (o7_is(d, Ast_RVar_tag)) && (0 != (((1u << Ast_InitedValue_cnst) | (1u << Ast_InitedNil_cnst)) & O7_REF(O7_GUARD(Ast_RVar, &d)->state)->inited)))) {
		d = O7_REF(d)->next;
	}
	if (d == NULL) {
		err = Ast_ErrNo_cnst;
	} else {
		i = 0;
		O7_ASSERT(StringStore_CopyToChars(256, str, &i, &O7_REF(d)->name));
		Out_String(256, str);
		Out_Ln();

		err = Ast_ErrDeclarationUnused_cnst;
	}
	return err;
}

extern int Ast_ModuleEnd(struct Ast_RModule *m) {
	O7_ASSERT(!o7_bl(O7_REF(m)->fixed));
	O7_REF(m)->fixed = true;
	return CheckUnusedDeclarations(&m->_);
}

extern void Ast_ImportHandle(struct Ast_RModule *m) {
	O7_ASSERT(!o7_bl(O7_REF(m)->handleImport));
	O7_REF(m)->handleImport = true;
}

extern void Ast_ImportEnd(struct Ast_RModule *m) {
	O7_ASSERT(o7_bl(O7_REF(m)->handleImport));
	O7_REF(m)->handleImport = false;
}

static int ImportAdd_Load(struct Ast_RModule **res, struct Ast_RModule *host, int buf_len0, o7_char buf[/*len0*/], int realOfs, int realEnd) {
	o7_char n[TranslatorLimits_LenName_cnst];
	int l, err;
	memset(&n, 0, sizeof(n));

	l = 0;
	O7_ASSERT(StringStore_CopyChars(TranslatorLimits_LenName_cnst, n, &l, buf_len0, buf, realOfs, realEnd));
	Log_Str(14, (o7_char *)"Модуль '");
	Log_Str(TranslatorLimits_LenName_cnst, n);
	Log_StrLn(24, (o7_char *)"' загружается");
	(*res) = Ast_GetModuleByName(host, buf_len0, buf, realOfs, realEnd);
	if ((*res) == NULL) {
		(*res) = Ast_ModuleNew(buf_len0, buf, realOfs, realEnd, O7_REF(host)->provider);
		err = Ast_ErrImportModuleNotFound_cnst;
	} else if (O7_REF((*res))->errors != NULL) {
		err = Ast_ErrImportModuleWithError_cnst;
	} else if (o7_bl(O7_REF((*res))->handleImport)) {
		err = Ast_ErrImportLoop_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	Log_Str(29, (o7_char *)"Модуль получен: ");
	Log_Int((int)((*res) != NULL));
	Log_Ln();
	return err;
}

static o7_bool ImportAdd_IsDup(struct Ast_Import_s *i, int buf_len0, o7_char buf[/*len0*/], int nameOfs, int nameEnd, int realOfs, int realEnd) {
	return StringStore_IsEqualToChars(&O7_REF(i)->_.name, buf_len0, buf, nameOfs, nameEnd) || (realOfs != nameOfs) && ((o7_cmp(O7_REF(i)->_.name.ofs, O7_REF(O7_REF(i)->_.module)->_._.name.ofs) != 0) || (O7_REF(i)->_.name.block != O7_REF(O7_REF(i)->_.module)->_._.name.block)) && StringStore_IsEqualToChars(&O7_REF(O7_REF(i)->_.module)->_._.name, buf_len0, buf, realOfs, realEnd);
}

extern int Ast_ImportAdd(struct Ast_RModule *m, int buf_len0, o7_char buf[/*len0*/], int nameOfs, int nameEnd, int realOfs, int realEnd) {
	struct Ast_Import_s *imp;
	struct Ast_RDeclaration *i;
	int err;

	O7_ASSERT(!o7_bl(O7_REF(m)->fixed));

	i = (&(O7_REF(m)->import_)->_);
	O7_ASSERT((i == NULL) || (o7_is(O7_REF(m)->_.end, Ast_Import_s_tag)));
	if (StringStore_IsEqualToChars(&O7_REF(m)->_._.name, buf_len0, buf, realOfs, realEnd)) {
		err = Ast_ErrImportSelf_cnst;
	} else {
		while ((i != NULL) && !ImportAdd_IsDup(O7_GUARD(Ast_Import_s, &i), buf_len0, buf, nameOfs, nameEnd, realOfs, realEnd)) {
			i = O7_REF(i)->next;
		}
		if (i != NULL) {
			err = Ast_ErrImportNameDuplicate_cnst;
		} else {
			O7_NEW(&imp, Ast_Import_s);
			NodeInit(&(*O7_REF(imp))._._, Ast_IdImport_cnst);
			DeclConnect(&imp->_, &m->_, buf_len0, buf, nameOfs, nameEnd);
			O7_REF(imp)->_.mark = true;
			if (O7_REF(m)->import_ == NULL) {
				O7_REF(m)->import_ = imp;
			}
			err = ImportAdd_Load(&O7_REF(imp)->_.module, m, buf_len0, buf, realOfs, realEnd);
		}
	}
	return err;
}

static struct Ast_RDeclaration *SearchName(struct Ast_RDeclaration *d, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	if (begin < 0) {
		d = NULL;
	} else {
		while ((d != NULL) && !StringStore_IsEqualToChars(&O7_REF(d)->name, buf_len0, buf, begin, end)) {
			O7_ASSERT(!(o7_is(d, Ast_RModule_tag)));
			d = O7_REF(d)->next;
		}
	}
	if ((d != NULL) && false) {
		Log_Str(36, (o7_char *)"Найдено объявление ");
		while (begin != end) {
			Log_Char(buf[o7_ind(buf_len0, begin)]);
			begin = o7_mod((o7_add(begin, 1)), (o7_sub(buf_len0, 1)));
		}
		Log_Str(6, (o7_char *)" id = ");
		Log_Int(O7_REF(d)->_.id);
		Log_Ln();
	}
	return d;
}

static struct Ast_RDeclaration *DeclarationLineSearch(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;

	d = SearchName(O7_REF(ds)->start, buf_len0, buf, begin, end);
	if ((d == NULL) && (o7_is(ds, Ast_RProcedure_tag))) {
		d = SearchName(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._, buf_len0, buf, begin, end);
	}
	return d;
}

static int CheckNameDuplicate(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	int err;

	if (begin < 0) {
		err = Ast_ErrNo_cnst;
	} else if (DeclarationLineSearch(ds, buf_len0, buf, begin, end) != NULL) {
		err = Ast_ErrDeclarationNameDuplicate_cnst;
	} else if (o7_bl(O7_REF(O7_REF(ds)->_.module)->errorHide) && (O7_REF(ds)->_.up != NULL) && (DeclarationLineSearch(&O7_REF(ds)->_.module->_, buf_len0, buf, begin, end) != NULL)) {
		err = Ast_ErrDeclarationNameHide_cnst;
	} else if (o7_bl(O7_REF(O7_REF(ds)->_.module)->errorHide) && (Scanner_Ident_cnst != Scanner_CheckPredefined(buf_len0, buf, begin, end))) {
		err = Ast_ErrPredefinedNameHide_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_ConstAdd(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_Const_s *c;
	int err;

	O7_ASSERT(!o7_bl(O7_REF(O7_REF(ds)->_.module)->fixed));

	O7_NEW(&c, Ast_Const_s);
	NodeInit(&(*O7_REF(c))._._, Ast_IdConst_cnst);
	err = CheckNameDuplicate(ds, buf_len0, buf, begin, end);
	DeclConnect(&c->_, ds, buf_len0, buf, begin, end);
	O7_REF(c)->expr = NULL;
	O7_REF(c)->finished = false;
	if (O7_REF(ds)->consts == NULL) {
		O7_REF(ds)->consts = c;
	}
	return err;
}

extern int Ast_ConstSetExpression(struct Ast_Const_s *const_, struct Ast_RExpression *expr) {
	int err;

	O7_REF(const_)->finished = true;
	err = Ast_ErrNo_cnst;
	if (expr != NULL) {
		O7_REF(const_)->expr = expr;
		O7_REF(const_)->_.type = O7_REF(expr)->type;
		if ((O7_REF(expr)->type != NULL) && (O7_REF(expr)->value_ == NULL)) {
			err = Ast_ErrConstDeclExprNotConst_cnst;
		}
	}
	return err;
}

static void TypeAdd_MoveForwardDeclToLast(struct Ast_RDeclarations *ds, struct Ast_Record_s *rec) {
	O7_ASSERT(O7_REF(O7_REF(rec)->pointer)->_._._.next == &rec->_._._);
	if (O7_REF(rec)->_._._.next != NULL) {
		O7_REF(O7_REF(rec)->pointer)->_._._.next = O7_REF(rec)->_._._.next;
		O7_REF(rec)->_._._.next = NULL;

		O7_REF(O7_REF(ds)->end)->next = (&(rec)->_._._);
		O7_REF(ds)->end = (&(rec)->_._._);
	}
	O7_REF(ds)->recordForwardCount = o7_sub(O7_REF(ds)->recordForwardCount, 1);
	O7_ASSERT(o7_cmp(O7_REF(ds)->recordForwardCount, 0) >= 0);
}

extern int Ast_TypeAdd(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end, struct Ast_RType **td) {
	struct Ast_RDeclaration *d;
	int err;

	O7_ASSERT(!o7_bl(O7_REF(O7_REF(ds)->_.module)->fixed));

	d = DeclarationLineSearch(ds, buf_len0, buf, begin, end);
	if (((d == NULL) || (o7_cmp(O7_REF(d)->_.id, Ast_IdRecordForward_cnst) == 0)) || (d == NULL) && ((O7_REF(ds)->_.up == NULL) || (DeclarationLineSearch(&O7_REF(ds)->_.module->_, buf_len0, buf, begin, end) == NULL))) {
		if (Scanner_Ident_cnst == Scanner_CheckPredefined(buf_len0, buf, begin, end)) {
			err = Ast_ErrNo_cnst;
		} else {
			err = Ast_ErrPredefinedNameHide_cnst;
		}
	} else if (d == NULL) {
		err = Ast_ErrDeclarationNameHide_cnst;
	} else {
		err = Ast_ErrDeclarationNameDuplicate_cnst;
	}
	if ((d == NULL) || (err == Ast_ErrDeclarationNameDuplicate_cnst)) {
		O7_ASSERT((*td) != NULL);
		DeclConnect(&(*td)->_, ds, buf_len0, buf, begin, end);
		if (O7_REF(ds)->types == NULL) {
			O7_REF(ds)->types = (*td);
		}
	} else {
		(*td) = O7_GUARD(Ast_RType, &d);
		TypeAdd_MoveForwardDeclToLast(ds, O7_GUARD(Ast_Record_s, &d));
	}
	return err;
}

extern int Ast_CheckUndefRecordForward(struct Ast_RDeclarations *ds) {
	int err;

	if (o7_cmp(O7_REF(ds)->recordForwardCount, 0) == 0) {
		err = Ast_ErrNo_cnst;
	} else {
		err = Ast_ErrRecordForwardUndefined_cnst;
		O7_REF(ds)->recordForwardCount = 0;
	}
	return err;
}

static void VarStateInit(struct Ast_VarState_s *vs, struct Ast_VarState_s *root) {
	O7_ASSERT(O7_REF(root)->else_ == NULL);

	O7_REF(vs)->used = false;
	O7_REF(vs)->inited = O7_REF(root)->inited;
	O7_REF(vs)->inCondition = O7_REF(root)->inited != (1u << Ast_InitedValue_cnst);
	O7_REF(vs)->root = root;
	if (O7_REF(root)->if_ == NULL) {
		O7_REF(root)->if_ = vs;
	} else {
		O7_REF(root)->else_ = vs;
	}
}

static void VarStateRootInit(struct Ast_VarState_s *vs) {
	O7_REF(vs)->inited = (1u << Ast_InitedNo_cnst);
	O7_REF(vs)->used = false;
	O7_REF(vs)->inCondition = false;
	O7_REF(vs)->if_ = NULL;
	O7_REF(vs)->else_ = NULL;
	O7_REF(vs)->root = NULL;
}

static struct Ast_VarState_s *VarStateNew(struct Ast_VarState_s *root) {
	struct Ast_VarState_s *vs;

	O7_NEW(&vs, Ast_VarState_s);
	VarStateInit(vs, root);
	return vs;
}

static void VarStateUp(struct Ast_VarState_s **vs) {
	Log_StrLn(10, (o7_char *)"VarStateUp");
	O7_ASSERT((O7_REF(O7_REF((*vs))->root)->if_ == (*vs)) || (O7_REF(O7_REF((*vs))->root)->else_ == (*vs)));

	(*vs) = O7_REF((*vs))->root;
	if (O7_REF((*vs))->else_ != NULL) {
		if (!!( (1u << Ast_InitedFail_cnst) & O7_REF(O7_REF((*vs))->else_)->inited)) {
			O7_REF((*vs))->inited = O7_REF(O7_REF((*vs))->if_)->inited;
		} else {
			O7_REF((*vs))->inited = O7_REF(O7_REF((*vs))->if_)->inited | O7_REF(O7_REF((*vs))->else_)->inited;
		}
		O7_REF((*vs))->else_ = NULL;
	} else {
		O7_REF((*vs))->inited = O7_REF((*vs))->inited | O7_REF(O7_REF((*vs))->if_)->inited;
	}
	O7_REF((*vs))->if_ = NULL;
}

static void TurnIf_Handle(struct Ast_RDeclaration *d) {
	struct Ast_RVar *v;
	struct Ast_VarState_s *vs;

	while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		v = O7_GUARD(Ast_RVar, &d);
		O7_ASSERT(O7_REF(O7_REF(v)->state)->if_ == NULL);
		vs = VarStateNew(O7_REF(v)->state);
		O7_ASSERT(O7_REF(O7_REF(v)->state)->if_ == vs);
		O7_REF(v)->state = vs;
		d = O7_REF(d)->next;
	}
}

extern void Ast_TurnIf(struct Ast_RDeclarations *ds) {
	Log_StrLn(6, (o7_char *)"TurnIf");

	if (o7_is(ds, Ast_RProcedure_tag)) {
		TurnIf_Handle(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._);
		TurnIf_Handle(&O7_REF(ds)->vars->_);
	}
}

static void TurnElse_Handle(struct Ast_RDeclaration *d) {
	struct Ast_RVar *v;
	struct Ast_VarState_s *vs;

	while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		v = O7_GUARD(Ast_RVar, &d);
		O7_ASSERT(O7_REF(O7_REF(O7_REF(v)->state)->root)->if_ == O7_REF(v)->state);
		vs = VarStateNew(O7_REF(O7_REF(v)->state)->root);
		Log_Int(o7_sti(O7_REF(vs)->inited));
		O7_ASSERT(O7_REF(O7_REF(O7_REF(v)->state)->root)->else_ == vs);
		O7_ASSERT(O7_REF(O7_REF(O7_REF(v)->state)->root)->if_ == O7_REF(v)->state);
		O7_REF(v)->state = vs;
		d = O7_REF(d)->next;
	}
}

extern void Ast_TurnElse(struct Ast_RDeclarations *ds) {
	Log_StrLn(10, (o7_char *)"TurnElse: ");

	if (o7_is(ds, Ast_RProcedure_tag)) {
		TurnElse_Handle(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._);
		TurnElse_Handle(&O7_REF(ds)->vars->_);
	}
}

static void TurnFail_Handle(struct Ast_RDeclaration *d) {
	while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		O7_REF(O7_GUARD(Ast_RVar, &d)->state)->inited |= 1u << Ast_InitedFail_cnst;
		d = O7_REF(d)->next;
	}
}

extern void Ast_TurnFail(struct Ast_RDeclarations *ds) {
	Log_StrLn(8, (o7_char *)"TurnFail");
	if (o7_is(ds, Ast_RProcedure_tag)) {
		TurnFail_Handle(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._);
		TurnFail_Handle(&O7_REF(ds)->vars->_);
	}
}

static void BackFromBranch_Handle(struct Ast_RDeclaration *d) {
	while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		VarStateUp(&O7_GUARD(Ast_RVar, &d)->state);
		d = O7_REF(d)->next;
	}
}

extern void Ast_BackFromBranch(struct Ast_RDeclarations *ds) {
	Log_StrLn(14, (o7_char *)"BackFromBranch");
	if (o7_is(ds, Ast_RProcedure_tag)) {
		BackFromBranch_Handle(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._);
		BackFromBranch_Handle(&O7_REF(ds)->vars->_);
	}
}

static void ChecklessVarAdd(struct Ast_RVar **v, struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	O7_NEW(&(*v), Ast_RVar);
	NodeInit(&(*O7_REF((*v)))._._, Ast_IdVar_cnst);
	DeclConnect(&(*v)->_, ds, buf_len0, buf, begin, end);
	O7_REF((*v))->_.type = NULL;

	O7_NEW(&O7_REF((*v))->state, Ast_VarState_s);
	VarStateRootInit(O7_REF((*v))->state);
	O7_REF((*v))->checkInit = false;

	if (O7_REF(ds)->vars == NULL) {
		O7_REF(ds)->vars = (*v);
	}
}

extern int Ast_VarAdd(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_RVar *v;
	int err;

	O7_ASSERT((O7_REF(ds)->_.module == NULL) || !o7_bl(O7_REF(O7_REF(ds)->_.module)->fixed));
	err = CheckNameDuplicate(ds, buf_len0, buf, begin, end);
	ChecklessVarAdd(&v, ds, buf_len0, buf, begin, end);
	return err;
}

static void TInit(struct Ast_RType *t, int id) {
	NodeInit(&(*O7_REF(t))._._, id);
	DeclInit(&t->_, NULL);
	O7_REF(t)->array_ = NULL;
}

extern struct Ast_RProcType *Ast_ProcTypeNew(o7_bool forType) {
	struct Ast_RProcType *p;
	struct FormalProcType_s *fp;

	if (forType) {
		O7_NEW(&fp, FormalProcType_s);
		p = (&(fp)->_);
	} else {
		O7_NEW(&p, Ast_RProcType);
	}
	TInit(&p->_._, Ast_IdProcType_cnst);
	O7_REF(p)->params = NULL;
	O7_REF(p)->end = NULL;
	return p;
}

static void ParamAddPredefined(struct Ast_RProcType *proc, struct Ast_RType *type, unsigned access) {
	struct Ast_FormalParam_s *v;

	O7_NEW(&v, Ast_FormalParam_s);
	NodeInit(&(*O7_REF(v))._._._, Ast_NoId_cnst);
	if (O7_REF(proc)->end == NULL) {
		O7_REF(proc)->params = v;
	} else {
		O7_REF(O7_REF(proc)->end)->_._.next = (&(v)->_._);
	}
	O7_REF(proc)->end = v;

	O7_REF(v)->_._.module = NULL;
	O7_REF(v)->_._.up = NULL;

	O7_REF(v)->_._.mark = false;
	O7_REF(v)->_._.next = NULL;
	O7_REF(v)->link = NULL;

	O7_REF(v)->_._.type = type;
	if (access == 0) {
		O7_REF(v)->access = (1u << Ast_ParamIn_cnst);
	} else {
		O7_REF(v)->access = access;
	}
	O7_REF(v)->needTag = NULL;

	O7_NEW(&O7_REF(v)->_.state, Ast_VarState_s);
	VarStateRootInit(O7_REF(v)->_.state);
	O7_REF(v)->_.checkInit = false;
	if (!!( (1u << Ast_ParamIn_cnst) & O7_REF(v)->access)) {
		O7_REF(O7_REF(v)->_.state)->inited = (1u << Ast_InitedValue_cnst);
	} else {
		O7_REF(O7_REF(v)->_.state)->inited = (1u << Ast_InitedNo_cnst);
	}
}

extern int Ast_ParamAdd(struct Ast_RModule *module, struct Ast_RProcType *proc, int buf_len0, o7_char buf[/*len0*/], int begin, int end, unsigned access) {
	int err;

	if (SearchName(&O7_REF(proc)->params->_._, buf_len0, buf, begin, end) != NULL) {
		err = Ast_ErrDeclarationNameDuplicate_cnst;
	} else if (!(o7_is(proc, FormalProcType_s_tag)) && (DeclarationLineSearch(&module->_, buf_len0, buf, begin, end) != NULL)) {
		err = Ast_ErrDeclarationNameHide_cnst;
	} else if (o7_bl(O7_REF(module)->errorHide) && (Scanner_Ident_cnst != Scanner_CheckPredefined(buf_len0, buf, begin, end))) {
		err = Ast_ErrPredefinedNameHide_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	ParamAddPredefined(proc, NULL, access);
	Ast_PutChars(module, &O7_REF(O7_REF(proc)->end)->_._.name, buf_len0, buf, begin, end);
	return err;
}

extern o7_bool Ast_IsNeedTag(struct Ast_FormalParam_s *p) {
	return (O7_REF(p)->needTag != NULL) && (O7_REF(O7_REF(p)->needTag)->value_);
}

static void NewNeedTag(struct Ast_FormalParam_s *p, o7_bool need) {
	o7_char n[256];
	int i;
	memset(&n, 0, sizeof(n));

	O7_ASSERT(O7_REF(p)->needTag == NULL);
	O7_ASSERT(O7_REF(p)->link == NULL);

	Log_Str(11, (o7_char *)"NewNeedTag ");
	i = 0;
	O7_ASSERT(StringStore_CopyToChars(256, n, &i, &O7_REF(p)->_._.name));
	Log_Str(256, n);
	Log_Str(3, (o7_char *)" = ");
	Log_Bool(need);
	Log_Ln();

	O7_NEW(&O7_REF(p)->needTag, Ast_RNeedTagList);
	O7_REF(O7_REF(p)->needTag)->count = 1;
	O7_REF(O7_REF(p)->needTag)->first = p;
	O7_REF(O7_REF(p)->needTag)->last = p;

	O7_REF(O7_REF(p)->needTag)->value_ = need;
}

static void SetNeedTag(struct Ast_FormalParam_s *p) {
	o7_char n[256];
	int i;
	memset(&n, 0, sizeof(n));

	Log_Str(11, (o7_char *)"SetNeedTag ");
	i = 0;
	O7_ASSERT(StringStore_CopyToChars(256, n, &i, &O7_REF(p)->_._.name));
	Log_Str(256, n);
	Log_Str(1, (o7_char *)"\x3A");
	i = 0;
	O7_ASSERT(StringStore_CopyToChars(256, n, &i, &O7_REF(O7_REF(p)->_._.type)->_.name));
	Log_Str(256, n);
	Log_Ln();
	if (O7_REF(p)->needTag == NULL) {
		NewNeedTag(p, true);
	} else {
		O7_REF(O7_REF(p)->needTag)->value_ = true;
	}
}

static void ExchangeParamsNeedTag(struct Ast_FormalParam_s *p1, struct Ast_FormalParam_s *p2);
static void ExchangeParamsNeedTag_Merge(struct Ast_RNeedTagList *list, struct Ast_RNeedTagList *del) {
	O7_ASSERT(list != del);
	O7_ASSERT(O7_REF(O7_REF(list)->last)->link == NULL);
	O7_ASSERT(O7_REF(del)->last != NULL);

	if (o7_bl(O7_REF(del)->value_)) {
		O7_REF(list)->value_ = true;
	}
	O7_REF(list)->count = o7_add(O7_REF(list)->count, O7_REF(del)->count);
	O7_REF(O7_REF(list)->last)->link = O7_REF(del)->first;
	O7_REF(list)->last = O7_REF(del)->last;
	O7_ASSERT(O7_REF(O7_REF(list)->last)->link == NULL);
	O7_REF(del)->last = NULL;
	while (O7_REF(del)->first != NULL) {
		O7_REF(O7_REF(del)->first)->needTag = list;
		O7_REF(del)->last = O7_REF(O7_REF(del)->first)->link;
		O7_REF(del)->first = O7_REF(del)->last;
	}
	O7_ASSERT(O7_REF(list)->last != NULL);
}

static void ExchangeParamsNeedTag_Add(struct Ast_RNeedTagList *list, struct Ast_FormalParam_s *p) {
	O7_ASSERT(O7_REF(p)->link == NULL);
	O7_ASSERT(O7_REF(p)->needTag == NULL);

	O7_REF(O7_REF(list)->last)->link = p;
	O7_REF(list)->last = p;
	O7_ASSERT(O7_REF(list)->last != NULL);
	O7_REF(p)->needTag = list;
}

static void ExchangeParamsNeedTag(struct Ast_FormalParam_s *p1, struct Ast_FormalParam_s *p2) {
	if (p1 == p2) {
	} else if (O7_REF(p1)->needTag == NULL) {
		if (O7_REF(p2)->needTag == NULL) {
			NewNeedTag(p2, false);
		}
		ExchangeParamsNeedTag_Add(O7_REF(p2)->needTag, p1);
	} else {
		if (O7_REF(p2)->needTag == NULL) {
			ExchangeParamsNeedTag_Add(O7_REF(p1)->needTag, p2);
		} else if (o7_cmp(O7_REF(O7_REF(p2)->needTag)->count, O7_REF(O7_REF(p1)->needTag)->count) > 0) {
			ExchangeParamsNeedTag_Merge(O7_REF(p2)->needTag, O7_REF(p1)->needTag);
		} else if (O7_REF(p1)->needTag != O7_REF(p2)->needTag) {
			ExchangeParamsNeedTag_Merge(O7_REF(p1)->needTag, O7_REF(p2)->needTag);
		}
	}
}

extern int Ast_ProcTypeSetReturn(struct Ast_RProcType *proc, struct Ast_RType *type) {
	int err;

	O7_REF(proc)->_._._.type = type;
	if (!(o7_in(O7_REF(type)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdRecord_cnst))))) {
		err = Ast_ErrNo_cnst;
	} else {
		err = Ast_ErrReturnTypeArrayOrRecord_cnst;
	}
	return err;
}

extern void Ast_AddError(struct Ast_RModule *m, int error, int line, int column, int tabs) {
	struct Ast_Error_s *e;

	O7_NEW(&e, Ast_Error_s);
	NodeInit(&(*O7_REF(e))._, Ast_NoId_cnst);
	O7_REF(e)->next = NULL;
	O7_REF(e)->code = error;
	O7_REF(e)->line = line;
	O7_REF(e)->column = column;
	O7_REF(e)->tabs = tabs;
	if (O7_REF(m)->errLast == NULL) {
		O7_REF(m)->errors = e;
	} else {
		O7_REF(O7_REF(m)->errLast)->next = e;
	}
	O7_REF(m)->errLast = e;
}

extern struct Ast_RType *Ast_TypeGet(int id) {
	O7_ASSERT(types[o7_ind(Ast_PredefinedTypesCount_cnst, id)] != NULL);
	return types[o7_ind(Ast_PredefinedTypesCount_cnst, id)];
}

extern struct Ast_RArray *Ast_ArrayGet(struct Ast_RType *t, struct Ast_RExpression *count) {
	struct Ast_RArray *a;

	if ((count != NULL) || (t == NULL) || (O7_REF(t)->array_ == NULL)) {
		O7_NEW(&a, Ast_RArray);
		TInit(&a->_._, Ast_IdArray_cnst);
		O7_REF(a)->count = count;
		if ((t != NULL) && (count == NULL)) {
			O7_REF(t)->array_ = a;
		}
		O7_REF(a)->_._._.type = t;
	} else {
		a = O7_REF(t)->array_;
	}
	return a;
}

extern int Ast_MultArrayLenByExpr(int *size, struct Ast_RExpression *e) {
	int i, err;

	err = Ast_ErrNo_cnst;
	if ((e != NULL) && (O7_REF(e)->value_ != NULL) && (o7_is(O7_REF(e)->value_, Ast_RExprInteger_tag))) {
		i = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(e)->value_)->int_);
		if (i <= 0) {
			err = Ast_ErrArrayLenLess1_cnst;
			i = 1;
		} else {
			Log_Str(10, (o7_char *)"Array Len ");
			Log_Int(i);
			Log_Ln();
		}
	} else {
		i = 1;
		if (e != NULL) {
			err = Ast_ErrExpectConstIntExpr_cnst;
		}
	}
	if (!Arithmetic_Mul(&(*size), (*size), i)) {
		(*size) = 0;
		err = Ast_ErrArrayLenTooBig_cnst;
	}
	return err;
}

extern struct Ast_RPointer *Ast_PointerGet(struct Ast_Record_s *t) {
	struct Ast_RPointer *p;

	if ((t == NULL) || (O7_REF(t)->pointer == NULL)) {
		O7_NEW(&p, Ast_RPointer);
		TInit(&p->_._, Ast_IdPointer_cnst);
		O7_REF(p)->_._._.type = (&(t)->_._);
		if (t != NULL) {
			O7_REF(t)->pointer = p;
		}
	} else {
		p = O7_REF(t)->pointer;
	}
	return p;
}

extern void Ast_PointerSetRecord(struct Ast_RPointer *tp, struct Ast_Record_s *subtype) {
	O7_REF(tp)->_._._.type = (&(subtype)->_._);
	O7_REF(subtype)->pointer = tp;
}

extern int Ast_PointerSetType(struct Ast_RPointer *tp, struct Ast_RType *subtype) {
	int err;

	if (o7_in(O7_REF(subtype)->_._.id, ((1u << Ast_IdRecord_cnst) | (1u << Ast_IdRecordForward_cnst)))) {
		Ast_PointerSetRecord(tp, O7_GUARD(Ast_Record_s, &subtype));
		err = Ast_ErrNo_cnst;
	} else {
		O7_REF(tp)->_._._.type = subtype;
		err = Ast_ErrPointerToNotRecord_cnst;
	}
	return err;
}

extern void Ast_RecordSetBase(struct Ast_Record_s *r, struct Ast_Record_s *base) {
	O7_ASSERT(O7_REF(r)->base == NULL);
	O7_ASSERT(O7_REF(r)->vars == NULL);
	O7_REF(r)->base = base;
}

static void RecNew(struct Ast_Record_s **r) {
	O7_NEW(&(*r), Ast_Record_s);
	TInit(&(*r)->_._, Ast_IdRecordForward_cnst);
	O7_REF((*r))->pointer = NULL;
	O7_REF((*r))->vars = NULL;
	O7_REF((*r))->base = NULL;
	O7_REF((*r))->needTag = false;
}

extern struct Ast_Record_s *Ast_RecordNew(struct Ast_RDeclarations *ds, struct Ast_Record_s *base) {
	struct Ast_Record_s *r;

	RecNew(&r);
	Ast_RecordSetBase(r, base);
	return r;
}

extern struct Ast_Record_s *Ast_RecordForwardNew(struct Ast_RDeclarations *ds, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	struct Ast_Record_s *r;

	RecNew(&r);
	DeclConnect(&r->_._._, ds, name_len0, name, begin, end);
	O7_REF(ds)->recordForwardCount = o7_add(O7_REF(ds)->recordForwardCount, 1);
	return r;
}

extern int Ast_RecordEnd(struct Ast_Record_s *r) {
	O7_ASSERT(o7_cmp(O7_REF(r)->_._._._.id, Ast_IdRecordForward_cnst) == 0);
	O7_REF(r)->_._._._.id = Ast_IdRecord_cnst;
	O7_REF(r)->_._._.used = true;
	return Ast_ErrNo_cnst;
}

static struct Ast_RDeclaration *SearchPredefined(int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;
	int l;

	l = Scanner_CheckPredefined(buf_len0, buf, begin, end);
	Log_Str(17, (o7_char *)"SearchPredefined ");
	Log_Int(l);
	Log_Ln();
	if ((Scanner_PredefinedFirst_cnst <= l) && (l <= Scanner_PredefinedLast_cnst)) {
		d = predefined[o7_ind(Scanner_PredefinedLast_cnst - Scanner_PredefinedFirst_cnst + 1, o7_sub(l, Scanner_PredefinedFirst_cnst))];
		O7_ASSERT(d != NULL);
	} else {
		d = NULL;
	}
	return d;
}

extern struct Ast_RDeclaration *Ast_DeclarationSearch(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;

	if (o7_is(ds, Ast_RProcedure_tag)) {
		d = SearchName(&O7_REF(O7_GUARD(Ast_RProcedure, &ds)->_.header)->params->_._, buf_len0, buf, begin, end);
	} else {
		d = NULL;
	}
	if (d == NULL) {
		d = SearchName(O7_REF(ds)->start, buf_len0, buf, begin, end);
		if (o7_is(ds, Ast_RProcedure_tag)) {
			if (d == NULL) {
				do {
					ds = O7_REF(ds)->_.up;
				} while (!((ds == NULL) || (o7_is(ds, Ast_RModule_tag))));
				if (ds != NULL) {
					d = SearchName(O7_REF(ds)->start, buf_len0, buf, begin, end);
				}
			}
		} else {
			while ((d == NULL) && (O7_REF(ds)->_.up != NULL)) {
				ds = O7_REF(ds)->_.up;
				d = SearchName(O7_REF(ds)->start, buf_len0, buf, begin, end);
			}
		}
		if ((d == NULL) && (o7_is(ds, Ast_RModule_tag)) && !o7_bl(O7_GUARD(Ast_RModule, &ds)->fixed)) {
			d = SearchPredefined(buf_len0, buf, begin, end);
		}
	}
	if ((d != NULL) && (o7_is(d, Ast_RType_tag))) {
		O7_REF(d)->used = true;
		if (o7_is(d, Ast_RVar_tag)) {
			O7_REF(O7_GUARD(Ast_RVar, &d)->state)->used = true;
		}
	}
	return d;
}

extern struct Ast_RType *Ast_TypeErrorNew(void) {
	struct Ast_RType *type;

	O7_NEW(&type, Ast_RType);
	NodeInit(&(*O7_REF(type))._._, Ast_IdError_cnst);
	DeclInit(&type->_, NULL);
	return type;
}

extern struct Ast_RDeclaration *Ast_DeclErrorNew(struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;

	O7_NEW(&d, Ast_RDeclaration);
	NodeInit(&(*O7_REF(d))._, Ast_IdError_cnst);
	DeclConnect(d, ds, buf_len0, buf, begin, end);
	O7_REF(d)->type = Ast_TypeErrorNew();
	return d;
}

extern int Ast_DeclarationGet(struct Ast_RDeclaration **d, struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	int err;

	(*d) = Ast_DeclarationSearch(ds, buf_len0, buf, begin, end);
	if ((*d) == NULL) {
		if ((O7_REF(ds)->_.module != NULL) && o7_bl(O7_REF(O7_REF(ds)->_.module)->script)) {
			err = Ast_ImportAdd(O7_REF(ds)->_.module, buf_len0, buf, begin, end, begin, end);
			(*d) = O7_REF(ds)->end;
		} else {
			err = Ast_ErrNo_cnst;
		}
		if ((*d) == NULL) {
			err = Ast_ErrDeclarationNotFound_cnst;
			(*d) = Ast_DeclErrorNew(ds, buf_len0, buf, begin, end);
			O7_ASSERT(O7_REF((*d))->type != NULL);
		}
	} else if (!o7_bl(O7_REF((*d))->mark) && (O7_REF((*d))->module != NULL) && o7_bl(O7_REF(O7_REF((*d))->module)->fixed)) {
		err = Ast_ErrDeclarationIsPrivate_cnst;
	} else if ((o7_is((*d), Ast_Const_s_tag)) && !o7_bl(O7_GUARD(Ast_Const_s, &(*d))->finished)) {
		err = Ast_ErrConstRecursive_cnst;
		O7_GUARD(Ast_Const_s, &(*d))->finished = true;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_VarGet(struct Ast_RVar **v, struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	int err;
	struct Ast_RDeclaration *d;

	d = Ast_DeclarationSearch(ds, buf_len0, buf, begin, end);
	if (d == NULL) {
		err = Ast_ErrDeclarationNotFound_cnst;
	} else if (o7_cmp(O7_REF(d)->_.id, Ast_IdVar_cnst) != 0) {
		err = Ast_ErrDeclarationNotVar_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	if (err == Ast_ErrNo_cnst) {
		(*v) = O7_GUARD(Ast_RVar, &d);
		if (!o7_bl(O7_REF(d)->mark) && o7_bl(O7_REF(O7_REF(d)->module)->fixed)) {
			err = Ast_ErrDeclarationIsPrivate_cnst;
		}
	} else {
		ChecklessVarAdd(&(*v), ds, buf_len0, buf, begin, end);
	}
	return err;
}

extern int Ast_ForIteratorGet(struct Ast_RVar **v, struct Ast_RDeclarations *ds, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	int err;

	err = Ast_VarGet(&(*v), ds, buf_len0, buf, begin, end);
	if ((*v) != NULL) {
		if (O7_REF((*v))->_.type == NULL) {
			O7_REF((*v))->_.type = Ast_TypeGet(Ast_IdInteger_cnst);
		} else if (o7_cmp(O7_REF(O7_REF((*v))->_.type)->_._.id, Ast_IdInteger_cnst) != 0) {
			err = Ast_ErrForIteratorNotInteger_cnst;
		}
	}
	return err;
}

static void ExprInit(struct Ast_RExpression *e, int id, struct Ast_RType *t) {
	NodeInit(&(*O7_REF(e))._, id);
	if (t != NULL) {
		O7_REF(t)->_.used = true;
	}
	O7_REF(e)->type = t;
	O7_REF(e)->value_ = NULL;
}

extern struct Ast_RExprInteger *Ast_ExprIntegerNew(int int_) {
	struct Ast_RExprInteger *e;

	O7_NEW(&e, Ast_RExprInteger);
	ExprInit(&e->_._._, Ast_IdInteger_cnst, Ast_TypeGet(Ast_IdInteger_cnst));
	O7_REF(e)->int_ = int_;
	O7_REF(e)->_._._.value_ = (&(e)->_._);
	return e;
}

extern struct Ast_ExprReal_s *Ast_ExprRealNew(double real, struct Ast_RModule *m, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_ExprReal_s *e;

	O7_ASSERT(m != NULL);
	O7_NEW(&e, Ast_ExprReal_s);
	ExprInit(&e->_._._, Ast_IdReal_cnst, Ast_TypeGet(Ast_IdReal_cnst));
	O7_REF(e)->real = real;
	O7_REF(e)->_._._.value_ = (&(e)->_._);
	Ast_PutChars(m, &O7_REF(e)->str, buf_len0, buf, begin, end);
	return e;
}

extern struct Ast_ExprReal_s *Ast_ExprRealNewByValue(double real) {
	struct Ast_ExprReal_s *e;

	O7_NEW(&e, Ast_ExprReal_s);
	ExprInit(&e->_._._, Ast_IdReal_cnst, Ast_TypeGet(Ast_IdReal_cnst));
	O7_REF(e)->real = real;
	O7_REF(e)->_._._.value_ = (&(e)->_._);
	StringStore_Undef(&O7_REF(e)->str);
	return e;
}

extern struct Ast_ExprBoolean_s *Ast_ExprBooleanGet(o7_bool bool_) {
	struct Ast_ExprBoolean_s *e;

	e = booleans[o7_ind(2, (int)o7_bl(bool_))];
	if (e == NULL) {
		O7_NEW(&e, Ast_ExprBoolean_s);
		ExprInit(&e->_._, Ast_IdBoolean_cnst, Ast_TypeGet(Ast_IdBoolean_cnst));
		O7_REF(e)->bool_ = bool_;
		O7_REF(e)->_._.value_ = (&(e)->_);
		booleans[o7_ind(2, (int)o7_bl(bool_))] = e;
	}
	return e;
}

extern struct Ast_ExprString_s *Ast_ExprStringNew(struct Ast_RModule *m, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	struct Ast_ExprString_s *e;
	int len;

	len = o7_sub(end, begin);
	if (len < 0) {
		len = o7_sub(o7_add(len, buf_len0), 1);
	}
	len = o7_sub(len, 2);
	O7_NEW(&e, Ast_ExprString_s);
	ExprInit(&e->_._._._, Ast_IdString_cnst, &Ast_ArrayGet(Ast_TypeGet(Ast_IdChar_cnst), &Ast_ExprIntegerNew(len)->_._._)->_._);
	O7_REF(e)->_.int_ =  - 1;
	O7_REF(e)->asChar = false;
	Ast_PutChars(m, &O7_REF(e)->string, buf_len0, buf, begin, end);
	O7_REF(e)->_._._._.value_ = (&(e)->_._._);
	return e;
}

extern struct Ast_ExprString_s *Ast_ExprCharNew(int int_) {
	struct Ast_ExprString_s *e;

	O7_NEW(&e, Ast_ExprString_s);
	ExprInit(&e->_._._._, Ast_IdString_cnst, &Ast_ArrayGet(Ast_TypeGet(Ast_IdChar_cnst), &Ast_ExprIntegerNew(1)->_._._)->_._);
	StringStore_Undef(&O7_REF(e)->string);
	O7_REF(e)->_.int_ = int_;
	O7_REF(e)->asChar = true;
	O7_REF(e)->_._._._.value_ = (&(e)->_._._);
	return e;
}

extern struct Ast_ExprNil_s *Ast_ExprNilGet(void) {
	if (nil == NULL) {
		O7_NEW(&nil, Ast_ExprNil_s);
		ExprInit(&nil->_._, Ast_IdPointer_cnst, Ast_TypeGet(Ast_IdPointer_cnst));
		O7_ASSERT(O7_REF(O7_REF(nil)->_._.type)->_.type == NULL);
		O7_REF(nil)->_._.value_ = (&(nil)->_);
	}
	return nil;
}

extern struct Ast_RExpression *Ast_ExprErrNew(void) {
	struct Ast_RFactor *e;

	O7_NEW(&e, Ast_RFactor);
	ExprInit(&e->_, Ast_IdError_cnst, Ast_TypeErrorNew());
	return (&(e)->_);
}

extern struct Ast_ExprBraces_s *Ast_ExprBracesNew(struct Ast_RExpression *expr) {
	struct Ast_ExprBraces_s *e;

	O7_NEW(&e, Ast_ExprBraces_s);
	ExprInit(&e->_._, Ast_IdBraces_cnst, O7_REF(expr)->type);
	O7_REF(e)->expr = expr;
	O7_REF(e)->_._.value_ = O7_REF(expr)->value_;
	return e;
}

extern struct Ast_ExprSet_s *Ast_ExprSetByValue(Ast_LongSet set) {
	struct Ast_ExprSet_s *e;

	O7_NEW(&e, Ast_ExprSet_s);
	ExprInit(&e->_._, Ast_IdSet_cnst, Ast_TypeGet(Ast_IdSet_cnst));
	O7_REF(e)->exprs[0] = NULL;
	O7_REF(e)->exprs[1] = NULL;
	memcpy(O7_REF(e)->set, set, (2) * sizeof(set[0]));
	O7_REF(e)->next = NULL;
	return e;
}

static o7_bool CheckSetRange(int int_) {
	return (0 <= int_) && (int_ <= TypeLimits_LongSetMax_cnst);
}

extern int Ast_ExprSetNew(struct Ast_ExprSet_s **base, struct Ast_ExprSet_s **e, struct Ast_RExpression *expr1, struct Ast_RExpression *expr2) {
	int err, left, right = O7_INT_UNDEF;

	O7_NEW(&(*e), Ast_ExprSet_s);
	ExprInit(&(*e)->_._, Ast_IdSet_cnst, Ast_TypeGet(Ast_IdSet_cnst));
	O7_REF((*e))->exprs[0] = expr1;
	O7_REF((*e))->exprs[1] = expr2;
	O7_REF((*e))->next = NULL;
	err = Ast_ErrNo_cnst;
	O7_REF((*e))->set[0] = 0;
	O7_REF((*e))->set[1] = 0;
	if ((expr1 == NULL) && (expr2 == NULL)) {
	} else if ((expr1 != NULL) && (O7_REF(expr1)->type != NULL) && ((expr2 == NULL) || (O7_REF(expr2)->type != NULL))) {
		if ((o7_cmp(O7_REF(O7_REF(expr1)->type)->_._.id, Ast_IdInteger_cnst) != 0) || (expr2 != NULL) && (o7_cmp(O7_REF(O7_REF(expr2)->type)->_._.id, Ast_IdInteger_cnst) != 0)) {
			err = Ast_ErrNotIntSetElem_cnst;
		} else if ((O7_REF(expr1)->value_ != NULL) && ((expr2 == NULL) || (O7_REF(expr2)->value_ != NULL))) {
			left = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(expr1)->value_)->int_);
			if (expr2 != NULL) {
				right = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(expr2)->value_)->int_);
			}
			if (!CheckSetRange(left) || (expr2 != NULL) && !CheckSetRange(right)) {
				err = Ast_ErrSetElemOutOfRange_cnst;
			} else if (expr2 == NULL) {
				if (left <= TypeLimits_SetMax_cnst) {
					O7_REF((*e))->set[0] = (1u << left);
					O7_REF((*e))->set[1] = 0;
				} else {
					O7_REF((*e))->set[0] = 0;
					O7_REF((*e))->set[1] = (1u << (o7_mod(left, (TypeLimits_SetMax_cnst + 1))));
				}
			} else if (o7_cmp(left, right) > 0) {
				err = Ast_ErrSetLeftElemBiggerRightElem_cnst;
			} else if (o7_cmp(right, TypeLimits_SetMax_cnst) <= 0) {
				O7_REF((*e))->set[0] = o7_set(left, right);
				O7_REF((*e))->set[1] = 0;
			} else if (left > TypeLimits_SetMax_cnst) {
				O7_REF((*e))->set[0] = 0;
				O7_REF((*e))->set[1] = o7_set(o7_mod(left, (TypeLimits_SetMax_cnst + 1)), o7_mod(right, (TypeLimits_SetMax_cnst + 1)));
			} else {
				O7_REF((*e))->set[0] = o7_set(left, TypeLimits_SetMax_cnst);
				O7_REF((*e))->set[1] = ((1u << 0) | (1u << (o7_mod(right, (TypeLimits_SetMax_cnst + 1)))));
			}
			if (err == Ast_ErrNo_cnst) {
				O7_REF((*e))->_._.value_ = (&((*e))->_);
			}
		}
	}
	if ((*base) == NULL) {
		(*base) = (*e);
	} else {
		O7_REF((*base))->set[0] = O7_REF((*base))->set[0] | O7_REF((*e))->set[0];
		O7_REF((*base))->set[1] = O7_REF((*base))->set[1] | O7_REF((*e))->set[1];
	}
	return err;
}

extern int Ast_ExprNegateNew(struct Ast_ExprNegate_s **neg, struct Ast_RExpression *expr) {
	int err;

	O7_NEW(&(*neg), Ast_ExprNegate_s);
	ExprInit(&(*neg)->_._, Ast_IdNegate_cnst, Ast_TypeGet(Ast_IdBoolean_cnst));
	O7_REF((*neg))->expr = expr;
	if ((O7_REF(expr)->type != NULL) && (o7_cmp(O7_REF(O7_REF(expr)->type)->_._.id, Ast_IdBoolean_cnst) != 0)) {
		err = Ast_ErrNegateNotBool_cnst;
	} else {
		err = Ast_ErrNo_cnst;
		if (O7_REF(expr)->value_ != NULL) {
			O7_REF((*neg))->_._.value_ = (&(Ast_ExprBooleanGet(!o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(expr)->value_)->bool_)))->_);
		}
	}
	return err;
}

extern int Ast_DesignatorNew(struct Ast_Designator_s **d, struct Ast_RDeclaration *decl) {
	O7_NEW(&(*d), Ast_Designator_s);
	ExprInit(&(*d)->_._, Ast_IdDesignator_cnst, NULL);
	O7_REF((*d))->decl = decl;
	O7_REF((*d))->sel = NULL;
	O7_REF((*d))->_._.type = O7_REF(decl)->type;
	if (o7_is(decl, Ast_RVar_tag)) {
		O7_REF((*d))->inited = O7_REF(O7_GUARD(Ast_RVar, &decl)->state)->inited;
	} else {
		O7_REF((*d))->inited = (1u << Ast_InitedValue_cnst);
		if (o7_is(decl, Ast_Const_s_tag)) {
			O7_REF((*d))->_._.value_ = O7_REF(O7_GUARD(Ast_Const_s, &decl)->expr)->value_;
		} else if (o7_is(decl, Ast_RGeneralProcedure_tag)) {
			O7_REF((*d))->_._.type = (&(O7_GUARD(Ast_RGeneralProcedure, &decl)->header)->_._);
		}
	}
	return Ast_ErrNo_cnst;
}

extern int Ast_DesignatorUsed(struct Ast_Designator_s *d, o7_bool varParam, o7_bool inLoop) {
	int err;
	struct Ast_RVar *v;

	err = Ast_ErrNo_cnst;
	if (o7_is(O7_REF(d)->decl, Ast_RVar_tag)) {
		v = O7_GUARD(Ast_RVar, &O7_REF(d)->decl);

		if ((o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(d)->sel != NULL) && (!(!!( (1u << Ast_InitedValue_cnst) & O7_REF(O7_REF(v)->state)->inited)) || !o7_bl(O7_REF(O7_REF(v)->state)->inCondition) && (0 != (O7_REF(O7_REF(v)->state)->inited & ((1u << Ast_InitedNo_cnst) | (1u << Ast_InitedNil_cnst)))))) {
			Log_Turn(true);
			Log_Int(o7_sti(O7_REF(O7_REF(v)->state)->inited));
			Log_Ln();
			Log_Turn(false);
			err = Ast_ErrVarUninitialized_cnst;
		} else if (varParam) {
			O7_REF(O7_REF(v)->state)->inited = (1u << Ast_InitedValue_cnst);
		} else if (!(!(!!( (1u << Ast_InitedNo_cnst) & O7_REF(O7_REF(v)->state)->inited)) || o7_bl(O7_REF(O7_REF(v)->state)->inCondition) && (0 != (O7_REF(O7_REF(v)->state)->inited & ~(1u << Ast_InitedNo_cnst)))) && !inLoop && ((O7_REF(v)->_.up != NULL) && (O7_REF(O7_REF(v)->_.up)->_.up != NULL) || (o7_is(v, Ast_FormalParam_s_tag)))) {
			Log_Int(o7_sti(O7_REF(O7_REF(v)->state)->inited));
			Log_Ln();
			err = o7_sub(Ast_ErrVarUninitialized_cnst, (int)(!!( (1u << Ast_InitedValue_cnst) & O7_REF(O7_REF(v)->state)->inited)));
			O7_REF(O7_REF(v)->state)->inited = (1u << Ast_InitedValue_cnst);
		} else if (!!( (1u << Ast_InitedNo_cnst) & O7_REF(O7_REF(v)->state)->inited)) {
			O7_REF(v)->checkInit = true;
		}
		O7_REF(O7_REF(v)->state)->used = true;
	}
	O7_REF(O7_REF(d)->decl)->used = true;
	return err;
}

extern int Ast_CheckInited(struct Ast_RDeclarations *ds) {
	int err;
	struct Ast_RDeclaration *d;
	o7_char name[128];
	int len;
	memset(&name, 0, sizeof(name));

	d = (&(O7_REF(ds)->vars)->_);
	while ((d != NULL) && (o7_is(d, Ast_RVar_tag)) && (!o7_bl(O7_REF(O7_GUARD(Ast_RVar, &d)->state)->used) || (!!( (1u << Ast_InitedValue_cnst) & O7_REF(O7_GUARD(Ast_RVar, &d)->state)->inited)))) {
		d = O7_REF(d)->next;
	}
	if ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		len = 0;
		if (StringStore_CopyToChars(128, name, &len, &O7_REF(d)->name)) {
			Out_String(128, name);
			Out_Ln();
		}
		err = Ast_ErrVarMayUninitialized_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern o7_bool Ast_IsRecordExtension(int *distance, struct Ast_Record_s *t0, struct Ast_Record_s *t1) {
	int dist;

	if ((t0 != NULL) && (t1 != NULL)) {
		dist = 0;
		do {
			t1 = O7_REF(t1)->base;
			dist = o7_add(dist, 1);
		} while (!((t0 == t1) || (t1 == NULL)));
		if (t0 == t1) {
			(*distance) = dist;
		}
	} else {
		t0 = NULL;
		t1 = NULL;
	}
	Log_Int((int)(t0 == t1));
	Log_Ln();
	return t0 == t1;
}

static void SelInit(struct Ast_RSelector *s) {
	NodeInit(&(*O7_REF(s))._, Ast_NoId_cnst);
	O7_REF(s)->type = NULL;
	O7_REF(s)->next = NULL;
}

extern int Ast_SelPointerNew(struct Ast_RSelector **sel, struct Ast_RType **type) {
	struct Ast_SelPointer_s *sp;
	int err;

	O7_NEW(&sp, Ast_SelPointer_s);
	SelInit(&sp->_);
	(*sel) = (&(sp)->_);
	O7_REF((*type))->_.used = true;
	if (o7_is((*type), Ast_RPointer_tag)) {
		err = Ast_ErrNo_cnst;
		(*type) = O7_REF((*type))->_.type;
		O7_REF((*sel))->type = (*type);
	} else {
		err = Ast_ErrDerefToNotPointer_cnst;
	}
	return err;
}

extern int Ast_SelArrayNew(struct Ast_RSelector **sel, struct Ast_RType **type, struct Ast_RExpression *index) {
	struct Ast_SelArray_s *sa;
	int err;

	O7_NEW(&sa, Ast_SelArray_s);
	SelInit(&sa->_);
	O7_REF(sa)->index = index;
	(*sel) = (&(sa)->_);
	if (!(o7_is((*type), Ast_RArray_tag))) {
		err = Ast_ErrArrayItemToNotArray_cnst;
	} else if (o7_cmp(O7_REF(O7_REF(index)->type)->_._.id, Ast_IdInteger_cnst) != 0) {
		err = Ast_ErrArrayIndexNotInt_cnst;
	} else if ((O7_REF(index)->value_ != NULL) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(index)->value_)->int_, 0) < 0)) {
		err = Ast_ErrArrayIndexNegative_cnst;
	} else if ((O7_REF(index)->value_ != NULL) && (O7_GUARD(Ast_RArray, &(*type))->count != NULL) && (O7_REF(O7_GUARD(Ast_RArray, &(*type))->count)->value_ != NULL) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(index)->value_)->int_, O7_GUARD(Ast_RExprInteger, &O7_REF(O7_GUARD(Ast_RArray, &(*type))->count)->value_)->int_) >= 0)) {
		err = Ast_ErrArrayIndexOutOfRange_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	Log_Str(16, (o7_char *)"SelArrayNew tid=");
	Log_Int(O7_REF((*type))->_._.id);
	Log_Str(4, (o7_char *)" -> ");
	(*type) = O7_REF((*type))->_.type;
	if ((*type) != NULL) {
		Log_Int(O7_REF((*type))->_._.id);
		Log_Ln();
	}
	O7_REF((*sel))->type = (*type);
	return err;
}

static struct Ast_RVar *RecordVarSearch(struct Ast_Record_s *r, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;
	struct Ast_RVar *v;

	d = SearchName(&O7_REF(r)->vars->_, name_len0, name, begin, end);
	while ((d == NULL) && (O7_REF(r)->base != NULL)) {
		r = O7_REF(r)->base;
		d = SearchName(&O7_REF(r)->vars->_, name_len0, name, begin, end);
	}
	if (d != NULL) {
		v = O7_GUARD(Ast_RVar, &d);
	} else {
		v = NULL;
	}
	return v;
}

static struct Ast_RVar *RecordChecklessVarAdd(struct Ast_Record_s *r, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	struct Ast_RVar *v;
	struct Ast_RDeclaration *last;

	O7_NEW(&v, Ast_RVar);
	NodeInit(&(*O7_REF(v))._._, Ast_IdVar_cnst);
	DeclInit(&v->_, NULL);
	O7_REF(v)->_.module = O7_REF(r)->_._._.module;
	Ast_PutChars(O7_REF(v)->_.module, &O7_REF(v)->_.name, name_len0, name, begin, end);
	if (O7_REF(r)->vars == NULL) {
		O7_REF(r)->vars = v;
	} else {
		last = (&(O7_REF(r)->vars)->_);
		while (O7_REF(last)->next != NULL) {
			last = O7_REF(last)->next;
		}
		O7_REF(last)->next = (&(v)->_);
	}
	return v;
}

extern int Ast_RecordVarAdd(struct Ast_RVar **v, struct Ast_Record_s *r, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	int err;

	(*v) = RecordVarSearch(r, name_len0, name, begin, end);
	if ((*v) == NULL) {
		err = Ast_ErrNo_cnst;
	} else {
		err = Ast_ErrDeclarationNameDuplicate_cnst;
	}
	(*v) = RecordChecklessVarAdd(r, name_len0, name, begin, end);
	return err;
}

extern int Ast_RecordVarGet(struct Ast_RVar **v, struct Ast_Record_s *r, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	int err;

	(*v) = RecordVarSearch(r, name_len0, name, begin, end);
	if ((*v) == NULL) {
		err = Ast_ErrDeclarationNotFound_cnst;
		(*v) = RecordChecklessVarAdd(r, name_len0, name, begin, end);
		O7_REF((*v))->_.type = Ast_TypeGet(Ast_IdInteger_cnst);
	} else if (!o7_bl(O7_REF((*v))->_.mark) && o7_bl(O7_REF(O7_REF((*v))->_.module)->fixed)) {
		err = Ast_ErrDeclarationIsPrivate_cnst;
		O7_REF((*v))->_.mark = true;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_VarListSetType(struct Ast_RDeclaration *first, struct Ast_RType *t) {
	struct Ast_RDeclaration *d;
	int err;

	d = first;
	O7_REF(t)->_.used = true;
	while (d != NULL) {
		O7_REF(d)->type = t;
		d = O7_REF(d)->next;
	}
	if (o7_cmp(O7_REF(t)->_._.id, Ast_IdRecordForward_cnst) != 0) {
		err = Ast_ErrNo_cnst;
	} else {
		err = Ast_ErrVarOfRecordForward_cnst;
	}
	return err;
}

extern int Ast_ArraySetType(struct Ast_RArray *a, struct Ast_RType *t) {
	int err;

	O7_ASSERT(O7_REF(a)->_._._.type == NULL);
	O7_REF(a)->_._._.type = t;
	if (o7_cmp(O7_REF(t)->_._.id, Ast_IdRecordForward_cnst) != 0) {
		err = Ast_ErrNo_cnst;
	} else {
		err = Ast_ErrArrayTypeOfRecordForward_cnst;
	}
	return err;
}

extern int Ast_SelRecordNew(struct Ast_RSelector **sel, struct Ast_RType **type, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	struct Ast_SelRecord_s *sr;
	int err;
	struct Ast_Record_s *record;
	struct Ast_RVar *var_;

	O7_NEW(&sr, Ast_SelRecord_s);
	SelInit(&sr->_);
	var_ = NULL;
	err = Ast_ErrNo_cnst;
	if ((*type) != NULL) {
		if (!(o7_in(O7_REF((*type))->_._.id, ((1u << Ast_IdRecord_cnst) | (1u << Ast_IdPointer_cnst))))) {
			err = Ast_ErrDotSelectorToNotRecord_cnst;
		} else {
			if (o7_cmp(O7_REF((*type))->_._.id, Ast_IdRecord_cnst) == 0) {
				record = O7_GUARD(Ast_Record_s, &(*type));
			} else if (O7_REF((*type))->_.type == NULL) {
				record = NULL;
			} else {
				record = O7_GUARD(Ast_Record_s, &O7_REF((*type))->_.type);
			}
			if (record != NULL) {
				err = Ast_RecordVarGet(&var_, record, name_len0, name, begin, end);
				if (var_ != NULL) {
					(*type) = O7_REF(var_)->_.type;
				} else {
					(*type) = NULL;
				}
			}
		}
	}
	O7_REF(sr)->var_ = var_;
	(*sel) = (&(sr)->_);
	O7_REF((*sel))->type = (*type);
	return err;
}

extern int Ast_SelGuardNew(struct Ast_RSelector **sel, struct Ast_Designator_s *des, struct Ast_RDeclaration *guard) {
	struct Ast_SelGuard_s *sg;
	int err, dist;

	O7_NEW(&sg, Ast_SelGuard_s);
	SelInit(&sg->_);
	err = Ast_ErrNo_cnst;
	if (!(o7_in(O7_REF(O7_REF(des)->_._.type)->_._.id, ((1u << Ast_IdRecord_cnst) | (1u << Ast_IdPointer_cnst))))) {
		err = Ast_ErrGuardedTypeNotExtensible_cnst;
	} else if (o7_cmp(O7_REF(O7_REF(des)->_._.type)->_._.id, Ast_IdRecord_cnst) == 0) {
		if ((guard == NULL) || !(o7_is(guard, Ast_Record_s_tag)) || !Ast_IsRecordExtension(&dist, O7_GUARD(Ast_Record_s, &O7_REF(des)->_._.type), O7_GUARD(Ast_Record_s, &guard))) {
			err = Ast_ErrGuardExpectRecordExt_cnst;
		} else {
			O7_REF(des)->_._.type = (&(O7_GUARD(Ast_Record_s, &guard))->_._);
			O7_GUARD(Ast_Record_s, &guard)->needTag = true;
			if ((O7_REF(des)->sel == NULL) && (o7_is(O7_REF(des)->decl, Ast_FormalParam_s_tag))) {
				SetNeedTag(O7_GUARD(Ast_FormalParam_s, &O7_REF(des)->decl));
			}
		}
	} else {
		if ((guard == NULL) || !(o7_is(guard, Ast_RPointer_tag)) || !Ast_IsRecordExtension(&dist, O7_GUARD(Ast_Record_s, &O7_GUARD(Ast_RPointer, &O7_REF(des)->_._.type)->_._._.type), O7_GUARD(Ast_Record_s, &O7_GUARD(Ast_RPointer, &guard)->_._._.type))) {
			err = Ast_ErrGuardExpectPointerExt_cnst;
		} else {
			O7_REF(des)->_._.type = (&(O7_GUARD(Ast_RPointer, &guard))->_._);
			O7_GUARD(Ast_Record_s, &O7_REF(guard)->type)->needTag = true;
		}
	}
	O7_REF(sg)->_.type = O7_REF(des)->_._.type;
	(*sel) = (&(sg)->_);
	return err;
}

static o7_bool CompatibleTypes_EqualProcTypes(struct Ast_RProcType *t1, struct Ast_RProcType *t2) {
	o7_bool comp;
	struct Ast_RDeclaration *fp1, *fp2;

	comp = O7_REF(t1)->_._._.type == O7_REF(t2)->_._._.type;
	if (comp) {
		fp1 = (&(O7_REF(t1)->params)->_._);
		fp2 = (&(O7_REF(t2)->params)->_._);
		while ((fp1 != NULL) && (fp2 != NULL) && (o7_is(fp1, Ast_FormalParam_s_tag)) && (o7_is(fp2, Ast_FormalParam_s_tag)) && (O7_REF(fp1)->type == O7_REF(fp2)->type) && (O7_GUARD(Ast_FormalParam_s, &fp1)->access == O7_GUARD(Ast_FormalParam_s, &fp2)->access)) {
			ExchangeParamsNeedTag(O7_GUARD(Ast_FormalParam_s, &fp1), O7_GUARD(Ast_FormalParam_s, &fp2));
			fp1 = O7_REF(fp1)->next;
			fp2 = O7_REF(fp2)->next;
		}
		comp = ((fp1 == NULL) || !(o7_is(fp1, Ast_FormalParam_s_tag))) && ((fp2 == NULL) || !(o7_is(fp2, Ast_FormalParam_s_tag)));
	}
	return comp;
}

extern o7_bool Ast_CompatibleTypes(int *distance, struct Ast_RType *t1, struct Ast_RType *t2) {
	o7_bool comp;

	(*distance) = 0;
	comp = (t1 == NULL) || (t2 == NULL);
	if (!comp) {
		comp = t1 == t2;
		Log_Str(42, (o7_char *)"Идентификаторы типов : ");
		Log_Int(O7_REF(t1)->_._.id);
		Log_Str(3, (o7_char *)" : ");
		Log_Int(O7_REF(t2)->_._.id);
		Log_Ln();
		if (comp) {
		} else if ((o7_cmp(O7_REF(t1)->_._.id, O7_REF(t2)->_._.id) == 0) && (o7_in(O7_REF(t1)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdPointer_cnst) | (1u << Ast_IdRecord_cnst) | (1u << Ast_IdProcType_cnst))))) {
			switch (O7_REF(t1)->_._.id) {
			case 10:
				comp = Ast_CompatibleTypes(&(*distance), O7_REF(t1)->_.type, O7_REF(t2)->_.type);
				break;
			case 9:
				comp = (O7_REF(t1)->_.type == O7_REF(t2)->_.type) || (O7_REF(t1)->_.type == NULL) || (O7_REF(t2)->_.type == NULL) || Ast_IsRecordExtension(&(*distance), O7_GUARD(Ast_Record_s, &O7_REF(t1)->_.type), O7_GUARD(Ast_Record_s, &O7_REF(t2)->_.type));
				break;
			case 11:
				comp = Ast_IsRecordExtension(&(*distance), O7_GUARD(Ast_Record_s, &t1), O7_GUARD(Ast_Record_s, &t2));
				break;
			case 13:
				comp = CompatibleTypes_EqualProcTypes(O7_GUARD(Ast_RProcType, &t1), O7_GUARD(Ast_RProcType, &t2));
				break;
			default:
				o7_case_fail(O7_REF(t1)->_._.id);
				break;
			}
		} else if (o7_cmp(O7_REF(t1)->_._.id, Ast_IdProcType_cnst) == 0) {
			comp = (o7_cmp(O7_REF(t2)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(t2)->_.type == NULL);
		} else if (o7_cmp(O7_REF(t2)->_._.id, Ast_IdProcType_cnst) == 0) {
			comp = (o7_cmp(O7_REF(t1)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(t1)->_.type == NULL);
		}
	}
	return comp;
}

extern int Ast_ExprIsExtensionNew(struct Ast_ExprIsExtension_s **e, struct Ast_RExpression *des, struct Ast_RType *type) {
	int err, dist;
	struct Ast_RType *desType;

	O7_NEW(&(*e), Ast_ExprIsExtension_s);
	ExprInit(&(*e)->_, Ast_IdIsExtension_cnst, Ast_TypeGet(Ast_IdBoolean_cnst));
	O7_REF((*e))->designator = NULL;
	O7_REF((*e))->extType = type;
	err = Ast_ErrNo_cnst;
	if ((type != NULL) && !(o7_in(O7_REF(type)->_._.id, ((1u << Ast_IdPointer_cnst) | (1u << Ast_IdRecord_cnst))))) {
		err = Ast_ErrIsExtTypeNotRecord_cnst;
	} else if (des == NULL) {
	} else if (o7_is(des, Ast_Designator_s_tag)) {
		O7_REF((*e))->designator = O7_GUARD(Ast_Designator_s, &des);
		desType = O7_REF(des)->type;
		if (desType == NULL) {
		} else if (!(o7_in(O7_REF(O7_REF(des)->type)->_._.id, ((1u << Ast_IdPointer_cnst) | (1u << Ast_IdRecord_cnst))))) {
			err = Ast_ErrIsExtVarNotRecord_cnst;
		} else if (o7_cmp(O7_REF(type)->_._.id, O7_REF(O7_REF(des)->type)->_._.id) != 0) {
			err = Ast_ErrIsExtMeshupPtrAndRecord_cnst;
		} else {
			if (o7_cmp(O7_REF(type)->_._.id, Ast_IdPointer_cnst) == 0) {
				type = O7_REF(type)->_.type;
				desType = O7_REF(desType)->_.type;
			} else if ((O7_REF(O7_REF((*e))->designator)->sel == NULL) && (o7_is(O7_REF(O7_REF((*e))->designator)->decl, Ast_FormalParam_s_tag))) {
				SetNeedTag(O7_GUARD(Ast_FormalParam_s, &O7_REF(O7_REF((*e))->designator)->decl));
			}
			if (Ast_IsRecordExtension(&dist, O7_GUARD(Ast_Record_s, &desType), O7_GUARD(Ast_Record_s, &type))) {
				O7_GUARD(Ast_Record_s, &type)->needTag = true;
			} else {
				err = Ast_ErrIsExtExpectRecordExt_cnst;
			}
		}
	} else {
		err = Ast_ErrIsExtVarNotRecord_cnst;
	}
	return err;
}

static o7_bool CompatibleAsCharAndString(struct Ast_RType *t1, struct Ast_RExpression **e2) {
	o7_bool ret;

	Log_Str(28, (o7_char *)"1 CompatibleAsCharAndString ");
	Log_Int((int)(O7_REF((*e2))->value_ != NULL));
	Log_Ln();
	ret = (o7_cmp(O7_REF(t1)->_._.id, Ast_IdChar_cnst) == 0) && (O7_REF((*e2))->value_ != NULL) && (o7_is(O7_REF((*e2))->value_, Ast_ExprString_s_tag)) && (o7_cmp(O7_GUARD(Ast_ExprString_s, &O7_REF((*e2))->value_)->_.int_, 0) >= 0);
	if (ret && !o7_bl(O7_GUARD(Ast_ExprString_s, &O7_REF((*e2))->value_)->asChar)) {
		if (o7_is((*e2), Ast_ExprString_s_tag)) {
			(*e2) = (&(Ast_ExprCharNew(O7_GUARD(Ast_ExprString_s, &O7_REF((*e2))->value_)->_.int_))->_._._._);
		} else {
			O7_REF((*e2))->value_ = (&(Ast_ExprCharNew(O7_GUARD(Ast_ExprString_s, &O7_REF((*e2))->value_)->_.int_))->_._._);
		}
		O7_ASSERT(o7_bl(O7_GUARD(Ast_ExprString_s, &O7_REF((*e2))->value_)->asChar));
	}
	return ret;
}

static o7_bool CompatibleAsIntAndByte(struct Ast_RType *t1, struct Ast_RType *t2) {
	return (o7_in(O7_REF(t1)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdByte_cnst)))) && (o7_in(O7_REF(t2)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdByte_cnst))));
}

static o7_bool ExprRelationNew_CheckType(struct Ast_RType *t1, struct Ast_RType *t2, struct Ast_RExpression **e1, struct Ast_RExpression **e2, int relation, int *distance, int *err) {
	o7_bool continue_;
	int dist1, dist2;

	dist1 = 0;
	dist2 = 0;
	if ((t1 == NULL) || (t2 == NULL)) {
		continue_ = false;
	} else if (relation == Scanner_In_cnst) {
		continue_ = (o7_cmp(O7_REF(t1)->_._.id, Ast_IdInteger_cnst) == 0) && (o7_in(O7_REF(t2)->_._.id, ((1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst))));
		if (!continue_) {
			(*err) = o7_add(o7_add(o7_sub(Ast_ErrExprInWrongTypes_cnst, 3), (int)(o7_cmp(O7_REF(t1)->_._.id, Ast_IdInteger_cnst) != 0)), o7_mul((int)!(o7_in(O7_REF(t2)->_._.id, ((1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst)))), 2));
		}
	} else if (!Ast_CompatibleTypes(&dist1, t1, t2) && !Ast_CompatibleTypes(&dist2, t2, t1) && !CompatibleAsCharAndString(t1, &(*e2)) && !CompatibleAsCharAndString(t2, &(*e1)) && !CompatibleAsIntAndByte(t1, t2)) {
		(*err) = Ast_ErrRelationExprDifferenTypes_cnst;
		continue_ = false;
	} else if ((o7_in(O7_REF(t1)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdChar_cnst)))) || (o7_cmp(O7_REF(t1)->_._.id, Ast_IdArray_cnst) == 0) && (o7_cmp(O7_REF(O7_REF(t1)->_.type)->_._.id, Ast_IdChar_cnst) == 0)) {
		continue_ = true;
	} else if (o7_in(O7_REF(t1)->_._.id, ((1u << Ast_IdRecord_cnst) | (1u << Ast_IdArray_cnst)))) {
		continue_ = false;
		(*err) = Ast_ErrRelIncompatibleType_cnst;
	} else {
		continue_ = (relation == Scanner_Equal_cnst) || (relation == Scanner_Inequal_cnst);
		if (!continue_) {
			(*err) = Ast_ErrRelIncompatibleType_cnst;
		}
	}
	(*distance) = o7_sub(dist1, dist2);
	return continue_;
}

static o7_bool ExprRelationNew_IsEqualSets(Ast_LongSet s1, Ast_LongSet s2) {
	return (s1[0] == s2[0]) && (s1[1] == s2[1]);
}

static o7_bool ExprRelationNew_InSet(int i, Ast_LongSet s) {
	return CheckSetRange(i) && (o7_in(o7_mod(i, (TypeLimits_SetMax_cnst + 1)), s[o7_ind(2, o7_div(i, (TypeLimits_SetMax_cnst + 1)))]));
}

extern int Ast_ExprRelationNew(struct Ast_ExprRelation_s **e, struct Ast_RExpression *expr1, int relation, struct Ast_RExpression *expr2) {
	int err;
	o7_bool res;
	struct Ast_RExpression *v1, *v2;

	O7_ASSERT((Scanner_RelationFirst_cnst <= relation) && (relation < Scanner_RelationLast_cnst));

	O7_NEW(&(*e), Ast_ExprRelation_s);
	ExprInit(&(*e)->_, Ast_IdRelation_cnst, Ast_TypeGet(Ast_IdBoolean_cnst));
	O7_REF((*e))->exprs[0] = expr1;
	O7_REF((*e))->exprs[1] = expr2;
	O7_REF((*e))->relation = relation;
	err = Ast_ErrNo_cnst;
	if ((expr1 != NULL) && (expr2 != NULL) && ExprRelationNew_CheckType(O7_REF(expr1)->type, O7_REF(expr2)->type, &O7_REF((*e))->exprs[0], &O7_REF((*e))->exprs[1], relation, &O7_REF((*e))->distance, &err) && (O7_REF(expr1)->value_ != NULL) && (O7_REF(expr2)->value_ != NULL) && (relation != Scanner_Is_cnst)) {
		v1 = (&(O7_REF(O7_REF((*e))->exprs[0])->value_)->_);
		v2 = (&(O7_REF(O7_REF((*e))->exprs[1])->value_)->_);
		switch (relation) {
		case 21:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) == 0;
				break;
			case 2:
				res = O7_GUARD(Ast_ExprBoolean_s, &v1)->bool_ == O7_GUARD(Ast_ExprBoolean_s, &v2)->bool_;
				break;
			case 5:
				res = (O7_GUARD(Ast_ExprReal_s, &v1)->real == O7_GUARD(Ast_ExprReal_s, &v2)->real) || true;
				break;
			case 7:
			case 8:
				res = ExprRelationNew_IsEqualSets(O7_GUARD(Ast_ExprSet_s, &v1)->set, O7_GUARD(Ast_ExprSet_s, &v2)->set);
				break;
			case 9:
				O7_ASSERT(v1 == v2);
				res = true;
				break;
			case 10:
				if (o7_is(v1, Ast_RExprInteger_tag)) {
					res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) == 0;
				} else {
					res = StringStore_Compare(&O7_GUARD(Ast_ExprString_s, &v1)->string, &O7_GUARD(Ast_ExprString_s, &v2)->string) == 0;
				}
				break;
			case 13:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 22:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) != 0;
				break;
			case 2:
				res = O7_GUARD(Ast_ExprBoolean_s, &v1)->bool_ != O7_GUARD(Ast_ExprBoolean_s, &v2)->bool_;
				break;
			case 5:
				res = O7_GUARD(Ast_ExprReal_s, &v1)->real != O7_GUARD(Ast_ExprReal_s, &v2)->real;
				break;
			case 7:
			case 8:
				res = !ExprRelationNew_IsEqualSets(O7_GUARD(Ast_ExprSet_s, &v1)->set, O7_GUARD(Ast_ExprSet_s, &v2)->set);
				break;
			case 9:
				O7_ASSERT(v1 == v2);
				res = false;
				break;
			case 10:
				res = false;
				break;
			case 13:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 23:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) < 0;
				break;
			case 5:
				res = O7_GUARD(Ast_ExprReal_s, &v1)->real < O7_GUARD(Ast_ExprReal_s, &v2)->real;
				break;
			case 10:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 24:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) <= 0;
				break;
			case 5:
				res = O7_GUARD(Ast_ExprReal_s, &v1)->real <= O7_GUARD(Ast_ExprReal_s, &v2)->real;
				break;
			case 10:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 25:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) > 0;
				break;
			case 5:
				res = O7_GUARD(Ast_ExprReal_s, &v1)->real > O7_GUARD(Ast_ExprReal_s, &v2)->real;
				break;
			case 10:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 26:
			switch (O7_REF(O7_REF(expr1)->type)->_._.id) {
			case 0:
			case 4:
				res = o7_cmp(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_RExprInteger, &v2)->int_) >= 0;
				break;
			case 5:
				res = O7_GUARD(Ast_ExprReal_s, &v1)->real >= O7_GUARD(Ast_ExprReal_s, &v2)->real;
				break;
			case 10:
				res = false;
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(expr1)->type)->_._.id);
				break;
			}
			break;
		case 27:
			res = ExprRelationNew_InSet(O7_GUARD(Ast_RExprInteger, &v1)->int_, O7_GUARD(Ast_ExprSet_s, &v2)->set);
			break;
		default:
			o7_case_fail(relation);
			break;
		}
		if (o7_cmp(O7_REF(O7_REF(expr1)->type)->_._.id, Ast_IdReal_cnst) != 0) {
			O7_REF((*e))->_.value_ = (&(Ast_ExprBooleanGet(res))->_);
		}
	}
	return err;
}

static int LexToSign(int lex) {
	int s;

	if ((lex ==  - 1) || (lex == Scanner_Plus_cnst)) {
		s =  + 1;
	} else {
		O7_ASSERT(lex == Scanner_Minus_cnst);
		s =  - 1;
	}
	return s;
}

static void ExprSumCreate(struct Ast_ExprSum_s **e, int add, struct Ast_RExpression *sum, struct Ast_RExpression *term) {
	struct Ast_RType *t;

	O7_NEW(&(*e), Ast_ExprSum_s);
	if ((sum != NULL) && (O7_REF(sum)->type != NULL) && (o7_in(O7_REF(O7_REF(sum)->type)->_._.id, ((1u << Ast_IdReal_cnst) | (1u << Ast_IdInteger_cnst) | (1u << Ast_IdByte_cnst))))) {
		t = O7_REF(sum)->type;
	} else if (term != NULL) {
		t = O7_REF(term)->type;
	} else {
		t = NULL;
	}
	if ((t != NULL) && (o7_cmp(O7_REF(t)->_._.id, Ast_IdByte_cnst) == 0)) {
		t = Ast_TypeGet(Ast_IdInteger_cnst);
	}
	ExprInit(&(*e)->_, Ast_IdSum_cnst, t);
	O7_REF((*e))->next = NULL;
	O7_REF((*e))->add = add;
	O7_REF((*e))->term = term;
}

static void ExprSumNew_SetNeg(Ast_LongSet s) {
	s[0] =  ~s[0];
	s[1] =  ~s[1];
}

extern int Ast_ExprSumNew(struct Ast_ExprSum_s **e, int add, struct Ast_RExpression *term) {
	int err;

	O7_ASSERT((add ==  - 1) || (add == Scanner_Plus_cnst) || (add == Scanner_Minus_cnst));
	ExprSumCreate(&(*e), add, NULL, term);
	err = Ast_ErrNo_cnst;
	if (O7_REF((*e))->_.type != NULL) {
		if (!(o7_in(O7_REF(O7_REF((*e))->_.type)->_._.id, ((1u << Ast_IdByte_cnst) | (1u << Ast_IdInteger_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst)))) && (add !=  - 1)) {
			if (o7_cmp(O7_REF(O7_REF((*e))->_.type)->_._.id, Ast_IdBoolean_cnst) != 0) {
				err = Ast_ErrNotNumberAndNotSetInAdd_cnst;
			} else {
				err = Ast_ErrSignForBool_cnst;
			}
		} else if (O7_REF(term)->value_ != NULL) {
			switch (O7_REF(O7_REF((*e))->_.type)->_._.id) {
			case 0:
				O7_REF((*e))->_.value_ = (&(Ast_ExprIntegerNew(o7_mul(O7_GUARD(Ast_RExprInteger, &O7_REF(term)->value_)->int_, LexToSign(add))))->_._);
				break;
			case 5:
				O7_REF((*e))->_.value_ = NULL;
				break;
			case 7:
			case 8:
				O7_REF((*e))->_.value_ = (&(Ast_ExprSetByValue(O7_GUARD(Ast_ExprSet_s, &O7_REF(term)->value_)->set))->_);
				if (add == Scanner_Minus_cnst) {
					ExprSumNew_SetNeg(O7_GUARD(Ast_ExprSet_s, &O7_REF((*e))->_.value_)->set);
				}
				break;
			case 2:
				O7_REF((*e))->_.value_ = (&(Ast_ExprBooleanGet(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(term)->value_)->bool_))->_);
				break;
			default:
				o7_case_fail(O7_REF(O7_REF((*e))->_.type)->_._.id);
				break;
			}
		}
	}
	return err;
}

static o7_bool ExprSumAdd_CheckType(struct Ast_RExpression *e1, struct Ast_RExpression *e2, int add, int *err) {
	o7_bool continue_;

	if ((O7_REF(e1)->type == NULL) || (O7_REF(e2)->type == NULL)) {
		continue_ = false;
	} else if ((o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, O7_REF(O7_REF(e2)->type)->_._.id) != 0) && !CompatibleAsIntAndByte(O7_REF(e1)->type, O7_REF(e2)->type)) {
		(*err) = Ast_ErrAddExprDifferenTypes_cnst;
		continue_ = false;
	} else if (add == Scanner_Or_cnst) {
		continue_ = o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, Ast_IdBoolean_cnst) == 0;
		if (!continue_) {
			(*err) = Ast_ErrNotBoolInLogicExpr_cnst;
		}
	} else {
		continue_ = o7_in(O7_REF(O7_REF(e1)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdSet_cnst)));
		if (!continue_) {
			(*err) = Ast_ErrNotNumberAndNotSetInAdd_cnst;
		}
	}
	return continue_;
}

static void ExprSumAdd_AddSet(Ast_LongSet s, Ast_LongSet a) {
	s[0] = s[0] | a[0];
	s[1] = s[1] | a[1];
}

static void ExprSumAdd_SubSet(Ast_LongSet s, Ast_LongSet a) {
	s[0] = s[0] & ~a[0];
	s[1] = s[1] & ~a[1];
}

extern int Ast_ExprSumAdd(struct Ast_RExpression *fullSum, struct Ast_ExprSum_s **lastAdder, int add, struct Ast_RExpression *term) {
	struct Ast_ExprSum_s *e;
	int err;

	O7_ASSERT((add == Scanner_Plus_cnst) || (add == Scanner_Minus_cnst) || (add == Scanner_Or_cnst));

	ExprSumCreate(&e, add, fullSum, term);
	err = Ast_ErrNo_cnst;
	if ((fullSum != NULL) && (term != NULL) && ExprSumAdd_CheckType(fullSum, term, add, &err) && (O7_REF(fullSum)->value_ != NULL) && (O7_REF(term)->value_ != NULL)) {
		if (add == Scanner_Or_cnst) {
			if (o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(term)->value_)->bool_)) {
				O7_REF(fullSum)->value_ = O7_REF(term)->value_;
			}
		} else {
			switch (O7_REF(O7_REF(term)->type)->_._.id) {
			case 0:
				if (Arithmetic_Add(&O7_GUARD(Ast_RExprInteger, &O7_REF(fullSum)->value_)->int_, O7_GUARD(Ast_RExprInteger, &O7_REF(fullSum)->value_)->int_, o7_mul(O7_GUARD(Ast_RExprInteger, &O7_REF(term)->value_)->int_, LexToSign(add)))) {
				} else if (add == Scanner_Minus_cnst) {
					err = Ast_ErrConstSubOverflow_cnst;
				} else {
					err = Ast_ErrConstAddOverflow_cnst;
				}
				break;
			case 5:
				break;
			case 7:
				if (add == Scanner_Plus_cnst) {
					ExprSumAdd_AddSet(O7_GUARD(Ast_ExprSet_s, &O7_REF(fullSum)->value_)->set, O7_GUARD(Ast_ExprSet_s, &O7_REF(term)->value_)->set);
				} else {
					ExprSumAdd_SubSet(O7_GUARD(Ast_ExprSet_s, &O7_REF(fullSum)->value_)->set, O7_GUARD(Ast_ExprSet_s, &O7_REF(term)->value_)->set);
				}
				break;
			default:
				o7_case_fail(O7_REF(O7_REF(term)->type)->_._.id);
				break;
			}
		}
	} else if (fullSum != NULL) {
		O7_REF(fullSum)->value_ = NULL;
	}

	if ((*lastAdder) != NULL) {
		O7_REF((*lastAdder))->next = e;
	}
	(*lastAdder) = e;
	return err;
}

static int MultCalc(struct Ast_RExpression *res, int mult, struct Ast_RExpression *b);
static o7_bool MultCalc_CheckType(struct Ast_RExpression *e1, struct Ast_RExpression *e2, int mult, int *err) {
	o7_bool continue_;

	if ((O7_REF(e1)->type == NULL) || (O7_REF(e2)->type == NULL)) {
		continue_ = false;
	} else if ((o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, O7_REF(O7_REF(e2)->type)->_._.id) != 0) && !CompatibleAsIntAndByte(O7_REF(e1)->type, O7_REF(e2)->type)) {
		continue_ = false;
		if (mult == Scanner_And_cnst) {
			(*err) = Ast_ErrNotBoolInLogicExpr_cnst;
		} else if (mult == Scanner_Asterisk_cnst) {
			(*err) = Ast_ErrMultExprDifferentTypes_cnst;
		} else {
			(*err) = Ast_ErrDivExprDifferentTypes_cnst;
		}
	} else if (mult == Scanner_And_cnst) {
		continue_ = o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, Ast_IdBoolean_cnst) == 0;
		if (!continue_) {
			(*err) = Ast_ErrNotBoolInLogicExpr_cnst;
		}
	} else if (!(o7_in(O7_REF(O7_REF(e1)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst))))) {
		continue_ = false;
		(*err) = Ast_ErrNotNumberAndNotSetInMult_cnst;
	} else if ((mult == Scanner_Div_cnst) || (mult == Scanner_Mod_cnst)) {
		continue_ = o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, Ast_IdInteger_cnst) == 0;
		if (!continue_) {
			(*err) = Ast_ErrNotIntInDivOrMod_cnst;
		}
	} else if ((mult == Scanner_Slash_cnst) && (o7_cmp(O7_REF(O7_REF(e1)->type)->_._.id, Ast_IdInteger_cnst) == 0)) {
		continue_ = false;
		(*err) = Ast_ErrNotRealTypeForRealDiv_cnst;
	} else {
		continue_ = true;
	}
	return continue_;
}

static void MultCalc_Int(struct Ast_RExpression *res, int mult, struct Ast_RExpression *b, int *err) {
	int i = O7_INT_UNDEF, i1, i2;

	i1 = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(res)->value_)->int_);
	i2 = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(b)->value_)->int_);
	if (mult == Scanner_Asterisk_cnst) {
		if (!Arithmetic_Mul(&i, i1, i2)) {
			(*err) = Ast_ErrConstMultOverflow_cnst;
		}
	} else if (i2 == 0) {
		(*err) = Ast_ErrComDivByZero_cnst;
	} else if (mult == Scanner_Div_cnst) {
		i = o7_div(i1, i2);
	} else {
		i = o7_mod(i1, i2);
	}
	if ((*err) == Ast_ErrNo_cnst) {
		O7_REF(res)->value_ = (&(Ast_ExprIntegerNew(i))->_._);
	} else {
		O7_REF(res)->value_ = NULL;
	}
}

static void MultCalc_St(struct Ast_RExpression *res, int mult, struct Ast_RExpression *b) {
	unsigned s[2], s1[2], s2[2];
	memset(&s, 0, sizeof(s));
	memset(&s1, 0, sizeof(s1));
	memset(&s2, 0, sizeof(s2));

	memcpy(s1, O7_GUARD(Ast_ExprSet_s, &O7_REF(res)->value_)->set, sizeof(O7_GUARD(Ast_ExprSet_s, &O7_REF(res)->value_)->set));
	memcpy(s2, O7_GUARD(Ast_ExprSet_s, &O7_REF(b)->value_)->set, sizeof(O7_GUARD(Ast_ExprSet_s, &O7_REF(b)->value_)->set));
	if (mult == Scanner_Asterisk_cnst) {
		s[0] = s1[0] & s2[0];
		s[1] = s1[1] & s2[1];
	} else {
		s[0] = s1[0] ^ s2[0];
		s[1] = s1[1] ^ s2[1];
	}
	if (O7_REF(res)->value_ == NULL) {
		O7_REF(res)->value_ = (&(Ast_ExprSetByValue(s))->_);
	} else {
		memcpy(O7_GUARD(Ast_ExprSet_s, &O7_REF(res)->value_)->set, s, sizeof(s));
	}
}

static int MultCalc(struct Ast_RExpression *res, int mult, struct Ast_RExpression *b) {
	int err;

	err = Ast_ErrNo_cnst;
	if (MultCalc_CheckType(res, b, mult, &err) && (O7_REF(res)->value_ != NULL) && (O7_REF(b)->value_ != NULL)) {
		switch (O7_REF(O7_REF(res)->type)->_._.id) {
		case 0:
			MultCalc_Int(res, mult, b, &err);
			break;
		case 5:
			O7_REF(res)->value_ = NULL;
			break;
		case 2:
			if (o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(res)->value_)->bool_) && !o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(b)->value_)->bool_)) {
				O7_REF(res)->value_ = O7_REF(b)->value_;
			}
			break;
		case 7:
			MultCalc_St(res, mult, b);
			break;
		default:
			o7_case_fail(O7_REF(O7_REF(res)->type)->_._.id);
			break;
		}
	} else {
		O7_REF(res)->value_ = NULL;
		if ((o7_in((o7_sub(mult, Scanner_Div_cnst)), ((1u << 0) | (1u << 1)))) && (O7_REF(b)->value_ != NULL) && (o7_cmp(O7_REF(O7_REF(O7_REF(b)->value_)->_.type)->_._.id, Ast_IdInteger_cnst) == 0) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(b)->value_)->int_, 0) == 0)) {
			err = Ast_ErrComDivByZero_cnst;
		}
	}
	return err;
}

static int ExprTermGeneral(struct Ast_ExprTerm_s **e, struct Ast_RExpression *result, struct Ast_RFactor *factor, int mult, struct Ast_RExpression *factorOrTerm) {
	struct Ast_RType *t;
	struct Ast_RFactor *val;
	int err;

	O7_ASSERT((Scanner_MultFirst_cnst <= mult) && (mult <= Scanner_MultLast_cnst));

	O7_ASSERT((o7_cmp(O7_REF(factorOrTerm)->_.id, Ast_IdError_cnst) == 0) || (o7_is(factorOrTerm, Ast_RFactor_tag)) || (o7_is(factorOrTerm, Ast_ExprTerm_s_tag)));

	if (factor != NULL) {
		t = O7_REF(factor)->_.type;
		val = O7_REF(factor)->_.value_;
		if ((t != NULL) && (o7_cmp(O7_REF(t)->_._.id, Ast_IdByte_cnst) == 0)) {
			t = Ast_TypeGet(Ast_IdInteger_cnst);
		}
	} else {
		t = NULL;
		val = NULL;
	}

	O7_NEW(&(*e), Ast_ExprTerm_s);
	ExprInit(&(*e)->_, Ast_IdTerm_cnst, t);
	if (result == NULL) {
		result = (&((*e))->_);
		if (o7_cmp(O7_REF(O7_REF((*e))->_.type)->_._.id, Ast_IdReal_cnst) != 0) {
			O7_REF((*e))->_.value_ = val;
		}
	}
	O7_REF((*e))->factor = factor;
	O7_REF((*e))->mult = mult;
	O7_REF((*e))->expr = factorOrTerm;
	O7_REF((*e))->factor = factor;

	if (o7_cmp(O7_REF(factorOrTerm)->_.id, Ast_IdError_cnst) != 0) {
		err = MultCalc(result, mult, factorOrTerm);
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_ExprTermNew(struct Ast_ExprTerm_s **e, struct Ast_RFactor *factor, int mult, struct Ast_RExpression *factorOrTerm) {
	return ExprTermGeneral(&(*e), NULL, factor, mult, factorOrTerm);
}

extern int Ast_ExprTermAdd(struct Ast_RExpression *fullTerm, struct Ast_ExprTerm_s **lastTerm, int mult, struct Ast_RExpression *factorOrTerm) {
	struct Ast_ExprTerm_s *e;
	int err;

	if ((*lastTerm) != NULL) {
		O7_ASSERT(O7_REF((*lastTerm))->expr != NULL);
		err = ExprTermGeneral(&e, fullTerm, O7_GUARD(Ast_RFactor, &O7_REF((*lastTerm))->expr), mult, factorOrTerm);
		O7_REF((*lastTerm))->expr = (&(e)->_);
		(*lastTerm) = e;
	} else {
		err = ExprTermGeneral(&(*lastTerm), fullTerm, NULL, mult, factorOrTerm);
	}
	return err;
}

static int ExprCallCreate(struct Ast_ExprCall_s **e, struct Ast_Designator_s *des, o7_bool func) {
	int err;
	struct Ast_RType *t;
	struct Ast_RProcType *pt;

	t = NULL;
	err = Ast_ErrNo_cnst;
	if (des != NULL) {
		Log_Str(29, (o7_char *)"ExprCallCreate des.decl.id = ");
		Log_Int(O7_REF(O7_REF(des)->decl)->_.id);
		Log_Ln();
		if (o7_cmp(O7_REF(O7_REF(des)->decl)->_.id, Ast_IdError_cnst) == 0) {
			pt = Ast_ProcTypeNew(false);
			O7_REF(O7_REF(des)->decl)->type = (&(pt)->_._);
			O7_REF(des)->_._.type = (&(pt)->_._);
		} else if (O7_REF(des)->_._.type != NULL) {
			if (o7_is(O7_REF(des)->_._.type, Ast_RProcType_tag)) {
				t = O7_REF(O7_REF(des)->_._.type)->_.type;
				if ((t != NULL) != func) {
					err = o7_add(Ast_ErrCallIgnoredReturn_cnst, (int)o7_bl(func));
				}
			} else {
				err = Ast_ErrCallNotProc_cnst;
			}
		}
	}
	if ((t == NULL) && func) {
		t = Ast_TypeErrorNew();
	}
	O7_NEW(&(*e), Ast_ExprCall_s);
	ExprInit(&(*e)->_._, Ast_IdCall_cnst, t);
	O7_REF((*e))->designator = des;
	O7_REF((*e))->params = NULL;
	return err;
}

extern int Ast_ExprCallNew(struct Ast_ExprCall_s **e, struct Ast_Designator_s *des) {
	return ExprCallCreate(&(*e), des, true);
}

extern o7_bool Ast_IsChangeable(struct Ast_Designator_s *des) {
	struct Ast_RVar *v;
	struct Ast_RSelector *sel;
	int tid;
	o7_bool able;

	v = O7_GUARD(Ast_RVar, &O7_REF(des)->decl);
	if ((O7_REF(v)->_.up != NULL) && (O7_REF(O7_REF(v)->_.up)->_.up == NULL)) {
		able = !o7_bl(O7_REF(O7_REF(v)->_.module)->fixed);
	} else {
		able = !(o7_is(v, Ast_FormalParam_s_tag)) || (!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &v)->access)) || !(o7_in(O7_REF(O7_REF(v)->_.type)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdRecord_cnst))));
	}
	if (!able) {
		tid = o7_int(O7_REF(O7_REF(O7_REF(des)->decl)->type)->_._.id);
		sel = O7_REF(des)->sel;
		while ((sel != NULL) && (tid != Ast_IdPointer_cnst)) {
			tid = o7_int(O7_REF(O7_REF(sel)->type)->_._.id);
			sel = O7_REF(sel)->next;
		}
		able = sel != NULL;
	}
	return able;
}

extern o7_bool Ast_IsVar(struct Ast_RExpression *e) {
	Log_Str(14, (o7_char *)"IsVar: e.id = ");
	Log_Int(O7_REF(e)->_.id);
	Log_Ln();
	return (o7_is(e, Ast_Designator_s_tag)) && (o7_is(O7_GUARD(Ast_Designator_s, &e)->decl, Ast_RVar_tag));
}

extern o7_bool Ast_IsFormalParam(struct Ast_RExpression *e) {
	return (o7_is(e, Ast_Designator_s_tag)) && (O7_GUARD(Ast_Designator_s, &e)->sel == NULL) && (o7_is(O7_GUARD(Ast_Designator_s, &e)->decl, Ast_FormalParam_s_tag));
}

extern int Ast_ProcedureAdd(struct Ast_RDeclarations *ds, struct Ast_RProcedure **p, int buf_len0, o7_char buf[/*len0*/], int begin, int end) {
	int err;

	err = CheckNameDuplicate(ds, buf_len0, buf, begin, end);
	O7_NEW(&(*p), Ast_RProcedure);
	NodeInit(&(*O7_REF((*p)))._._._._, Ast_IdProcType_cnst);
	DeclarationsConnect(&(*p)->_._, ds, buf_len0, buf, begin, end);
	O7_REF((*p))->_.header = Ast_ProcTypeNew(false);
	O7_REF((*p))->_.return_ = NULL;
	if (O7_REF(ds)->_.up == NULL) {
		O7_REF((*p))->deep = 0;
	} else {
		O7_REF((*p))->deep = o7_add(O7_GUARD(Ast_RProcedure, &ds)->deep, 1);
		if ((err == Ast_ErrNo_cnst) && (o7_cmp(TranslatorLimits_DeepProcedures_cnst, O7_REF((*p))->deep) <= 0)) {
			err = Ast_ErrProcNestedTooDeep_cnst;
		}
	}
	if (O7_REF(ds)->procedures == NULL) {
		O7_REF(ds)->procedures = (*p);
	}
	return err;
}

extern int Ast_ProcedureSetReturn(struct Ast_RProcedure *p, struct Ast_RExpression *e) {
	int err, distance;

	O7_ASSERT(O7_REF(p)->_.return_ == NULL);
	err = Ast_ErrNo_cnst;
	if (O7_REF(O7_REF(p)->_.header)->_._._.type == NULL) {
		err = Ast_ErrProcHasNoReturn_cnst;
	} else if (e != NULL) {
		O7_REF(p)->_.return_ = e;
		if (!Ast_CompatibleTypes(&distance, O7_REF(O7_REF(p)->_.header)->_._._.type, O7_REF(e)->type) && !CompatibleAsCharAndString(O7_REF(O7_REF(p)->_.header)->_._._.type, &O7_REF(p)->_.return_)) {
			if (!CompatibleAsIntAndByte(O7_REF(O7_REF(p)->_.header)->_._._.type, O7_REF(O7_REF(p)->_.return_)->type)) {
				err = Ast_ErrReturnIncompatibleType_cnst;
			} else if ((o7_cmp(O7_REF(O7_REF(O7_REF(p)->_.return_)->type)->_._.id, Ast_IdByte_cnst) == 0) && (O7_REF(e)->value_ != NULL) && !TypeLimits_InByteRange(O7_GUARD(Ast_RExprInteger, &O7_REF(e)->value_)->int_)) {
				err = Ast_ErrValueOutOfRangeOfByte_cnst;
			}
		}
		if (err == Ast_ErrNo_cnst) {
			err = CheckUnusedDeclarations(&p->_._);
		}
	}
	return err;
}

extern int Ast_ProcedureEnd(struct Ast_RProcedure *p) {
	int err;

	if ((O7_REF(O7_REF(p)->_.header)->_._._.type != NULL) && (O7_REF(p)->_.return_ == NULL)) {
		err = Ast_ErrExpectReturn_cnst;
	} else {
		err = CheckUnusedDeclarations(&p->_._);
	}
	return err;
}

static o7_bool CallParamNew_TypeVariation(struct Ast_ExprCall_s *call, struct Ast_RType *tp, struct Ast_FormalParam_s *fp) {
	o7_bool comp;
	int id;

	comp = o7_is(O7_REF(O7_REF(call)->designator)->decl, Ast_PredefinedProcedure_s_tag);
	if (comp) {
		id = o7_int(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id);
		if (id == Scanner_New_cnst) {
			comp = o7_cmp(O7_REF(tp)->_._.id, Ast_IdPointer_cnst) == 0;
		} else if (id == Scanner_Abs_cnst) {
			comp = o7_in(O7_REF(tp)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdReal_cnst)));
			O7_REF(call)->_._.type = tp;
		} else if (id == Scanner_Len_cnst) {
			comp = o7_cmp(O7_REF(tp)->_._.id, Ast_IdArray_cnst) == 0;
		} else {
			comp = (id == Scanner_Ord_cnst) && (o7_in(O7_REF(tp)->_._.id, ((1u << Ast_IdChar_cnst) | (1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst) | (1u << Ast_IdBoolean_cnst))));
		}
	}
	return comp;
}

static void CallParamNew_ParamsVariation(struct Ast_ExprCall_s *call, struct Ast_RExpression *e, int *err) {
	int id;

	id = o7_int(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id);
	if (id != Ast_IdError_cnst) {
		if ((id != Scanner_Inc_cnst) && (id != Scanner_Dec_cnst) || (O7_REF(O7_REF(call)->params)->next != NULL)) {
			(*err) = Ast_ErrCallExcessParam_cnst;
		} else if (o7_cmp(O7_REF(O7_REF(e)->type)->_._.id, Ast_IdInteger_cnst) != 0) {
			(*err) = Ast_ErrCallIncompatibleParamType_cnst;
		}
	}
}

static void CallParamNew_CheckNeedTag(struct Ast_FormalParam_s *fp, struct Ast_RExpression *e) {
	if ((o7_cmp(O7_REF(O7_REF(fp)->_._.type)->_._.id, Ast_IdRecord_cnst) == 0) && Ast_IsFormalParam(e)) {
		ExchangeParamsNeedTag(fp, O7_GUARD(Ast_FormalParam_s, &O7_GUARD(Ast_Designator_s, &e)->decl));
	}
}

extern int Ast_CallParamNew(struct Ast_ExprCall_s *call, struct Ast_Parameter_s **lastParam, struct Ast_RExpression *e, struct Ast_FormalParam_s **currentFormalParam) {
	int err, distance;
	struct Ast_FormalParam_s *fp;

	err = Ast_ErrNo_cnst;
	fp = (*currentFormalParam);
	if (fp != NULL) {
		if (!Ast_CompatibleTypes(&distance, O7_REF(fp)->_._.type, O7_REF(e)->type) && !CompatibleAsCharAndString(O7_REF((*currentFormalParam))->_._.type, &e) && ((!!( (1u << Ast_ParamOut_cnst) & O7_REF(fp)->access)) || !CompatibleAsIntAndByte(O7_REF(fp)->_._.type, O7_REF(e)->type)) && !CallParamNew_TypeVariation(call, O7_REF(e)->type, fp)) {
			err = Ast_ErrCallIncompatibleParamType_cnst;
		} else if (!!( (1u << Ast_ParamOut_cnst) & O7_REF(fp)->access)) {
			if (!(Ast_IsVar(e) && Ast_IsChangeable(O7_GUARD(Ast_Designator_s, &e)))) {
				err = Ast_ErrCallExpectVarParam_cnst;
			} else if ((O7_REF(e)->type != NULL) && (o7_cmp(O7_REF(O7_REF(e)->type)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(e)->type != O7_REF(fp)->_._.type) && (O7_REF(fp)->_._.type != NULL) && (O7_REF(O7_REF(fp)->_._.type)->_.type != NULL) && (O7_REF(O7_REF(e)->type)->_.type != NULL)) {
				err = Ast_ErrCallVarPointerTypeNotSame_cnst;
			}
		} else if ((o7_cmp(O7_REF(O7_REF(fp)->_._.type)->_._.id, Ast_IdByte_cnst) == 0) && (o7_cmp(O7_REF(O7_REF(e)->type)->_._.id, Ast_IdInteger_cnst) == 0) && (O7_REF(e)->value_ != NULL) && !TypeLimits_InByteRange(O7_GUARD(Ast_RExprInteger, &O7_REF(e)->value_)->int_)) {
			err = Ast_ErrValueOutOfRangeOfByte_cnst;
		}
		if ((O7_REF(fp)->_._.next != NULL) && (o7_is(O7_REF(fp)->_._.next, Ast_FormalParam_s_tag))) {
			(*currentFormalParam) = O7_GUARD(Ast_FormalParam_s, &O7_REF(fp)->_._.next);
		} else {
			(*currentFormalParam) = NULL;
		}
	} else {
		distance = 0;
		CallParamNew_ParamsVariation(call, e, &err);
	}

	if ((*lastParam) == NULL) {
		O7_NEW(&(*lastParam), Ast_Parameter_s);
	} else {
		O7_ASSERT(O7_REF((*lastParam))->next == NULL);
		O7_NEW(&O7_REF((*lastParam))->next, Ast_Parameter_s);
		(*lastParam) = O7_REF((*lastParam))->next;
	}
	if ((err == Ast_ErrNo_cnst) && (fp != NULL)) {
		CallParamNew_CheckNeedTag(fp, e);
	}
	NodeInit(&(*O7_REF((*lastParam)))._, Ast_NoId_cnst);
	O7_REF((*lastParam))->expr = e;
	O7_REF((*lastParam))->distance = distance;
	O7_REF((*lastParam))->next = NULL;
	return err;
}

static void CallParamsEnd_CalcPredefined(struct Ast_ExprCall_s *call, struct Ast_RFactor *v, int *err) {
	switch (O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id) {
	case 90:
		if (o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdReal_cnst) == 0) {
			O7_REF(call)->_._.value_ = NULL;
		} else {
			O7_ASSERT(o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdInteger_cnst) == 0);
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew(abs(O7_GUARD(Ast_RExprInteger, &v)->int_)))->_._);
		}
		break;
	case 109:
		O7_REF(call)->_._.value_ = (&(Ast_ExprBooleanGet((O7_GUARD(Ast_RExprInteger, &v)->int_ % 2 == 1)))->_);
		break;
	case 107:
		if (O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_ != NULL) {
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew((int)((unsigned)O7_GUARD(Ast_RExprInteger, &v)->int_ << O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_)->int_)))->_._);
		}
		break;
	case 91:
		if (O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_ != NULL) {
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew((int)((unsigned)O7_GUARD(Ast_RExprInteger, &v)->int_ >> O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_)->int_)))->_._);
		}
		break;
	case 114:
		if (O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_ != NULL) {
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew((int)((unsigned)O7_GUARD(Ast_RExprInteger, &v)->int_ >> O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(O7_REF(O7_REF(call)->params)->next)->expr)->value_)->int_)))->_._);
		}
		break;
	case 99:
		if (false) {
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew(o7_floor(O7_GUARD(Ast_ExprReal_s, &v)->real)))->_._);
		}
		break;
	case 100:
		O7_REF(call)->_._.value_ = (&(Ast_ExprRealNewByValue(o7_flt(O7_GUARD(Ast_RExprInteger, &v)->int_)))->_._);
		break;
	case 110:
		if (o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdChar_cnst) == 0) {
			O7_REF(call)->_._.value_ = v;
		} else if (o7_is(v, Ast_ExprString_s_tag)) {
			if (o7_cmp(O7_GUARD(Ast_ExprString_s, &v)->_.int_,  - 1) > 0) {
				O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew(O7_GUARD(Ast_ExprString_s, &v)->_.int_))->_._);
			}
		} else if (o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdBoolean_cnst) == 0) {
			O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew((int)o7_bl(O7_GUARD(Ast_ExprBoolean_s, &v)->bool_)))->_._);
		} else if (o7_in(O7_REF(O7_REF(v)->_.type)->_._.id, ((1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst)))) {
			if (!(!!( (1u << TypeLimits_SetMax_cnst) & O7_GUARD(Ast_ExprSet_s, &v)->set[0])) && (O7_GUARD(Ast_ExprSet_s, &v)->set[1] == 0)) {
				O7_REF(call)->_._.value_ = (&(Ast_ExprIntegerNew(o7_sti(O7_GUARD(Ast_ExprSet_s, &v)->set[0])))->_._);
			} else {
				(*err) = Ast_ErrSetElemMaxNotConvertToInt_cnst;
			}
		} else if (o7_cmp(O7_REF(O7_REF(v)->_.type)->_._.id, Ast_IdError_cnst) != 0) {
			Log_Str(39, (o7_char *)"Неправильный id типа = ");
			Log_Int(O7_REF(O7_REF(v)->_.type)->_._.id);
			Log_Ln();
			Log_Int(O7_REF(v)->_._.id);
			Log_Ln();
		}
		break;
	case 96:
		if (!TypeLimits_InCharRange(O7_GUARD(Ast_RExprInteger, &v)->int_)) {
			(*err) = Ast_ErrValueOutOfRangeOfChar_cnst;
		}
		O7_REF(call)->_._.value_ = v;
		break;
	default:
		o7_case_fail(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id);
		break;
	}
}

extern int Ast_CallParamsEnd(struct Ast_ExprCall_s *call, struct Ast_FormalParam_s *currentFormalParam, struct Ast_RDeclarations *ds) {
	int err;

	err = Ast_ErrNo_cnst;
	if (currentFormalParam != NULL) {
		err = Ast_ErrCallParamsNotEnough_cnst;
	} else if (o7_cmp(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id, Scanner_Len_cnst) == 0) {
		if ((o7_is(O7_REF(O7_REF(O7_REF(call)->params)->expr)->type, Ast_RArray_tag)) && (O7_GUARD(Ast_RArray, &O7_REF(O7_REF(O7_REF(call)->params)->expr)->type)->count != NULL)) {
			O7_REF(call)->_._.value_ = O7_REF(O7_GUARD(Ast_RArray, &O7_REF(O7_REF(O7_REF(call)->params)->expr)->type)->count)->value_;
		}
	} else if (o7_cmp(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id, Scanner_Assert_cnst) == 0) {
		if ((O7_REF(O7_REF(O7_REF(call)->params)->expr)->value_ != NULL) && (o7_is(O7_REF(O7_REF(O7_REF(call)->params)->expr)->value_, Ast_ExprBoolean_s_tag)) && !o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(O7_REF(O7_REF(call)->params)->expr)->value_)->bool_)) {
			if (O7_REF(O7_REF(call)->params)->expr == &Ast_ExprBooleanGet(false)->_._) {
				Ast_TurnFail(ds);
			} else {
				err = Ast_ErrAssertConstFalse_cnst;
			}
		}
	} else if ((o7_is(O7_REF(O7_REF(call)->designator)->decl, Ast_PredefinedProcedure_s_tag)) && (O7_REF(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->type)->_.type != NULL) && (O7_REF(O7_REF(O7_REF(call)->params)->expr)->value_ != NULL)) {
		CallParamsEnd_CalcPredefined(call, O7_REF(O7_REF(O7_REF(call)->params)->expr)->value_, &err);
	}
	return err;
}

static void StatInit(struct Ast_RStatement *s, struct Ast_RExpression *e) {
	NodeInit(&(*O7_REF(s))._, Ast_NoId_cnst);
	O7_REF(s)->expr = e;
	O7_REF(s)->next = NULL;
}

extern int Ast_CallNew(struct Ast_Call_s **c, struct Ast_Designator_s *des) {
	int err;
	struct Ast_ExprCall_s *e;

	err = ExprCallCreate(&e, des, false);
	if (err == Ast_ErrNo_cnst) {
		err = Ast_DesignatorUsed(des, false, false);
	}
	O7_NEW(&(*c), Ast_Call_s);
	StatInit(&(*c)->_, &e->_._);
	return err;
}

extern int Ast_CallBeginGet(struct Ast_Call_s **call, struct Ast_RModule *m, o7_bool acceptParams, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	struct Ast_RDeclaration *d;
	struct Ast_Designator_s *des;
	int err;

	d = SearchName(O7_REF(m)->_.start, name_len0, name, begin, end);
	if (d == NULL) {
		err = Ast_ErrDeclarationNotFound_cnst;
	} else if (!o7_bl(O7_REF(d)->mark)) {
		err = Ast_ErrDeclarationIsPrivate_cnst;
	} else if (!(o7_is(d, Ast_RProcedure_tag))) {
		err = Ast_ErrDeclarationNotProc_cnst;
	} else if (O7_REF(O7_GUARD(Ast_RProcedure, &d)->_.header)->_._._.type != NULL) {
		err = Ast_ErrProcNotCommandHaveReturn_cnst;
	} else if (O7_REF(O7_GUARD(Ast_RProcedure, &d)->_.header)->params != NULL) {
		err = Ast_ErrProcNotCommandHaveParams_cnst;
	} else {
		err = Ast_DesignatorNew(&des, d);
		if (err == Ast_ErrNo_cnst) {
			err = Ast_CallNew(&(*call), des);
		}
	}
	return err;
}

extern int Ast_CommandGet(struct Ast_Call_s **call, struct Ast_RModule *m, int name_len0, o7_char name[/*len0*/], int begin, int end) {
	return Ast_CallBeginGet(&(*call), m, false, name_len0, name, begin, end);
}

extern int Ast_IfNew(struct Ast_If_s **if_, struct Ast_RExpression *expr, struct Ast_RStatement *stats) {
	int err;

	O7_NEW(&(*if_), Ast_If_s);
	StatInit(&(*if_)->_._, expr);
	O7_REF((*if_))->_.stats = stats;
	O7_REF((*if_))->_.elsif = NULL;
	if ((expr != NULL) && (o7_cmp(O7_REF(O7_REF(expr)->type)->_._.id, Ast_IdBoolean_cnst) != 0)) {
		err = Ast_ErrNotBoolInIfCondition_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

static void CheckCondition(int *err, struct Ast_RExpression *expr, int adder) {
	(*err) = Ast_ErrNo_cnst;
	if (expr != NULL) {
		if (o7_cmp(O7_REF(O7_REF(expr)->type)->_._.id, Ast_IdBoolean_cnst) != 0) {
			(*err) = o7_add(Ast_ErrNotBoolInWhileCondition_cnst, adder);
		} else if (O7_REF(expr)->value_ != NULL) {
			(*err) = o7_sub(o7_add(Ast_ErrWhileConditionAlwaysFalse_cnst, adder), (int)o7_bl(O7_GUARD(Ast_ExprBoolean_s, &O7_REF(expr)->value_)->bool_));
		}
	}
}

extern int Ast_WhileNew(struct Ast_While_s **w, struct Ast_RExpression *expr, struct Ast_RStatement *stats) {
	int err;

	O7_NEW(&(*w), Ast_While_s);
	StatInit(&(*w)->_._, expr);
	O7_REF((*w))->_.stats = stats;
	O7_REF((*w))->_.elsif = NULL;
	CheckCondition(&err, expr, 0);
	return err;
}

extern int Ast_RepeatNew(struct Ast_Repeat_s **r, struct Ast_RStatement *stats) {
	O7_NEW(&(*r), Ast_Repeat_s);
	StatInit(&(*r)->_, NULL);
	O7_REF((*r))->stats = stats;
	return Ast_ErrNo_cnst;
}

extern int Ast_RepeatSetUntil(struct Ast_Repeat_s *r, struct Ast_RExpression *e) {
	int err;

	O7_ASSERT(O7_REF(r)->_.expr == NULL);
	O7_REF(r)->_.expr = e;
	CheckCondition(&err, e, Ast_ErrNotBoolInUntil_cnst - Ast_ErrNotBoolInWhileCondition_cnst);
	return err;
}

extern int Ast_ForSetBy(struct Ast_For_s *for_, struct Ast_RExpression *by) {
	int err, init, to;

	err = Ast_ErrNo_cnst;
	if ((by != NULL) && (O7_REF(by)->value_ != NULL) && (o7_cmp(O7_REF(O7_REF(by)->type)->_._.id, Ast_IdInteger_cnst) == 0)) {
		O7_REF(for_)->by = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(by)->value_)->int_);
		if (o7_cmp(O7_REF(for_)->by, 0) == 0) {
			err = Ast_ErrForByZero_cnst;
		}
	} else {
		O7_REF(for_)->by = 1;
		if (by != NULL) {
			err = Ast_ErrExpectConstIntExpr_cnst;
		}
	}
	if ((err == Ast_ErrNo_cnst) && (O7_REF(for_)->_.expr != NULL) && (O7_REF(O7_REF(for_)->_.expr)->value_ != NULL) && (o7_is(O7_REF(O7_REF(for_)->_.expr)->value_, Ast_RExprInteger_tag)) && (O7_REF(for_)->to != NULL) && (O7_REF(O7_REF(for_)->to)->value_ != NULL) && (o7_is(O7_REF(O7_REF(for_)->to)->value_, Ast_RExprInteger_tag))) {
		init = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(for_)->_.expr)->value_)->int_);
		to = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(for_)->to)->value_)->int_);
		if ((init < to) && (o7_cmp(O7_REF(for_)->by, 0) < 0)) {
			err = Ast_ErrByShouldBePositive_cnst;
		} else if ((init > to) && (o7_cmp(O7_REF(for_)->by, 0) > 0)) {
			err = Ast_ErrByShouldBeNegative_cnst;
		} else if ((o7_cmp(O7_REF(for_)->by, 0) > 0) && (o7_sub(TypeLimits_IntegerMax_cnst, O7_REF(for_)->by) < to) || (o7_cmp(O7_REF(for_)->by, 0) < 0) && (o7_sub(TypeLimits_IntegerMin_cnst, O7_REF(for_)->by) > to)) {
			err = Ast_ErrForPossibleOverflow_cnst;
		}
	}
	return err;
}

extern int Ast_ForSetTo(struct Ast_For_s *for_, struct Ast_RExpression *to) {
	int err;

	if ((to != NULL) && (o7_cmp(O7_REF(O7_REF(to)->type)->_._.id, Ast_IdInteger_cnst) != 0)) {
		err = Ast_ErrExpectIntExpr_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	O7_REF(for_)->to = to;
	return err;
}

extern int Ast_ForNew(struct Ast_For_s **f, struct Ast_RVar *var_, struct Ast_RExpression *init, struct Ast_RExpression *to, int by, struct Ast_RStatement *stats) {
	int err;

	O7_NEW(&(*f), Ast_For_s);
	StatInit(&(*f)->_, init);
	O7_REF((*f))->var_ = var_;

	O7_REF(O7_REF(var_)->state)->inited = (1u << Ast_InitedValue_cnst);
	O7_REF(O7_REF(var_)->state)->used = true;

	O7_REF(var_)->_.used = true;
	err = Ast_ForSetTo((*f), to);
	O7_REF((*f))->by = by;
	O7_REF((*f))->stats = stats;
	return err;
}

extern int Ast_CaseNew(struct Ast_Case_s **case_, struct Ast_RExpression *expr) {
	int err;

	O7_NEW(&(*case_), Ast_Case_s);
	StatInit(&(*case_)->_, expr);
	O7_REF((*case_))->elements = NULL;
	O7_REF((*case_))->else_ = NULL;
	if ((O7_REF(expr)->type != NULL) && !(o7_in(O7_REF(O7_REF(expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdChar_cnst))))) {
		err = Ast_ErrCaseExprNotIntOrChar_cnst;
	} else {
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_CaseElseSet(struct Ast_Case_s *case_, struct Ast_RStatement *else_) {
	int err;

	if (O7_REF(case_)->else_ != NULL) {
		err = Ast_ErrCaseElseAlreadyExist_cnst;
	} else {
		O7_REF(case_)->else_ = else_;
		err = Ast_ErrNo_cnst;
	}
	return err;
}

extern int Ast_CaseLabelNew(struct Ast_CaseLabel_s **label, int id, int value_) {
	O7_ASSERT(o7_in(id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdChar_cnst))));

	O7_NEW(&(*label), Ast_CaseLabel_s);
	NodeInit(&(*O7_REF((*label)))._, id);
	O7_REF((*label))->qual = NULL;
	O7_REF((*label))->value_ = value_;
	O7_REF((*label))->right = NULL;
	O7_REF((*label))->next = NULL;
	return Ast_ErrNo_cnst;
}

extern int Ast_CaseLabelQualNew(struct Ast_CaseLabel_s **label, struct Ast_RDeclaration *decl) {
	int err, i;

	(*label) = NULL;
	O7_REF(decl)->used = true;
	if (o7_cmp(O7_REF(decl)->_.id, Ast_IdError_cnst) == 0) {
		err = Ast_ErrNo_cnst;
	} else if (!(o7_is(decl, Ast_Const_s_tag))) {
		err = Ast_ErrCaseLabelNotConst_cnst;
	} else if (!(o7_in(O7_REF(O7_REF(O7_GUARD(Ast_Const_s, &decl)->expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdChar_cnst)))) && !((o7_is(O7_GUARD(Ast_Const_s, &decl)->expr, Ast_ExprString_s_tag)) && (o7_cmp(O7_GUARD(Ast_ExprString_s, &O7_GUARD(Ast_Const_s, &decl)->expr)->_.int_,  - 1) > 0))) {
		err = Ast_ErrCaseLabelNotIntOrChar_cnst;
	} else if (o7_cmp(O7_REF(O7_REF(O7_GUARD(Ast_Const_s, &decl)->expr)->type)->_._.id, Ast_IdInteger_cnst) == 0) {
		err = Ast_CaseLabelNew(&(*label), Ast_IdInteger_cnst, O7_GUARD(Ast_RExprInteger, &O7_REF(O7_GUARD(Ast_Const_s, &decl)->expr)->value_)->int_);
	} else {
		i = o7_int(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_GUARD(Ast_Const_s, &decl)->expr)->value_)->int_);
		if (i < 0) {
			O7_ASSERT(false);
		}
		err = Ast_CaseLabelNew(&(*label), Ast_IdChar_cnst, i);
	}
	if ((*label) == NULL) {
		err = o7_add(err, o7_mul(Ast_CaseLabelNew(&(*label), Ast_IdInteger_cnst, 0), 0));
	}
	return err;
}

extern int Ast_CaseRangeNew(struct Ast_CaseLabel_s *left, struct Ast_CaseLabel_s *right) {
	int err;

	O7_ASSERT((O7_REF(left)->right == NULL) && (O7_REF(left)->next == NULL));
	O7_ASSERT((right == NULL) || (O7_REF(right)->right == NULL) && (O7_REF(right)->next == NULL));

	O7_REF(left)->right = right;

	err = Ast_ErrNo_cnst;
	if (right == NULL) {
	} else if (o7_cmp(O7_REF(left)->_.id, O7_REF(right)->_.id) != 0) {
		err = Ast_ErrCaseRangeLabelsTypeMismatch_cnst;
	} else if (o7_cmp(O7_REF(left)->value_, O7_REF(right)->value_) >= 0) {
		err = Ast_ErrCaseLabelLeftNotLessRight_cnst;
	}
	return err;
}

static o7_bool IsRangesCross(struct Ast_CaseLabel_s *l1, struct Ast_CaseLabel_s *l2) {
	o7_bool cross;

	if (o7_cmp(O7_REF(l1)->value_, O7_REF(l2)->value_) < 0) {
		cross = (O7_REF(l1)->right != NULL) && (o7_cmp(O7_REF(O7_REF(l1)->right)->value_, O7_REF(l2)->value_) >= 0);
	} else {
		cross = (o7_cmp(O7_REF(l1)->value_, O7_REF(l2)->value_) == 0) || (O7_REF(l2)->right != NULL) && (o7_cmp(O7_REF(O7_REF(l2)->right)->value_, O7_REF(l1)->value_) >= 0);
	}
	Log_Str(14, (o7_char *)"IsRangesCross ");
	Log_Bool(cross);
	Log_Ln();
	return cross;
}

static o7_bool IsListCrossRange(struct Ast_CaseLabel_s *list, struct Ast_CaseLabel_s *range) {
	while ((list != NULL) && !IsRangesCross(list, range)) {
		list = O7_REF(list)->next;
	}
	Log_Str(17, (o7_char *)"IsListCrossRange ");
	Log_Bool(list != NULL);
	Log_Ln();
	return list != NULL;
}

static o7_bool IsElementsCrossRange(struct Ast_CaseElement_s *elem, struct Ast_CaseLabel_s *range) {
	while ((elem != NULL) && !IsListCrossRange(O7_REF(elem)->labels, range)) {
		elem = O7_REF(elem)->next;
	}
	Log_Str(21, (o7_char *)"IsElementsCrossRange ");
	Log_Bool(elem != NULL);
	Log_Ln();
	return elem != NULL;
}

extern int Ast_CaseRangeListAdd(struct Ast_Case_s *case_, struct Ast_CaseLabel_s *first, struct Ast_CaseLabel_s *new_) {
	int err;

	O7_ASSERT(O7_REF(new_)->next == NULL);
	O7_ASSERT(O7_REF(case_)->else_ == NULL);
	if ((o7_cmp(O7_REF(O7_REF(O7_REF(case_)->_.expr)->type)->_._.id, O7_REF(new_)->_.id) != 0) && !((o7_in(O7_REF(O7_REF(O7_REF(case_)->_.expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdByte_cnst)))) && (o7_in(O7_REF(new_)->_.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdByte_cnst)))))) {
		err = Ast_ErrCaseRangeLabelsTypeMismatch_cnst;
	} else {
		if (IsElementsCrossRange(O7_REF(case_)->elements, new_)) {
			err = Ast_ErrCaseElemDuplicate_cnst;
		} else {
			err = Ast_ErrNo_cnst;
		}

		if (first != NULL) {
			while (O7_REF(first)->next != NULL) {
				if (IsListCrossRange(first, new_)) {
					err = Ast_ErrCaseElemDuplicate_cnst;
				}
				first = O7_REF(first)->next;
			}
			if (IsListCrossRange(first, new_)) {
				err = Ast_ErrCaseElemDuplicate_cnst;
			}
			O7_REF(first)->next = new_;
		}
	}
	return err;
}

extern struct Ast_CaseElement_s *Ast_CaseElementNew(struct Ast_CaseLabel_s *labels) {
	struct Ast_CaseElement_s *elem;

	O7_NEW(&elem, Ast_CaseElement_s);
	NodeInit(&(*O7_REF(elem))._, Ast_NoId_cnst);
	O7_REF(elem)->next = NULL;
	O7_REF(elem)->labels = labels;
	O7_REF(elem)->stats = NULL;
	return elem;
}

extern int Ast_CaseElementAdd(struct Ast_Case_s *case_, struct Ast_CaseElement_s *elem) {
	int err;
	struct Ast_CaseElement_s *last;

	O7_ASSERT(O7_REF(case_)->else_ == NULL);
	if (O7_REF(case_)->elements == NULL) {
		O7_REF(case_)->elements = elem;
	} else {
		last = O7_REF(case_)->elements;
		while (O7_REF(last)->next != NULL) {
			last = O7_REF(last)->next;
		}
		O7_REF(last)->next = elem;
	}
	err = Ast_ErrNo_cnst;
	return err;
}

extern int Ast_AssignNew(struct Ast_Assign_s **a, o7_bool inLoops, struct Ast_Designator_s *des, struct Ast_RExpression *expr) {
	int err;
	struct Ast_RVar *var_;

	O7_NEW(&(*a), Ast_Assign_s);
	StatInit(&(*a)->_, expr);
	O7_REF((*a))->designator = des;
	err = Ast_ErrNo_cnst;
	if (des != NULL) {
		if ((o7_is(O7_REF(des)->decl, Ast_RVar_tag)) && Ast_IsChangeable(des)) {
			var_ = O7_GUARD(Ast_RVar, &O7_REF(des)->decl);
			if (o7_cmp(O7_REF(O7_REF(var_)->_.type)->_._.id, Ast_IdPointer_cnst) == 0) {
				if ((O7_REF(des)->sel != NULL) && (!(!!( (1u << Ast_InitedValue_cnst) & O7_REF(O7_REF(var_)->state)->inited)) || !o7_bl(O7_REF(O7_REF(var_)->state)->inCondition) && (0 != (O7_REF(O7_REF(var_)->state)->inited & ((1u << Ast_InitedNo_cnst) | (1u << Ast_InitedNil_cnst))))) && !inLoops) {
					err = Ast_ErrVarUninitialized_cnst;
				}
				O7_REF(var_)->_.used = true;
			}

			if ((O7_REF(des)->sel == NULL) && ((O7_REF(var_)->_.up != NULL) && (O7_REF(O7_REF(var_)->_.up)->_.up != NULL) || (o7_is(var_, Ast_FormalParam_s_tag))) && (expr != NULL) && (O7_REF(expr)->value_ != NULL) && (O7_REF(expr)->value_ == &Ast_ExprNilGet()->_)) {
				O7_REF(O7_REF(var_)->state)->inited = (1u << Ast_InitedNil_cnst);
			} else {
				O7_REF(O7_REF(var_)->state)->inited = (1u << Ast_InitedValue_cnst);
			}
			O7_REF(des)->inited = O7_REF(O7_REF(var_)->state)->inited;
		} else {
			err = Ast_ErrAssignExpectVarParam_cnst;
		}

		if ((expr != NULL) && !Ast_CompatibleTypes(&O7_REF((*a))->distance, O7_REF(des)->_._.type, O7_REF(expr)->type) && !CompatibleAsCharAndString(O7_REF(des)->_._.type, &O7_REF((*a))->_.expr)) {
			if (!CompatibleAsIntAndByte(O7_REF(des)->_._.type, O7_REF(expr)->type)) {
				Out_Int(O7_REF(O7_REF(des)->_._.type)->_._.id, 0);
				Out_String(1, (o7_char *)"\x20");
				Out_Int(O7_REF(O7_REF(expr)->type)->_._.id, 0);
				Out_Ln();
				err = Ast_ErrAssignIncompatibleType_cnst;
			} else if ((o7_cmp(O7_REF(O7_REF(des)->_._.type)->_._.id, Ast_IdByte_cnst) == 0) && (O7_REF(expr)->value_ != NULL) && !TypeLimits_InByteRange(O7_GUARD(Ast_RExprInteger, &O7_REF(expr)->value_)->int_)) {
				err = Ast_ErrValueOutOfRangeOfByte_cnst;
			}
		}
	}
	return err;
}

extern struct Ast_StatementError_s *Ast_StatementErrorNew(void) {
	struct Ast_StatementError_s *s;

	O7_NEW(&s, Ast_StatementError_s);
	StatInit(&s->_, NULL);
	return s;
}

static void PredefinedDeclarationsInit(void);
static void PredefinedDeclarationsInit_TypeNew(int s, int t) {
	struct Ast_RType *td;

	O7_NEW(&td, Ast_RType);
	TInit(td, t);

	predefined[o7_ind(Scanner_PredefinedLast_cnst - Scanner_PredefinedFirst_cnst + 1, o7_sub(s, Scanner_PredefinedFirst_cnst))] = (&(td)->_);
	types[o7_ind(Ast_PredefinedTypesCount_cnst, t)] = td;
}

static struct Ast_RProcType *PredefinedDeclarationsInit_ProcNew(int s, int t) {
	struct Ast_PredefinedProcedure_s *td;

	O7_NEW(&td, Ast_PredefinedProcedure_s);
	NodeInit(&(*O7_REF(td))._._._._, s);
	DeclInit(&td->_._._, NULL);
	predefined[o7_ind(Scanner_PredefinedLast_cnst - Scanner_PredefinedFirst_cnst + 1, o7_sub(s, Scanner_PredefinedFirst_cnst))] = (&(td)->_._._);
	O7_REF(td)->_.header = Ast_ProcTypeNew(false);
	O7_REF(td)->_._._.type = (&(O7_REF(td)->_.header)->_._);
	if (t > Ast_NoId_cnst) {
		O7_REF(O7_REF(td)->_.header)->_._._.type = Ast_TypeGet(t);
	}
	return O7_REF(td)->_.header;
}

static void PredefinedDeclarationsInit(void) {
	struct Ast_RProcType *tp;
	struct Ast_RType *typeInt, *typeReal;

	PredefinedDeclarationsInit_TypeNew(Scanner_Byte_cnst, Ast_IdByte_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Integer_cnst, Ast_IdInteger_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_LongInt_cnst, Ast_IdLongInt_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Char_cnst, Ast_IdChar_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Set_cnst, Ast_IdSet_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_LongSet_cnst, Ast_IdLongSet_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Boolean_cnst, Ast_IdBoolean_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Real_cnst, Ast_IdReal_cnst);
	PredefinedDeclarationsInit_TypeNew(Scanner_Real32_cnst, Ast_IdReal32_cnst);
	O7_NEW(&types[Ast_IdPointer_cnst], Ast_RType);
	NodeInit(&(*O7_REF(types[Ast_IdPointer_cnst]))._._, Ast_IdPointer_cnst);
	DeclInit(&types[Ast_IdPointer_cnst]->_, NULL);

	typeInt = Ast_TypeGet(Ast_IdInteger_cnst);
	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Abs_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Asr_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Assert_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, Ast_TypeGet(Ast_IdBoolean_cnst), (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Chr_cnst, Ast_IdChar_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Dec_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, typeInt, ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Excl_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, Ast_TypeGet(Ast_IdSet_cnst), ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	typeReal = Ast_TypeGet(Ast_IdReal_cnst);
	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Floor_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, typeReal, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Flt_cnst, Ast_IdReal_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Inc_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, typeInt, ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Incl_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, Ast_TypeGet(Ast_IdSet_cnst), ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Len_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, &Ast_ArrayGet(typeInt, NULL)->_._, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Lsl_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_New_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, Ast_TypeGet(Ast_IdPointer_cnst), ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Odd_cnst, Ast_IdBoolean_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Ord_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, Ast_TypeGet(Ast_IdChar_cnst), (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Pack_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, typeReal, ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Ror_cnst, Ast_IdInteger_cnst);
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));
	ParamAddPredefined(tp, typeInt, (1u << Ast_ParamIn_cnst));

	tp = PredefinedDeclarationsInit_ProcNew(Scanner_Unpk_cnst, Ast_NoId_cnst);
	ParamAddPredefined(tp, typeReal, ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));
	ParamAddPredefined(tp, typeInt, ((1u << Ast_ParamIn_cnst) | (1u << Ast_ParamOut_cnst)));
}

extern o7_bool Ast_HasError(struct Ast_RModule *m) {
	return O7_REF(m)->errLast != NULL;
}

extern void Ast_ProviderInit(struct Ast_RProvider *p, Ast_Provide get, Ast_Register reg) {
	O7_ASSERT(get != NULL);
	O7_ASSERT(reg != NULL);

	V_Init(&(*O7_REF(p))._);
	O7_REF(p)->get = get;
	O7_REF(p)->reg = reg;
}

extern void Ast_init(void) {
	static int initialized = 0;
	if (0 == initialized) {
		Log_init();
		Out_init();
		Scanner_init();
		StringStore_init();

		o7_tag_init(Ast_RType_tag, Ast_RDeclaration_tag);
		o7_tag_init(Ast_Const_s_tag, Ast_RDeclaration_tag);
		o7_tag_init(Ast_RConstruct_tag, Ast_RType_tag);
		o7_tag_init(Ast_RArray_tag, Ast_RConstruct_tag);
		o7_tag_init(Ast_RVar_tag, Ast_RDeclaration_tag);
		o7_tag_init(Ast_Record_s_tag, Ast_RConstruct_tag);
		o7_tag_init(Ast_RPointer_tag, Ast_RConstruct_tag);
		o7_tag_init(Ast_FormalParam_s_tag, Ast_RVar_tag);
		o7_tag_init(Ast_RProcType_tag, Ast_RConstruct_tag);
		o7_tag_init(FormalProcType_s_tag, Ast_RProcType_tag);
		o7_tag_init(Ast_Import_s_tag, Ast_RDeclaration_tag);
		o7_tag_init(Ast_RModule_tag, Ast_RDeclarations_tag);
		o7_tag_init(Ast_RGeneralProcedure_tag, Ast_RDeclarations_tag);
		o7_tag_init(Ast_RProcedure_tag, Ast_RGeneralProcedure_tag);
		o7_tag_init(Ast_PredefinedProcedure_s_tag, Ast_RGeneralProcedure_tag);
		o7_tag_init(Ast_SelPointer_s_tag, Ast_RSelector_tag);
		o7_tag_init(Ast_SelGuard_s_tag, Ast_RSelector_tag);
		o7_tag_init(Ast_SelArray_s_tag, Ast_RSelector_tag);
		o7_tag_init(Ast_SelRecord_s_tag, Ast_RSelector_tag);
		o7_tag_init(Ast_RFactor_tag, Ast_RExpression_tag);
		o7_tag_init(Ast_Designator_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_RExprInteger_tag, Ast_ExprNumber_tag);
		o7_tag_init(Ast_ExprReal_s_tag, Ast_ExprNumber_tag);
		o7_tag_init(Ast_ExprBoolean_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_ExprString_s_tag, Ast_RExprInteger_tag);
		o7_tag_init(Ast_ExprSet_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_ExprNegate_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_ExprBraces_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_ExprRelation_s_tag, Ast_RExpression_tag);
		o7_tag_init(Ast_ExprIsExtension_s_tag, Ast_RExpression_tag);
		o7_tag_init(Ast_ExprSum_s_tag, Ast_RExpression_tag);
		o7_tag_init(Ast_ExprTerm_s_tag, Ast_RExpression_tag);
		o7_tag_init(Ast_ExprCall_s_tag, Ast_RFactor_tag);
		o7_tag_init(Ast_RWhileIf_tag, Ast_RStatement_tag);
		o7_tag_init(Ast_If_s_tag, Ast_RWhileIf_tag);
		o7_tag_init(Ast_Case_s_tag, Ast_RStatement_tag);
		o7_tag_init(Ast_Repeat_s_tag, Ast_RStatement_tag);
		o7_tag_init(Ast_For_s_tag, Ast_RStatement_tag);
		o7_tag_init(Ast_Assign_s_tag, Ast_RStatement_tag);
		o7_tag_init(Ast_Call_s_tag, Ast_RStatement_tag);

		PredefinedDeclarationsInit();
		booleans[0] = NULL;
		booleans[1] = NULL;
		nil = NULL;
	}
	++initialized;
}

