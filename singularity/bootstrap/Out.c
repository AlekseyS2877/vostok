/* Generated by Vostok - Oberon-07 translator */

#include <stdbool.h>

#define O7_BOOL_UNDEFINED
#include <o7.h>

#include "Out.h"

static o7_bool success;
static o7_char ln[2];
static int lnOfs = O7_INT_UNDEF;

extern void Out_String(int s_len0, o7_char s[/*len0*/]) {
	int i;

	i = 0;
	while ((i < s_len0) && (s[o7_ind(s_len0, i)] != 0x00u)) {
		i = o7_add(i, 1);
	}
	success = i == CFiles_WriteChars(CFiles_out, s_len0, s, 0, i);
}

extern void Out_Char(o7_char ch) {
	o7_char s[1];
	memset(&s, 0, sizeof(s));

	s[0] = ch;
	success = 1 == CFiles_WriteChars(CFiles_out, 1, s, 0, 1);
}

extern void Out_Int(int x, int n) {
	o7_char s[32];
	int i;
	o7_bool neg;
	memset(&s, 0, sizeof(s));

	i = O7_LEN(s);
	neg = false;
	if (x == 0) {
		i = o7_sub(i, 1);
		s[o7_ind(32, i)] = (o7_char)'0';
	} else {
		if (x < 0) {
			neg = true;
			x = o7_sub(0, x);
		}
		while (x != 0) {
			i = o7_sub(i, 1);
			s[o7_ind(32, i)] = o7_chr(o7_add((int)(o7_char)'0', o7_mod(x, 10)));
			x = o7_div(x, 10);
		}
		if (neg) {
			i = o7_sub(i, 1);
			s[o7_ind(32, i)] = (o7_char)'-';
		}
	}
	if (n < 0) {
		n = O7_LEN(s);
	} else if (n > O7_LEN(s)) {
		n = 0;
	} else {
		n = o7_sub(O7_LEN(s), n);
	}
	while (i > n) {
		i = o7_sub(i, 1);
		s[o7_ind(32, i)] = (o7_char)' ';
	}
	success = o7_sub(O7_LEN(s), i) == CFiles_WriteChars(CFiles_out, 32, s, i, o7_sub(O7_LEN(s), i));
}

extern void Out_Ln(void) {
	success = (o7_sub(O7_LEN(ln), lnOfs) == CFiles_WriteChars(CFiles_out, 2, ln, lnOfs, o7_sub(O7_LEN(ln), lnOfs))) && CFiles_Flush(CFiles_out);
}

/* TODO */
extern void Out_Real(double x, int n) {
	o7_char s[64];
	int i, l, e, d;
	o7_bool sign;
	double tens;
	memset(&s, 0, sizeof(s));

	i = O7_LEN(s) / 2;
	if (x != x) {
		l = o7_add(i, 2);
		s[o7_ind(64, i)] = (o7_char)'N';
		s[o7_ind(64, o7_add(i, 1))] = (o7_char)'a';
		s[o7_ind(64, o7_add(i, 2))] = (o7_char)'N';
	} else if ((x == 0.0) || (x == o7_fsub(0, 0.0))) {
		l = o7_add(i, 2);
		s[o7_ind(64, i)] = (o7_char)'0';
		s[o7_ind(64, o7_add(i, 1))] = (o7_char)'.';
		s[o7_ind(64, o7_add(i, 2))] = (o7_char)'0';
		if (x < 0.0) {
			i = o7_sub(i, 1);
			s[o7_ind(64, i)] = (o7_char)'-';
		}
	} else {
		sign = x < 0.0;
		l = i;
		if (sign) {
			s[o7_ind(64, l)] = (o7_char)'-';
			l = o7_add(l, 1);
			x = o7_fsub(0, x);
		}
		if (x < 1.0) {
			e =  - 1;
			tens = 10.0;
			while (o7_fmul(x, tens) < 1.0) {
				e = o7_sub(e, 1);
				tens = o7_fmul(tens, 10.0);
			}
			x = o7_fmul(x, tens);
		} else if (10.0 <= x) {
			e = 1;
			tens = 10.0;
			while ((o7_fdiv(x, tens) >= 10.0) && (e <= 307)) {
				e = o7_add(e, 1);
				tens = o7_fmul(tens, 10.0);
			}
			x = o7_fdiv(x, tens);
		} else {
			O7_ASSERT((1.0 <= x) && (x < 10.0));
			e = 0;
		}
		if (e > 307) {
			s[o7_ind(64, l)] = (o7_char)'i';
			s[o7_ind(64, o7_add(l, 1))] = (o7_char)'n';
			s[o7_ind(64, o7_add(l, 2))] = (o7_char)'f';
			l = o7_add(l, 2);
		} else {
			s[o7_ind(64, l)] = o7_chr(o7_add((int)(o7_char)'0', o7_floor(x)));
			l = o7_add(l, 1);
			s[o7_ind(64, l)] = (o7_char)'.';
			if (o7_mod(o7_floor(o7_fmul(x, 10.0)), 10) == 0) {
				l = o7_add(l, 1);
				s[o7_ind(64, l)] = (o7_char)'0';
			} else {
				while ((l < O7_LEN(s) - 6) && (o7_mod(o7_floor(o7_fmul(x, 10.0)), 10) != 0)) {
					x = o7_fsub(x, o7_flt(o7_mod(o7_floor(x), 10)));
					x = o7_fmul(x, 10.0);
					l = o7_add(l, 1);
					s[o7_ind(64, l)] = o7_chr(o7_add((int)(o7_char)'0', o7_mod(o7_floor(x), 10)));
				}
			}
			if (e != 0) {
				s[o7_ind(64, o7_add(l, 1))] = (o7_char)'E';
				l = o7_add(l, 2);
				if (e < 0) {
					e = o7_sub(0, e);
					s[o7_ind(64, l)] = (o7_char)'-';
				} else {
					s[o7_ind(64, l)] = (o7_char)'+';
				}
				d = 100;
				while (e < d) {
					d = o7_div(d, 10);
				}
				do {
					l = o7_add(l, 1);
					s[o7_ind(64, l)] = o7_chr(o7_add((int)(o7_char)'0', o7_div(e, d)));
					e = o7_mod(e, d);
					d = o7_div(d, 10);
				} while (!(d == 0));
			}
		}
	}
	if (o7_add(l, 1) > n) {
		n = o7_sub(o7_add(l, 1), n);
	} else {
		n = 0;
	}
	while (n < i) {
		i = o7_sub(i, 1);
		s[o7_ind(64, i)] = (o7_char)' ';
	}
	success = o7_add(o7_sub(l, i), 1) == CFiles_WriteChars(CFiles_out, 64, s, i, o7_add(o7_sub(l, i), 1));
}

extern void Out_LongReal(double x, int n) {
	Out_Real(x, n);
}

extern void Out_Open(void) {
	success = true;
}

extern void Out_init(void) {
	static int initialized = 0;
	if (0 == initialized) {
		CFiles_init();
		Platform_init();

		ln[0] = 0x0Du;
		ln[1] = 0x0Au;
		lnOfs = (int)o7_bl(Platform_Posix);
	}
	++initialized;
}

