/* Generated by Vostok - Oberon-07 translator */

#include <stdbool.h>

#define O7_BOOL_UNDEFINED
#include <o7.h>

#include "GeneratorC.h"

#define Interface_cnst 1
#define Implementation_cnst 0

o7_tag_t GeneratorC_MemoryOut_tag;
extern void GeneratorC_MemoryOut_undef(struct GeneratorC_MemoryOut *r) {
	VDataStream_Out_undef(&r->_);
	memset(&r->mem, 0, sizeof(r->mem));
	r->invert = O7_BOOL_UNDEF;
	r->next = NULL;
}
#define GeneratorC_Options_s_tag V_Base_tag
extern void GeneratorC_Options_s_undef(struct GeneratorC_Options_s *r) {
	V_Base_undef(&r->_);
	r->std = O7_INT_UNDEF;
	r->gnu = O7_BOOL_UNDEF;
	r->plan9 = O7_BOOL_UNDEF;
	r->procLocal = O7_BOOL_UNDEF;
	r->checkIndex = O7_BOOL_UNDEF;
	r->vla = O7_BOOL_UNDEF;
	r->vlaMark = O7_BOOL_UNDEF;
	r->checkArith = O7_BOOL_UNDEF;
	r->caseAbort = O7_BOOL_UNDEF;
	r->checkNil = O7_BOOL_UNDEF;
	r->o7Assert = O7_BOOL_UNDEF;
	r->skipUnusedTag = O7_BOOL_UNDEF;
	r->comment = O7_BOOL_UNDEF;
	r->generatorNote = O7_BOOL_UNDEF;
	r->varInit = O7_INT_UNDEF;
	r->memManager = O7_INT_UNDEF;
	r->main_ = O7_BOOL_UNDEF;
	r->index = O7_INT_UNDEF;
	r->records = NULL;
	r->recordLast = NULL;
	r->lastSelectorDereference = O7_BOOL_UNDEF;
	r->expectArray = O7_BOOL_UNDEF;
	r->memOuts = NULL;
}
#define GeneratorC_Generator_tag TextGenerator_Out_tag
extern void GeneratorC_Generator_undef(struct GeneratorC_Generator *r) {
	TextGenerator_Out_undef(&r->_);
	r->module = NULL;
	r->localDeep = O7_INT_UNDEF;
	r->fixedLen = O7_INT_UNDEF;
	r->interface_ = O7_BOOL_UNDEF;
	r->opt = NULL;
	r->expressionSemicolon = O7_BOOL_UNDEF;
	r->insideSizeOf = O7_BOOL_UNDEF;
}

typedef struct MOut {
	struct GeneratorC_Generator g[2];
	struct GeneratorC_Options_s *opt;
} MOut;
#define MOut_tag o7_base_tag

static void MOut_undef(struct MOut *r) {
	o7_int_t i;
	for (i = 0; i < O7_LEN(r->g); i += 1) {
		GeneratorC_Generator_undef(r->g + i);
	}
	r->opt = NULL;
}

typedef struct Selectors {
	struct Ast_Designator_s *des;
	struct Ast_RDeclaration *decl;
	struct Ast_RSelector *list[TranslatorLimits_Selectors_cnst];
	int i;
} Selectors;
#define Selectors_tag o7_base_tag

static void Selectors_undef(struct Selectors *r) {
	r->des = NULL;
	r->decl = NULL;
	memset(&r->list, 0, sizeof(r->list));
	r->i = O7_INT_UNDEF;
}

typedef struct RecExt_s {
	V_Base _;
	struct StringStore_String anonName;
	o7_bool undef;
	struct Ast_Record_s *next;
} *RecExt;
static o7_tag_t RecExt_s_tag;

static void RecExt_s_undef(struct RecExt_s *r) {
	V_Base_undef(&r->_);
	StringStore_String_undef(&r->anonName);
	r->undef = O7_BOOL_UNDEF;
	r->next = NULL;
}

static void (*type)(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, struct Ast_RType *type, o7_bool typeDecl, o7_bool sameType) = NULL;
static void (*declarator)(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, o7_bool typeDecl, o7_bool sameType, o7_bool global) = NULL;
static void (*declarations)(struct MOut *out, struct Ast_RDeclarations *ds) = NULL;
static void (*statements)(struct GeneratorC_Generator *gen, struct Ast_RStatement *stats) = NULL;
static void (*expression)(struct GeneratorC_Generator *gen, struct Ast_RExpression *expr) = NULL;

static void MemoryWrite(struct GeneratorC_MemoryOut *out, int buf_len0, o7_char buf[/*len0*/], int ofs, int count) {
	O7_ASSERT(StringStore_CopyChars(4096, (*out).mem[o7_ind(2, (int)o7_bl((*out).invert))].buf, &(*out).mem[o7_ind(2, (int)o7_bl((*out).invert))].len, buf_len0, buf, ofs, o7_add(ofs, count)));
}

static int MemWrite(struct V_Base *out, o7_tag_t out_tag, int buf_len0, o7_char buf[/*len0*/], int ofs, int count) {
	MemoryWrite(&O7_GUARD_R(GeneratorC_MemoryOut, &(*out), out_tag), buf_len0, buf, ofs, count);
	return count;
}

static struct GeneratorC_MemoryOut *PMemoryOutGet(struct GeneratorC_Options_s *opt) {
	struct GeneratorC_MemoryOut *m;

	if (O7_REF(opt)->memOuts == NULL) {
		O7_NEW(&m, GeneratorC_MemoryOut);
		VDataStream_InitOut(&(*O7_REF(m))._, NULL, MemWrite);
	} else {
		m = O7_REF(opt)->memOuts;
		O7_REF(opt)->memOuts = O7_REF(m)->next;
	}
	O7_REF(m)->mem[0].len = 0;
	O7_REF(m)->mem[1].len = 0;
	O7_REF(m)->invert = false;
	O7_REF(m)->next = NULL;
	return m;
}

static void PMemoryOutBack(struct GeneratorC_Options_s *opt, struct GeneratorC_MemoryOut *m) {
	O7_REF(m)->next = O7_REF(opt)->memOuts;
	O7_REF(opt)->memOuts = m;
}

static void MemWriteInvert(struct GeneratorC_MemoryOut *mo) {
	int inv;

	inv = (int)o7_bl((*mo).invert);
	if (o7_cmp((*mo).mem[o7_ind(2, inv)].len, 0) == 0) {
		(*mo).invert = !o7_bl((*mo).invert);
	} else {
		O7_ASSERT(StringStore_CopyChars(4096, (*mo).mem[o7_ind(2, inv)].buf, &(*mo).mem[o7_ind(2, inv)].len, 4096, (*mo).mem[o7_ind(2, o7_sub(1, inv))].buf, 0, (*mo).mem[o7_ind(2, o7_sub(1, inv))].len));
		(*mo).mem[o7_ind(2, o7_sub(1, inv))].len = 0;
	}
}

static void MemWriteDirect(struct GeneratorC_Generator *gen, struct GeneratorC_MemoryOut *mo) {
	int inv;

	inv = (int)o7_bl((*mo).invert);
	O7_ASSERT(o7_cmp((*mo).mem[o7_ind(2, o7_sub(1, inv))].len, 0) == 0);
	TextGenerator_Data(&(*gen)._, 4096, (*mo).mem[o7_ind(2, inv)].buf, 0, (*mo).mem[o7_ind(2, inv)].len);
	(*mo).mem[o7_ind(2, inv)].len = 0;
}

static o7_bool Eq(struct StringStore_String *name, int str_len0, o7_char str[/*len0*/]) {
	return StringStore_IsEqualToString(&(*name), str_len0, str);
}

static o7_bool IsNameOccupied(struct StringStore_String *n);
static o7_bool IsNameOccupied_CKeyWord(struct StringStore_String *n) {
	o7_bool o;

	{ int o7_case_expr = O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)];
		switch (o7_case_expr) {
		case 97:
			o = Eq(&(*n), 4, (o7_char *)"auto") || Eq(&(*n), 3, (o7_char *)"asm");
			break;
		case 98:
			o = Eq(&(*n), 5, (o7_char *)"break");
			break;
		case 99:
			o = Eq(&(*n), 4, (o7_char *)"case") || Eq(&(*n), 4, (o7_char *)"char") || Eq(&(*n), 5, (o7_char *)"const") || Eq(&(*n), 8, (o7_char *)"continue");
			break;
		case 100:
			o = Eq(&(*n), 7, (o7_char *)"default") || Eq(&(*n), 2, (o7_char *)"do") || Eq(&(*n), 6, (o7_char *)"double");
			break;
		case 101:
			o = Eq(&(*n), 4, (o7_char *)"else") || Eq(&(*n), 4, (o7_char *)"enum") || Eq(&(*n), 6, (o7_char *)"extern");
			break;
		case 102:
			o = Eq(&(*n), 5, (o7_char *)"float") || Eq(&(*n), 3, (o7_char *)"for");
			break;
		case 103:
			o = Eq(&(*n), 4, (o7_char *)"goto");
			break;
		case 105:
			o = Eq(&(*n), 2, (o7_char *)"if") || Eq(&(*n), 6, (o7_char *)"inline") || Eq(&(*n), 3, (o7_char *)"int");
			break;
		case 108:
			o = Eq(&(*n), 4, (o7_char *)"long");
			break;
		case 114:
			o = Eq(&(*n), 8, (o7_char *)"register") || Eq(&(*n), 8, (o7_char *)"restrict") || Eq(&(*n), 6, (o7_char *)"return");
			break;
		case 115:
			o = Eq(&(*n), 5, (o7_char *)"short") || Eq(&(*n), 6, (o7_char *)"signed") || Eq(&(*n), 6, (o7_char *)"sizeof") || Eq(&(*n), 6, (o7_char *)"static") || Eq(&(*n), 6, (o7_char *)"struct") || Eq(&(*n), 6, (o7_char *)"switch");
			break;
		case 116:
			o = Eq(&(*n), 7, (o7_char *)"typedef") || Eq(&(*n), 6, (o7_char *)"typeof");
			break;
		case 117:
			o = Eq(&(*n), 5, (o7_char *)"union") || Eq(&(*n), 8, (o7_char *)"unsigned");
			break;
		case 118:
			o = Eq(&(*n), 4, (o7_char *)"void") || Eq(&(*n), 8, (o7_char *)"volatile");
			break;
		case 119:
			o = Eq(&(*n), 5, (o7_char *)"while");
			break;
		default:
			if ((o7_case_expr == 104) || (o7_case_expr == 106) || (o7_case_expr == 107) || (109 <= o7_case_expr && o7_case_expr <= 113) || (120 <= o7_case_expr && o7_case_expr <= 122)) {
				o = false;
			} else o7_case_fail(o7_case_expr);
			break;
		}
	}
	return o;
}

static o7_bool IsNameOccupied_CLib(struct StringStore_String *n) {
	o7_bool o;

	{ int o7_case_expr = O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)];
		switch (o7_case_expr) {
		case 97:
			o = Eq(&(*n), 5, (o7_char *)"abort") || Eq(&(*n), 6, (o7_char *)"assert") || Eq(&(*n), 4, (o7_char *)"atof") || Eq(&(*n), 4, (o7_char *)"atoi") || Eq(&(*n), 4, (o7_char *)"atol") || Eq(&(*n), 5, (o7_char *)"atoll") || Eq(&(*n), 3, (o7_char *)"abs") || Eq(&(*n), 6, (o7_char *)"atexit");
			break;
		case 98:
			o = Eq(&(*n), 4, (o7_char *)"bool") || Eq(&(*n), 7, (o7_char *)"bsearch");
			break;
		case 99:
			o = Eq(&(*n), 6, (o7_char *)"calloc");
			break;
		case 100:
			o = Eq(&(*n), 3, (o7_char *)"div");
			break;
		case 101:
			o = Eq(&(*n), 5, (o7_char *)"errno") || Eq(&(*n), 4, (o7_char *)"exit");
			break;
		case 102:
			o = Eq(&(*n), 4, (o7_char *)"free") || Eq(&(*n), 5, (o7_char *)"fputc") || Eq(&(*n), 5, (o7_char *)"fputs");
			break;
		case 103:
			o = Eq(&(*n), 6, (o7_char *)"getenv");
			break;
		case 108:
			o = Eq(&(*n), 4, (o7_char *)"labs") || Eq(&(*n), 4, (o7_char *)"ldiv") || Eq(&(*n), 5, (o7_char *)"llabs") || Eq(&(*n), 5, (o7_char *)"lldiv");
			break;
		case 109:
			o = Eq(&(*n), 4, (o7_char *)"main") || Eq(&(*n), 6, (o7_char *)"malloc") || Eq(&(*n), 6, (o7_char *)"memchr") || Eq(&(*n), 6, (o7_char *)"memcmp") || Eq(&(*n), 6, (o7_char *)"memcpy") || Eq(&(*n), 6, (o7_char *)"memset") || Eq(&(*n), 5, (o7_char *)"mblen") || Eq(&(*n), 6, (o7_char *)"mbtowc") || Eq(&(*n), 8, (o7_char *)"mbstowcs");
			break;
		case 112:
			o = Eq(&(*n), 4, (o7_char *)"putc") || Eq(&(*n), 7, (o7_char *)"putchar") || Eq(&(*n), 4, (o7_char *)"puts");
			break;
		case 113:
			o = Eq(&(*n), 5, (o7_char *)"qsort");
			break;
		case 114:
			o = Eq(&(*n), 4, (o7_char *)"rand") || Eq(&(*n), 7, (o7_char *)"realloc");
			break;
		case 115:
			o = Eq(&(*n), 7, (o7_char *)"strcspn") || Eq(&(*n), 8, (o7_char *)"strerror") || Eq(&(*n), 6, (o7_char *)"strspn") || Eq(&(*n), 7, (o7_char *)"strrchr") || Eq(&(*n), 7, (o7_char *)"strpbrk") || Eq(&(*n), 6, (o7_char *)"strchr") || Eq(&(*n), 6, (o7_char *)"strcat") || Eq(&(*n), 6, (o7_char *)"strstr") || Eq(&(*n), 7, (o7_char *)"strncat") || Eq(&(*n), 6, (o7_char *)"strcmp") || Eq(&(*n), 7, (o7_char *)"strcoll") || Eq(&(*n), 6, (o7_char *)"strcpy") || Eq(&(*n), 7, (o7_char *)"strncpy") || Eq(&(*n), 6, (o7_char *)"strlen") || Eq(&(*n), 6, (o7_char *)"strtok") || Eq(&(*n), 6, (o7_char *)"strtol") || Eq(&(*n), 7, (o7_char *)"strtoll") || Eq(&(*n), 7, (o7_char *)"strtoul") || Eq(&(*n), 8, (o7_char *)"strtoull") || Eq(&(*n), 6, (o7_char *)"strtod") || Eq(&(*n), 6, (o7_char *)"strtof") || Eq(&(*n), 7, (o7_char *)"strtold") || Eq(&(*n), 7, (o7_char *)"strxfrm") || Eq(&(*n), 5, (o7_char *)"srand") || Eq(&(*n), 6, (o7_char *)"system");
			break;
		case 119:
			o = Eq(&(*n), 6, (o7_char *)"wctomb") || Eq(&(*n), 8, (o7_char *)"wcstombs");
			break;
		default:
			if ((o7_case_expr == 104) || (105 <= o7_case_expr && o7_case_expr <= 107) || (110 <= o7_case_expr && o7_case_expr <= 111) || (116 <= o7_case_expr && o7_case_expr <= 118) || (120 <= o7_case_expr && o7_case_expr <= 122)) {
				o = false;
			} else o7_case_fail(o7_case_expr);
			break;
		}
	}
	return o;
}

static o7_bool IsNameOccupied_CMath(struct StringStore_String *n) {
	o7_bool o;

	{ int o7_case_expr = O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)];
		switch (o7_case_expr) {
		case 97:
			o = Eq(&(*n), 4, (o7_char *)"acos") || Eq(&(*n), 5, (o7_char *)"acosf") || Eq(&(*n), 5, (o7_char *)"acosl") || Eq(&(*n), 5, (o7_char *)"acosh") || Eq(&(*n), 6, (o7_char *)"acoshf") || Eq(&(*n), 6, (o7_char *)"acoshl") || Eq(&(*n), 4, (o7_char *)"asin") || Eq(&(*n), 5, (o7_char *)"asinf") || Eq(&(*n), 5, (o7_char *)"asinl") || Eq(&(*n), 5, (o7_char *)"asinh") || Eq(&(*n), 6, (o7_char *)"asinhf") || Eq(&(*n), 6, (o7_char *)"asinhl") || Eq(&(*n), 4, (o7_char *)"atan") || Eq(&(*n), 5, (o7_char *)"atanf") || Eq(&(*n), 5, (o7_char *)"atanl") || Eq(&(*n), 5, (o7_char *)"atan2") || Eq(&(*n), 6, (o7_char *)"atan2f") || Eq(&(*n), 6, (o7_char *)"atan2l") || Eq(&(*n), 5, (o7_char *)"atanh") || Eq(&(*n), 6, (o7_char *)"atanhf") || Eq(&(*n), 6, (o7_char *)"atanhl");
			break;
		case 99:
			o = Eq(&(*n), 4, (o7_char *)"cbrt") || Eq(&(*n), 5, (o7_char *)"cbrtf") || Eq(&(*n), 5, (o7_char *)"cbrtl") || Eq(&(*n), 4, (o7_char *)"ceil") || Eq(&(*n), 5, (o7_char *)"ceilf") || Eq(&(*n), 5, (o7_char *)"ceill") || Eq(&(*n), 8, (o7_char *)"copysign") || Eq(&(*n), 9, (o7_char *)"copysignf") || Eq(&(*n), 9, (o7_char *)"copysignl") || Eq(&(*n), 3, (o7_char *)"cos") || Eq(&(*n), 4, (o7_char *)"cosf") || Eq(&(*n), 4, (o7_char *)"cosl") || Eq(&(*n), 4, (o7_char *)"cosh") || Eq(&(*n), 5, (o7_char *)"coshf") || Eq(&(*n), 5, (o7_char *)"coshl");
			break;
		case 101:
			o = Eq(&(*n), 3, (o7_char *)"erf") || Eq(&(*n), 4, (o7_char *)"erff") || Eq(&(*n), 4, (o7_char *)"erfl") || Eq(&(*n), 4, (o7_char *)"erfc") || Eq(&(*n), 5, (o7_char *)"erfcf") || Eq(&(*n), 5, (o7_char *)"erfcl") || Eq(&(*n), 3, (o7_char *)"exp") || Eq(&(*n), 4, (o7_char *)"expf") || Eq(&(*n), 4, (o7_char *)"expl") || Eq(&(*n), 4, (o7_char *)"exp2") || Eq(&(*n), 5, (o7_char *)"exp2f") || Eq(&(*n), 5, (o7_char *)"exp2l") || Eq(&(*n), 5, (o7_char *)"expm1") || Eq(&(*n), 6, (o7_char *)"expm1f") || Eq(&(*n), 6, (o7_char *)"expm1l");
			break;
		case 102:
			o = Eq(&(*n), 4, (o7_char *)"fabs") || Eq(&(*n), 5, (o7_char *)"fabsf") || Eq(&(*n), 5, (o7_char *)"fabsl") || Eq(&(*n), 4, (o7_char *)"fdim") || Eq(&(*n), 5, (o7_char *)"fdimf") || Eq(&(*n), 5, (o7_char *)"fdiml") || Eq(&(*n), 5, (o7_char *)"floor") || Eq(&(*n), 6, (o7_char *)"floorf") || Eq(&(*n), 6, (o7_char *)"floorl") || Eq(&(*n), 4, (o7_char *)"fmax") || Eq(&(*n), 5, (o7_char *)"fmaxf") || Eq(&(*n), 5, (o7_char *)"fmaxl") || Eq(&(*n), 4, (o7_char *)"fmin") || Eq(&(*n), 5, (o7_char *)"fminf") || Eq(&(*n), 5, (o7_char *)"fminl") || Eq(&(*n), 3, (o7_char *)"fma") || Eq(&(*n), 4, (o7_char *)"fmaf") || Eq(&(*n), 4, (o7_char *)"fmal") || Eq(&(*n), 4, (o7_char *)"fmod") || Eq(&(*n), 5, (o7_char *)"fmodf") || Eq(&(*n), 5, (o7_char *)"fmodl") || Eq(&(*n), 10, (o7_char *)"fpclassify") || Eq(&(*n), 5, (o7_char *)"frexp") || Eq(&(*n), 6, (o7_char *)"frexpf") || Eq(&(*n), 6, (o7_char *)"frexpl");
			break;
		case 104:
			o = Eq(&(*n), 5, (o7_char *)"hypot") || Eq(&(*n), 6, (o7_char *)"hypotf") || Eq(&(*n), 6, (o7_char *)"hypotl");
			break;
		case 105:
			o = Eq(&(*n), 5, (o7_char *)"ilogb") || Eq(&(*n), 6, (o7_char *)"ilogbf") || Eq(&(*n), 6, (o7_char *)"ilogbl") || Eq(&(*n), 9, (o7_char *)"isgreater") || Eq(&(*n), 14, (o7_char *)"isgreaterequal") || Eq(&(*n), 8, (o7_char *)"isfinite") || Eq(&(*n), 5, (o7_char *)"isinf") || Eq(&(*n), 6, (o7_char *)"isless") || Eq(&(*n), 11, (o7_char *)"islessequal") || Eq(&(*n), 13, (o7_char *)"islessgreater") || Eq(&(*n), 5, (o7_char *)"isnan") || Eq(&(*n), 8, (o7_char *)"isnormal");
			break;
		case 108:
			o = Eq(&(*n), 5, (o7_char *)"ldexp") || Eq(&(*n), 6, (o7_char *)"ldexpf") || Eq(&(*n), 6, (o7_char *)"ldexpl") || Eq(&(*n), 6, (o7_char *)"lgamma") || Eq(&(*n), 7, (o7_char *)"lgammaf") || Eq(&(*n), 7, (o7_char *)"lgammal") || Eq(&(*n), 3, (o7_char *)"log") || Eq(&(*n), 4, (o7_char *)"logf") || Eq(&(*n), 4, (o7_char *)"logl") || Eq(&(*n), 5, (o7_char *)"log10") || Eq(&(*n), 6, (o7_char *)"log10f") || Eq(&(*n), 6, (o7_char *)"log10l") || Eq(&(*n), 5, (o7_char *)"log1p") || Eq(&(*n), 6, (o7_char *)"log1pf") || Eq(&(*n), 6, (o7_char *)"log1pl") || Eq(&(*n), 4, (o7_char *)"log2") || Eq(&(*n), 5, (o7_char *)"log2f") || Eq(&(*n), 5, (o7_char *)"log2l") || Eq(&(*n), 4, (o7_char *)"logb") || Eq(&(*n), 5, (o7_char *)"logbf") || Eq(&(*n), 5, (o7_char *)"logbl") || Eq(&(*n), 6, (o7_char *)"lround") || Eq(&(*n), 7, (o7_char *)"lroundf") || Eq(&(*n), 7, (o7_char *)"lroundl") || Eq(&(*n), 7, (o7_char *)"llround") || Eq(&(*n), 8, (o7_char *)"llroundf") || Eq(&(*n), 8, (o7_char *)"llroundl") || Eq(&(*n), 5, (o7_char *)"lrint") || Eq(&(*n), 6, (o7_char *)"lrintf") || Eq(&(*n), 6, (o7_char *)"lrintl") || Eq(&(*n), 6, (o7_char *)"llrint") || Eq(&(*n), 7, (o7_char *)"llrintf") || Eq(&(*n), 7, (o7_char *)"llrintl");
			break;
		case 109:
			o = Eq(&(*n), 4, (o7_char *)"modf") || Eq(&(*n), 5, (o7_char *)"modff") || Eq(&(*n), 5, (o7_char *)"modfl");
			break;
		case 110:
			o = Eq(&(*n), 3, (o7_char *)"nan") || Eq(&(*n), 4, (o7_char *)"nanf") || Eq(&(*n), 4, (o7_char *)"nanl") || Eq(&(*n), 9, (o7_char *)"nearbyint") || Eq(&(*n), 10, (o7_char *)"nearbyintf") || Eq(&(*n), 10, (o7_char *)"nearbyintl") || Eq(&(*n), 9, (o7_char *)"nextafter") || Eq(&(*n), 10, (o7_char *)"nextafterf") || Eq(&(*n), 10, (o7_char *)"nextafterl") || Eq(&(*n), 10, (o7_char *)"nexttoward") || Eq(&(*n), 11, (o7_char *)"nexttowardf") || Eq(&(*n), 11, (o7_char *)"nexttowardl");
			break;
		case 112:
			o = Eq(&(*n), 3, (o7_char *)"pow") || Eq(&(*n), 4, (o7_char *)"powf") || Eq(&(*n), 4, (o7_char *)"powl");
			break;
		case 114:
			o = Eq(&(*n), 9, (o7_char *)"remainder") || Eq(&(*n), 10, (o7_char *)"remainderf") || Eq(&(*n), 10, (o7_char *)"remainderl") || Eq(&(*n), 6, (o7_char *)"remquo") || Eq(&(*n), 7, (o7_char *)"remquof") || Eq(&(*n), 7, (o7_char *)"remquol") || Eq(&(*n), 4, (o7_char *)"rint") || Eq(&(*n), 5, (o7_char *)"rintf") || Eq(&(*n), 5, (o7_char *)"rintl") || Eq(&(*n), 5, (o7_char *)"round") || Eq(&(*n), 6, (o7_char *)"roundf") || Eq(&(*n), 6, (o7_char *)"roundl");
			break;
		case 115:
			o = Eq(&(*n), 6, (o7_char *)"scalbn") || Eq(&(*n), 7, (o7_char *)"scalbnf") || Eq(&(*n), 7, (o7_char *)"scalbnl") || Eq(&(*n), 7, (o7_char *)"scalbln") || Eq(&(*n), 8, (o7_char *)"scalblnf") || Eq(&(*n), 8, (o7_char *)"scalblnl") || Eq(&(*n), 7, (o7_char *)"signbit") || Eq(&(*n), 3, (o7_char *)"sin") || Eq(&(*n), 4, (o7_char *)"sinf") || Eq(&(*n), 4, (o7_char *)"sinl") || Eq(&(*n), 4, (o7_char *)"sinh") || Eq(&(*n), 5, (o7_char *)"sinhf") || Eq(&(*n), 5, (o7_char *)"sinhl") || Eq(&(*n), 4, (o7_char *)"sqrt") || Eq(&(*n), 5, (o7_char *)"sqrtf") || Eq(&(*n), 5, (o7_char *)"sqrtl");
			break;
		case 116:
			o = Eq(&(*n), 3, (o7_char *)"tan") || Eq(&(*n), 4, (o7_char *)"tanf") || Eq(&(*n), 4, (o7_char *)"tanl") || Eq(&(*n), 4, (o7_char *)"tanh") || Eq(&(*n), 5, (o7_char *)"tanhf") || Eq(&(*n), 5, (o7_char *)"tanhl") || Eq(&(*n), 6, (o7_char *)"tgamma") || Eq(&(*n), 7, (o7_char *)"tgammaf") || Eq(&(*n), 7, (o7_char *)"tgammal") || Eq(&(*n), 5, (o7_char *)"trunc") || Eq(&(*n), 6, (o7_char *)"truncf") || Eq(&(*n), 6, (o7_char *)"truncl");
			break;
		default:
			if ((o7_case_expr == 98) || (o7_case_expr == 100) || (o7_case_expr == 103) || (o7_case_expr == 106) || (o7_case_expr == 107) || (o7_case_expr == 111) || (o7_case_expr == 113) || (117 <= o7_case_expr && o7_case_expr <= 122)) {
				o = false;
			} else o7_case_fail(o7_case_expr);
			break;
		}
	}
	return o;
}

static o7_bool IsNameOccupied_CMacros(struct StringStore_String *n) {
	return Eq(&(*n), 4, (o7_char *)"unix") || Eq(&(*n), 5, (o7_char *)"linux") || Eq(&(*n), 3, (o7_char *)"BSD");
}

static o7_bool IsNameOccupied_CppKeyWord(struct StringStore_String *n) {
	o7_bool o;

	{ int o7_case_expr = O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)];
		switch (o7_case_expr) {
		case 97:
			o = Eq(&(*n), 5, (o7_char *)"array");
			break;
		case 99:
			o = Eq(&(*n), 5, (o7_char *)"catch") || Eq(&(*n), 5, (o7_char *)"class");
			break;
		case 100:
			o = Eq(&(*n), 8, (o7_char *)"decltype") || Eq(&(*n), 8, (o7_char *)"delegate") || Eq(&(*n), 6, (o7_char *)"delete") || Eq(&(*n), 10, (o7_char *)"deprecated") || Eq(&(*n), 9, (o7_char *)"dllexport") || Eq(&(*n), 9, (o7_char *)"dllimport") || Eq(&(*n), 9, (o7_char *)"dllexport");
			break;
		case 101:
			o = Eq(&(*n), 5, (o7_char *)"event") || Eq(&(*n), 8, (o7_char *)"explicit") || Eq(&(*n), 4, (o7_char *)"each");
			break;
		case 102:
			o = Eq(&(*n), 7, (o7_char *)"finally") || Eq(&(*n), 6, (o7_char *)"friend");
			break;
		case 103:
			o = Eq(&(*n), 5, (o7_char *)"gcnew") || Eq(&(*n), 7, (o7_char *)"generic");
			break;
		case 105:
			o = Eq(&(*n), 2, (o7_char *)"in") || Eq(&(*n), 8, (o7_char *)"initonly") || Eq(&(*n), 9, (o7_char *)"interface");
			break;
		case 108:
			o = Eq(&(*n), 7, (o7_char *)"literal");
			break;
		case 109:
			o = Eq(&(*n), 7, (o7_char *)"mutable");
			break;
		case 110:
			o = Eq(&(*n), 5, (o7_char *)"naked") || Eq(&(*n), 9, (o7_char *)"namespace") || Eq(&(*n), 3, (o7_char *)"new") || Eq(&(*n), 8, (o7_char *)"noinline") || Eq(&(*n), 8, (o7_char *)"noreturn") || Eq(&(*n), 7, (o7_char *)"nothrow") || Eq(&(*n), 8, (o7_char *)"novtable") || Eq(&(*n), 7, (o7_char *)"nullptr");
			break;
		case 111:
			o = Eq(&(*n), 8, (o7_char *)"operator");
			break;
		case 112:
			o = Eq(&(*n), 7, (o7_char *)"private") || Eq(&(*n), 8, (o7_char *)"property") || Eq(&(*n), 9, (o7_char *)"protected") || Eq(&(*n), 6, (o7_char *)"public");
			break;
		case 114:
			o = Eq(&(*n), 3, (o7_char *)"ref");
			break;
		case 115:
			o = Eq(&(*n), 8, (o7_char *)"safecast") || Eq(&(*n), 6, (o7_char *)"sealed") || Eq(&(*n), 9, (o7_char *)"selectany") || Eq(&(*n), 5, (o7_char *)"super");
			break;
		case 116:
			o = Eq(&(*n), 8, (o7_char *)"template") || Eq(&(*n), 4, (o7_char *)"this") || Eq(&(*n), 6, (o7_char *)"thread") || Eq(&(*n), 5, (o7_char *)"throw") || Eq(&(*n), 3, (o7_char *)"try") || Eq(&(*n), 6, (o7_char *)"typeid") || Eq(&(*n), 8, (o7_char *)"typename");
			break;
		case 117:
			o = Eq(&(*n), 4, (o7_char *)"uuid");
			break;
		case 118:
			o = Eq(&(*n), 5, (o7_char *)"value") || Eq(&(*n), 7, (o7_char *)"virtual");
			break;
		default:
			if ((o7_case_expr == 98) || (o7_case_expr == 104) || (o7_case_expr == 106) || (o7_case_expr == 107) || (o7_case_expr == 113) || (119 <= o7_case_expr && o7_case_expr <= 122)) {
				o = false;
			} else o7_case_fail(o7_case_expr);
			break;
		}
	}
	return o;
}

static o7_bool IsNameOccupied_JsKeyWord(struct StringStore_String *n) {
	o7_bool o;

	{ int o7_case_expr = O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)];
		switch (o7_case_expr) {
		case 97:
			o = Eq(&(*n), 8, (o7_char *)"abstract") || Eq(&(*n), 9, (o7_char *)"arguments");
			break;
		case 98:
			o = Eq(&(*n), 7, (o7_char *)"boolean") || Eq(&(*n), 4, (o7_char *)"byte");
			break;
		case 100:
			o = Eq(&(*n), 8, (o7_char *)"debugger");
			break;
		case 101:
			o = Eq(&(*n), 4, (o7_char *)"eval") || Eq(&(*n), 6, (o7_char *)"export") || Eq(&(*n), 7, (o7_char *)"extends");
			break;
		case 102:
			o = Eq(&(*n), 5, (o7_char *)"final") || Eq(&(*n), 8, (o7_char *)"function");
			break;
		case 105:
			o = Eq(&(*n), 10, (o7_char *)"implements") || Eq(&(*n), 6, (o7_char *)"import") || Eq(&(*n), 10, (o7_char *)"instanceof") || Eq(&(*n), 9, (o7_char *)"interface");
			break;
		case 108:
			o = Eq(&(*n), 3, (o7_char *)"let");
			break;
		case 110:
			o = Eq(&(*n), 6, (o7_char *)"native") || Eq(&(*n), 4, (o7_char *)"null");
			break;
		case 112:
			o = Eq(&(*n), 7, (o7_char *)"package") || Eq(&(*n), 7, (o7_char *)"private") || Eq(&(*n), 9, (o7_char *)"protected");
			break;
		case 115:
			o = Eq(&(*n), 12, (o7_char *)"synchronized");
			break;
		case 116:
			o = Eq(&(*n), 6, (o7_char *)"throws") || Eq(&(*n), 9, (o7_char *)"transient");
			break;
		case 118:
			o = Eq(&(*n), 3, (o7_char *)"var");
			break;
		default:
			if ((o7_case_expr == 99) || (o7_case_expr == 103) || (o7_case_expr == 104) || (o7_case_expr == 106) || (o7_case_expr == 107) || (o7_case_expr == 109) || (o7_case_expr == 111) || (o7_case_expr == 113) || (o7_case_expr == 114) || (o7_case_expr == 117) || (119 <= o7_case_expr && o7_case_expr <= 122)) {
				o = false;
			} else o7_case_fail(o7_case_expr);
			break;
		}
	}
	return o;
}

static o7_bool IsNameOccupied_O7(struct StringStore_String *n) {
	return Eq(&(*n), 11, (o7_char *)"initialized") || Eq(&(*n), 4, (o7_char *)"NULL");
}

static o7_bool IsNameOccupied(struct StringStore_String *n) {
	return IsNameOccupied_O7(&(*n)) || ((o7_char)'a' <= O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)]) && (O7_REF((*n).block)->s[o7_ind(StringStore_BlockSize_cnst + 1, (*n).ofs)] <= (o7_char)'z') && (IsNameOccupied_CKeyWord(&(*n)) || IsNameOccupied_CLib(&(*n)) || IsNameOccupied_CMath(&(*n)) || IsNameOccupied_CMacros(&(*n)) || IsNameOccupied_CppKeyWord(&(*n)) || IsNameOccupied_JsKeyWord(&(*n)));
}

static void Name(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl) {
	struct Ast_RDeclarations *up;
	struct Ast_RDeclarations *prs[TranslatorLimits_DeepProcedures_cnst + 1];
	int i;
	memset(&prs, 0, sizeof(prs));

	if ((o7_is(decl, Ast_RType_tag)) && (O7_REF(decl)->up != &O7_REF(decl)->module->_) && (O7_REF(decl)->up != NULL) || !o7_bl(O7_REF((*gen).opt)->procLocal) && (o7_is(decl, Ast_RProcedure_tag))) {
		up = O7_REF(decl)->up;
		i = 0;
		while (O7_REF(up)->_.up != NULL) {
			prs[o7_ind(TranslatorLimits_DeepProcedures_cnst + 1, i)] = up;
			i = o7_add(i, 1);
			up = O7_REF(up)->_.up;
		}
		while (i > 0) {
			i = o7_sub(i, 1);
			TextGenerator_String(&(*gen)._, &O7_REF(prs[o7_ind(TranslatorLimits_DeepProcedures_cnst + 1, i)])->_.name);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5F");
		}
	}
	TextGenerator_String(&(*gen)._, &O7_REF(decl)->name);
	if (o7_is(decl, Ast_Const_s_tag)) {
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)"_cnst");
	} else if (IsNameOccupied(&O7_REF(decl)->name)) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5F");
	}
}

extern o7_bool GeneratorC_IsSpecModuleName(struct StringStore_String *n) {
	return Eq(&(*n), 2, (o7_char *)"O7") || Eq(&(*n), 2, (o7_char *)"o7") || Eq(&(*n), 4, (o7_char *)"math") || Eq(&(*n), 4, (o7_char *)"Math") || Eq(&(*n), 6, (o7_char *)"limits");
}

static void GlobalName(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl) {
	if (o7_bl(O7_REF(decl)->mark) || (O7_REF(decl)->module != NULL) && ((*gen).module != O7_REF(decl)->module)) {
		O7_ASSERT(O7_REF(decl)->module != NULL);
		TextGenerator_String(&(*gen)._, &O7_REF(O7_REF(decl)->module)->_._.name);

		TextGenerator_Data(&(*gen)._, 2, (o7_char *)"__", 0, o7_add((int)(GeneratorC_IsSpecModuleName(&O7_REF(O7_REF(decl)->module)->_._.name) && !o7_bl(O7_REF(O7_REF(decl)->module)->spec) || Eq(&O7_REF(decl)->name, 4, (o7_char *)"init") || Eq(&O7_REF(decl)->name, 4, (o7_char *)"cnst") || Eq(&O7_REF(decl)->name, 3, (o7_char *)"len")), 1));
		TextGenerator_String(&(*gen)._, &O7_REF(decl)->name);
		if (o7_is(decl, Ast_Const_s_tag)) {
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)"_cnst");
		}
	} else {
		Name(&(*gen), decl);
	}
}

static void Import(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl) {
	struct StringStore_String name;
	int i;
	StringStore_String_undef(&name);

	TextGenerator_Str(&(*gen)._, 9, (o7_char *)"#include ");
	TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x22");
	if (o7_is(decl, Ast_RModule_tag)) {
		name = O7_REF(decl)->name;
	} else {
		O7_ASSERT(o7_is(decl, Ast_Import_s_tag));
		name = O7_REF(O7_REF(decl)->module)->_._.name;
	}
	TextGenerator_String(&(*gen)._, &name);
	i = (int)!GeneratorC_IsSpecModuleName(&name);
	TextGenerator_Data(&(*gen)._, 3, (o7_char *)"_.h", i, o7_sub(3, i));
	TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x22");
}

static void Factor(struct GeneratorC_Generator *gen, struct Ast_RExpression *expr) {
	if (o7_is(expr, Ast_RFactor_tag)) {
		expression(&(*gen), expr);
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		expression(&(*gen), expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static o7_bool IsAnonStruct(struct Ast_Record_s *rec) {
	return !StringStore_IsDefined(&O7_REF(rec)->_._._.name) || StringStore_SearchSubString(&O7_REF(rec)->_._._.name, 6, (o7_char *)"_anon_");
}

static struct Ast_RType *TypeForTag(struct Ast_Record_s *rec) {
	if (IsAnonStruct(rec)) {
		rec = O7_REF(rec)->base;
	}
	return (&(rec)->_._);
}

static o7_bool CheckStructName(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec) {
	o7_char anon[TranslatorLimits_LenName_cnst * 2 + 3];
	int i, j, l;
	memset(&anon, 0, sizeof(anon));

	if (StringStore_IsDefined(&O7_REF(rec)->_._._.name)) {
	} else if ((O7_REF(rec)->pointer != NULL) && StringStore_IsDefined(&O7_REF(O7_REF(rec)->pointer)->_._._.name)) {
		l = 0;
		O7_ASSERT(O7_REF(rec)->_._._.module != NULL);
		O7_REF(rec)->_._._.mark = o7_bl(O7_REF(O7_REF(rec)->pointer)->_._._.mark);
		O7_ASSERT(StringStore_CopyToChars(TranslatorLimits_LenName_cnst * 2 + 3, anon, &l, &O7_REF(O7_REF(rec)->pointer)->_._._.name));
		anon[o7_ind(TranslatorLimits_LenName_cnst * 2 + 3, l)] = (o7_char)'_';
		anon[o7_ind(TranslatorLimits_LenName_cnst * 2 + 3, o7_add(l, 1))] = (o7_char)'s';
		anon[o7_ind(TranslatorLimits_LenName_cnst * 2 + 3, o7_add(l, 2))] = 0x00u;
		Ast_PutChars(O7_REF(O7_REF(rec)->pointer)->_._._.module, &O7_REF(rec)->_._._.name, TranslatorLimits_LenName_cnst * 2 + 3, anon, 0, o7_add(l, 2));
	} else {
		l = 0;
		O7_ASSERT(StringStore_CopyToChars(TranslatorLimits_LenName_cnst * 2 + 3, anon, &l, &O7_REF(O7_REF(rec)->_._._.module)->_._.name));

		Log_StrLn(6, (o7_char *)"Record");

		O7_ASSERT(StringStore_CopyChars(TranslatorLimits_LenName_cnst * 2 + 3, anon, &l, 10, (o7_char *)"_anon_0000", 0, 10));
		O7_ASSERT((o7_cmp(O7_REF((*gen).opt)->index, 0) >= 0) && (o7_cmp(O7_REF((*gen).opt)->index, 10000) < 0));
		i = o7_int(O7_REF((*gen).opt)->index);
		j = o7_sub(l, 1);
		while (i > 0) {
			anon[o7_ind(TranslatorLimits_LenName_cnst * 2 + 3, j)] = o7_chr(o7_add((int)(o7_char)'0', o7_mod(i, 10)));
			i = o7_div(i, 10);
			j = o7_sub(j, 1);
		}
		O7_REF((*gen).opt)->index = o7_add(O7_REF((*gen).opt)->index, 1);
		Ast_PutChars(O7_REF(rec)->_._._.module, &O7_REF(rec)->_._._.name, TranslatorLimits_LenName_cnst * 2 + 3, anon, 0, l);
	}
	return StringStore_IsDefined(&O7_REF(rec)->_._._.name);
}

static void ArrayDeclLen(struct GeneratorC_Generator *gen, struct Ast_RType *arr, struct Ast_RDeclaration *decl, struct Ast_RSelector *sel, int i) {
	if (O7_GUARD(Ast_RArray, &arr)->count != NULL) {
		expression(&(*gen), O7_GUARD(Ast_RArray, &arr)->count);
	} else {
		GlobalName(&(*gen), decl);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
		if (i < 0) {
			i = 0;
			while (sel != NULL) {
				i = o7_add(i, 1);
				sel = O7_REF(sel)->next;
			}
		}
		TextGenerator_Int(&(*gen)._, i);
	}
}

static void ArrayLen(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	int i;
	struct Ast_Designator_s *des;
	struct Ast_RType *t;

	if (O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count != NULL) {
		expression(&(*gen), O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count);
	} else {
		des = O7_GUARD(Ast_Designator_s, &e);
		GlobalName(&(*gen), O7_REF(des)->decl);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
		i = 0;
		t = O7_REF(des)->_._.type;
		while (t != O7_REF(e)->type) {
			i = o7_add(i, 1);
			t = O7_REF(t)->_.type;
		}
		TextGenerator_Int(&(*gen)._, i);
	}
}

static void Selector(struct GeneratorC_Generator *gen, struct Selectors *sels, int i, struct Ast_RType **typ, struct Ast_RType *desType);
static void Selector_Record(struct GeneratorC_Generator *gen, struct Ast_RType **typ, struct Ast_RSelector **sel);
static o7_bool Selector_Record_Search(struct Ast_Record_s *ds, struct Ast_RDeclaration *d) {
	struct Ast_RDeclaration *c;

	c = (&(O7_REF(ds)->vars)->_);
	while ((c != NULL) && (c != d)) {
		c = O7_REF(c)->next;
	}
	return c != NULL;
}

static void Selector_Record(struct GeneratorC_Generator *gen, struct Ast_RType **typ, struct Ast_RSelector **sel) {
	struct Ast_RDeclaration *var_;
	struct Ast_Record_s *up;

	var_ = (&(O7_GUARD(Ast_SelRecord_s, &(*sel))->var_)->_);
	if (o7_is((*typ), Ast_RPointer_tag)) {
		up = O7_GUARD(Ast_Record_s, &O7_GUARD(Ast_RPointer, &(*typ))->_._._.type);
	} else {
		up = O7_GUARD(Ast_Record_s, &(*typ));
	}

	if (o7_cmp(O7_REF((*typ))->_._.id, Ast_IdPointer_cnst) == 0) {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"->");
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x2E");
	}

	if (!o7_bl(O7_REF((*gen).opt)->plan9)) {
		while ((up != NULL) && !Selector_Record_Search(up, var_)) {
			up = O7_REF(up)->base;
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"_.");
		}
	}

	Name(&(*gen), var_);

	(*typ) = O7_REF(var_)->type;
}

static void Selector_Declarator(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl) {
	if ((o7_is(decl, Ast_FormalParam_s_tag)) && ((!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &decl)->access)) && (o7_cmp(O7_REF(O7_REF(decl)->type)->_._.id, Ast_IdArray_cnst) != 0) || (o7_cmp(O7_REF(O7_REF(decl)->type)->_._.id, Ast_IdRecord_cnst) == 0))) {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"(*");
		GlobalName(&(*gen), decl);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		GlobalName(&(*gen), decl);
	}
}

static void Selector_Array(struct GeneratorC_Generator *gen, struct Ast_RType **typ, struct Ast_RSelector **sel, struct Ast_RDeclaration *decl, o7_bool isDesignatorArray);
static void Selector_Array_Mult(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, int j, struct Ast_RType *t) {
	while ((t != NULL) && (o7_is(t, Ast_RArray_tag))) {
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)" * ");
		Name(&(*gen), decl);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
		TextGenerator_Int(&(*gen)._, j);
		j = o7_add(j, 1);
		t = O7_REF(t)->_.type;
	}
}

static void Selector_Array(struct GeneratorC_Generator *gen, struct Ast_RType **typ, struct Ast_RSelector **sel, struct Ast_RDeclaration *decl, o7_bool isDesignatorArray) {
	int i;

	if (isDesignatorArray && !o7_bl(O7_REF((*gen).opt)->vla)) {
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)" + ");
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5B");
	}
	if ((o7_cmp(O7_REF(O7_REF((*typ))->_.type)->_._.id, Ast_IdArray_cnst) != 0) || (O7_GUARD(Ast_RArray, &(*typ))->count != NULL) || o7_bl(O7_REF((*gen).opt)->vla)) {
		if (o7_bl(O7_REF((*gen).opt)->checkIndex) && ((O7_REF(O7_GUARD(Ast_SelArray_s, &(*sel))->index)->value_ == NULL) || (O7_GUARD(Ast_RArray, &(*typ))->count == NULL) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_GUARD(Ast_SelArray_s, &(*sel))->index)->value_)->int_, 0) != 0))) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_ind(");
			ArrayDeclLen(&(*gen), (*typ), decl, (*sel), 0);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		} else {
			expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
		}
		(*typ) = O7_REF((*typ))->_.type;
		(*sel) = O7_REF((*sel))->next;
		i = 1;
		while (((*sel) != NULL) && (o7_is((*sel), Ast_SelArray_s_tag))) {
			if (o7_bl(O7_REF((*gen).opt)->checkIndex) && ((O7_REF(O7_GUARD(Ast_SelArray_s, &(*sel))->index)->value_ == NULL) || (O7_GUARD(Ast_RArray, &(*typ))->count == NULL) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_GUARD(Ast_SelArray_s, &(*sel))->index)->value_)->int_, 0) != 0))) {
				TextGenerator_Str(&(*gen)._, 9, (o7_char *)"][o7_ind(");
				ArrayDeclLen(&(*gen), (*typ), decl, (*sel), i);
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			} else {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)"][");
				expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
			}
			i = o7_add(i, 1);
			(*sel) = O7_REF((*sel))->next;
			(*typ) = O7_REF((*typ))->_.type;
		}
	} else {
		i = 0;
		while ((O7_REF((*sel))->next != NULL) && (o7_is(O7_REF((*sel))->next, Ast_SelArray_s_tag))) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_ind(");
			ArrayDeclLen(&(*gen), (*typ), decl, NULL, i);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			(*typ) = O7_REF((*typ))->_.type;
			Selector_Array_Mult(&(*gen), decl, o7_add(i, 1), (*typ));
			(*sel) = O7_REF((*sel))->next;
			i = o7_add(i, 1);
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)" + ");
		}
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_ind(");
		ArrayDeclLen(&(*gen), (*typ), decl, NULL, i);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		expression(&(*gen), O7_GUARD(Ast_SelArray_s, &(*sel))->index);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		Selector_Array_Mult(&(*gen), decl, o7_add(i, 1), O7_REF((*typ))->_.type);
	}
	if (!isDesignatorArray || o7_bl(O7_REF((*gen).opt)->vla)) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5D");
	}
}

static void Selector(struct GeneratorC_Generator *gen, struct Selectors *sels, int i, struct Ast_RType **typ, struct Ast_RType *desType) {
	struct Ast_RSelector *sel = NULL;
	o7_bool ref_;

	if (i >= 0) {
		sel = (*sels).list[o7_ind(TranslatorLimits_Selectors_cnst, i)];
	}
	if (!o7_bl(O7_REF((*gen).opt)->checkNil)) {
		ref_ = false;
	} else if (i < 0) {
		ref_ = (o7_cmp((*sels).i, 0) >= 0) && (O7_REF((*sels).decl)->type != NULL) && (o7_cmp(O7_REF(O7_REF((*sels).decl)->type)->_._.id, Ast_IdPointer_cnst) == 0);
	} else {
		ref_ = (o7_cmp(O7_REF(O7_REF(sel)->type)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(sel)->next != NULL) && !(o7_is(O7_REF(sel)->next, Ast_SelGuard_s_tag)) && !(o7_is(sel, Ast_SelGuard_s_tag));
	}
	if (ref_) {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"O7_REF(");
	}
	if (i < 0) {
		Selector_Declarator(&(*gen), (*sels).decl);
	} else {
		i = o7_sub(i, 1);
		if (o7_is(sel, Ast_SelRecord_s_tag)) {
			Selector(&(*gen), &(*sels), i, &(*typ), desType);
			Selector_Record(&(*gen), &(*typ), &sel);
		} else if (o7_is(sel, Ast_SelArray_s_tag)) {
			Log_StrLn(8, (o7_char *)"SelArray");
			Selector(&(*gen), &(*sels), i, &(*typ), desType);
			Selector_Array(&(*gen), &(*typ), &sel, (*sels).decl, (o7_cmp(O7_REF(desType)->_._.id, Ast_IdArray_cnst) == 0) && (O7_GUARD(Ast_RArray, &desType)->count == NULL));
		} else if (o7_is(sel, Ast_SelPointer_s_tag)) {
			if ((O7_REF(sel)->next == NULL) || !(o7_is(O7_REF(sel)->next, Ast_SelRecord_s_tag))) {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)"(*");
				Selector(&(*gen), &(*sels), i, &(*typ), desType);
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			} else {
				Selector(&(*gen), &(*sels), i, &(*typ), desType);
			}
		} else {
			O7_ASSERT(o7_is(sel, Ast_SelGuard_s_tag));
			if (o7_cmp(O7_REF(O7_REF(sel)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
				TextGenerator_Str(&(*gen)._, 9, (o7_char *)"O7_GUARD(");
				O7_ASSERT(CheckStructName(&(*gen), O7_GUARD(Ast_Record_s, &O7_REF(O7_REF(sel)->type)->_.type)));
				GlobalName(&(*gen), &O7_REF(O7_REF(sel)->type)->_.type->_);
			} else {
				TextGenerator_Str(&(*gen)._, 11, (o7_char *)"O7_GUARD_R(");
				GlobalName(&(*gen), &O7_REF(sel)->type->_);
			}
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)", &");
			if (i < 0) {
				Selector_Declarator(&(*gen), (*sels).decl);
			} else {
				Selector(&(*gen), &(*sels), i, &(*typ), desType);
			}
			if (o7_cmp(O7_REF(O7_REF(sel)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			} else {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				GlobalName(&(*gen), (*sels).decl);
				TextGenerator_Str(&(*gen)._, 5, (o7_char *)"_tag)");
			}
			(*typ) = O7_GUARD(Ast_SelGuard_s, &sel)->_.type;
		}
	}
	if (ref_) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Designator(struct GeneratorC_Generator *gen, struct Ast_Designator_s *des);
static void Designator_Put(struct Selectors *sels, struct Ast_RSelector *sel) {
	(*sels).i =  - 1;
	while (sel != NULL) {
		(*sels).i = o7_add((*sels).i, 1);
		(*sels).list[o7_ind(TranslatorLimits_Selectors_cnst, (*sels).i)] = sel;
		if (o7_is(sel, Ast_SelArray_s_tag)) {
			while ((sel != NULL) && (o7_is(sel, Ast_SelArray_s_tag))) {
				sel = O7_REF(sel)->next;
			}
		} else {
			sel = O7_REF(sel)->next;
		}
	}
}

static void Designator(struct GeneratorC_Generator *gen, struct Ast_Designator_s *des) {
	struct Selectors sels;
	struct Ast_RType *typ;
	Selectors_undef(&sels);

	typ = O7_REF(O7_REF(des)->decl)->type;
	Designator_Put(&sels, O7_REF(des)->sel);
	sels.des = des;
	sels.decl = O7_REF(des)->decl;
	O7_REF((*gen).opt)->lastSelectorDereference = (o7_cmp(sels.i, 0) > 0) && (o7_is(sels.list[o7_ind(TranslatorLimits_Selectors_cnst, sels.i)], Ast_SelPointer_s_tag));
	Selector(&(*gen), &sels, sels.i, &typ, O7_REF(des)->_._.type);
}

static o7_bool IsMayNotInited(struct Ast_RExpression *e) {
	struct Ast_Designator_s *des;
	struct Ast_RVar *var_;

	var_ = NULL;
	if (o7_is(e, Ast_Designator_s_tag)) {
		des = O7_GUARD(Ast_Designator_s, &e);
		if (o7_is(O7_REF(des)->decl, Ast_RVar_tag)) {
			var_ = O7_GUARD(Ast_RVar, &O7_REF(des)->decl);
		} else {
			des = NULL;
		}
	} else {
		des = NULL;
	}
	return (des != NULL) && ((O7_REF(des)->inited != (1u << Ast_InitedValue_cnst)) || (O7_REF(des)->sel != NULL) || o7_bl(O7_REF(var_)->checkInit));
}

static void CheckExpr(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	if ((o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) && (O7_REF(e)->value_ == NULL) && (o7_in(O7_REF(O7_REF(e)->type)->_._.id, ((1u << Ast_IdBoolean_cnst) | (1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdReal32_cnst)))) && IsMayNotInited(e)) {
		switch (O7_REF(O7_REF(e)->type)->_._.id) {
		case 2:
			TextGenerator_Str(&(*gen)._, 6, (o7_char *)"o7_bl(");
			break;
		case 0:
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_int(");
			break;
		case 1:
			TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_long(");
			break;
		case 5:
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_dbl(");
			break;
		case 6:
			TextGenerator_Str(&(*gen)._, 6, (o7_char *)"o7_fl(");
			break;
		default:
			o7_case_fail(O7_REF(O7_REF(e)->type)->_._.id);
			break;
		}
		expression(&(*gen), e);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		expression(&(*gen), e);
	}
}

static void AssignInitValue(struct GeneratorC_Generator *gen, struct Ast_RType *typ);
static void AssignInitValue_Zero(struct GeneratorC_Generator *gen, struct Ast_RType *typ) {
	switch (O7_REF(typ)->_._.id) {
	case 0:
	case 1:
	case 3:
	case 5:
	case 6:
	case 7:
	case 8:
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" = 0");
		break;
	case 2:
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)" = 0 > 1");
		break;
	case 4:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)" = '\\0'");
		break;
	case 9:
	case 13:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)" = NULL");
		break;
	default:
		o7_case_fail(O7_REF(typ)->_._.id);
		break;
	}
}

static void AssignInitValue_Undef(struct GeneratorC_Generator *gen, struct Ast_RType *typ) {
	switch (O7_REF(typ)->_._.id) {
	case 0:
		TextGenerator_Str(&(*gen)._, 15, (o7_char *)" = O7_INT_UNDEF");
		break;
	case 1:
		TextGenerator_Str(&(*gen)._, 16, (o7_char *)" = O7_LONG_UNDEF");
		break;
	case 2:
		TextGenerator_Str(&(*gen)._, 16, (o7_char *)" = O7_BOOL_UNDEF");
		break;
	case 3:
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" = 0");
		break;
	case 4:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)" = '\\0'");
		break;
	case 5:
		TextGenerator_Str(&(*gen)._, 15, (o7_char *)" = O7_DBL_UNDEF");
		break;
	case 6:
		TextGenerator_Str(&(*gen)._, 15, (o7_char *)" = O7_FLT_UNDEF");
		break;
	case 7:
	case 8:
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)" = 0u");
		break;
	case 9:
	case 13:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)" = NULL");
		break;
	default:
		o7_case_fail(O7_REF(typ)->_._.id);
		break;
	}
}

static void AssignInitValue(struct GeneratorC_Generator *gen, struct Ast_RType *typ) {
	switch (O7_REF((*gen).opt)->varInit) {
	case 0:
		AssignInitValue_Undef(&(*gen), typ);
		break;
	case 1:
		AssignInitValue_Zero(&(*gen), typ);
		break;
	default:
		o7_case_fail(O7_REF((*gen).opt)->varInit);
		break;
	}
}

static void VarInit(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *var_, o7_bool record) {
	if ((o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitNo_cnst) == 0) || (o7_in(O7_REF(O7_REF(var_)->type)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdRecord_cnst)))) || (!record && !o7_bl(O7_GUARD(Ast_RVar, &var_)->checkInit))) {
		if ((o7_cmp(O7_REF(O7_REF(var_)->type)->_._.id, Ast_IdPointer_cnst) == 0) && (o7_cmp(O7_REF((*gen).opt)->memManager, GeneratorC_MemManagerCounter_cnst) == 0)) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)" = NULL");
		}
	} else {
		AssignInitValue(&(*gen), O7_REF(var_)->type);
	}
}

static void Expression(struct GeneratorC_Generator *gen, struct Ast_RExpression *expr);
static void Expression_Call(struct GeneratorC_Generator *gen, struct Ast_ExprCall_s *call);
static void Expression_Call_Predefined(struct GeneratorC_Generator *gen, struct Ast_ExprCall_s *call);
static void Expression_Call_Predefined_Shift(struct GeneratorC_Generator *gen, int shift_len0, o7_char shift[/*len0*/], struct Ast_Parameter_s *ps) {
	TextGenerator_Str(&(*gen)._, 16, (o7_char *)"(int)((unsigned)");
	Factor(&(*gen), O7_REF(ps)->expr);
	TextGenerator_Str(&(*gen)._, shift_len0, shift);
	Factor(&(*gen), O7_REF(O7_REF(ps)->next)->expr);
	TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
}

static void Expression_Call_Predefined_Len(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	struct Ast_RSelector *sel;
	int i;
	struct Ast_Designator_s *des = NULL;
	struct Ast_RExpression *count;
	o7_bool sizeof_;

	count = O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count;
	if (o7_is(e, Ast_Designator_s_tag)) {
		des = O7_GUARD(Ast_Designator_s, &e);
		sizeof_ = !(o7_is(O7_GUARD(Ast_Designator_s, &e)->decl, Ast_Const_s_tag)) && ((o7_cmp(O7_REF(O7_REF(O7_REF(des)->decl)->type)->_._.id, Ast_IdArray_cnst) != 0) || !(o7_is(O7_REF(des)->decl, Ast_FormalParam_s_tag)));
	} else {
		O7_ASSERT(count != NULL);
		sizeof_ = false;
	}
	if ((count != NULL) && !sizeof_) {
		Expression(&(*gen), count);
	} else if (sizeof_) {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"O7_LEN(");
		Designator(&(*gen), des);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		GlobalName(&(*gen), O7_REF(des)->decl);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
		i = 0;
		sel = O7_REF(des)->sel;
		while (sel != NULL) {
			i = o7_add(i, 1);
			sel = O7_REF(sel)->next;
		}
		TextGenerator_Int(&(*gen)._, i);
	}
}

static void Expression_Call_Predefined_New(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	struct Ast_RType *tagType;

	tagType = TypeForTag(O7_GUARD(Ast_Record_s, &O7_REF(O7_REF(e)->type)->_.type));
	if ((tagType != NULL) && (o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0)) {
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"O7_NEW(&");
		Designator(&(*gen), O7_GUARD(Ast_Designator_s, &e));
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		GlobalName(&(*gen), &tagType->_);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		TextGenerator_Str(&(*gen)._, 9, (o7_char *)"O7_NEW2(&");
		Designator(&(*gen), O7_GUARD(Ast_Designator_s, &e));
		if (tagType != NULL) {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			GlobalName(&(*gen), &tagType->_);
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)"_tag, NULL)");
		} else {
			TextGenerator_Str(&(*gen)._, 13, (o7_char *)", NULL, NULL)");
		}
	}
}

static void Expression_Call_Predefined_Ord(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	switch (O7_REF(O7_REF(e)->type)->_._.id) {
	case 4:
	case 10:
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)"(int)");
		Factor(&(*gen), e);
		break;
	case 2:
		if ((o7_is(e, Ast_Designator_s_tag)) && (o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0)) {
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)"(int)o7_bl(");
			Expression(&(*gen), e);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		} else {
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)"(int)");
			Factor(&(*gen), e);
		}
		break;
	case 7:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_sti(");
		Expression(&(*gen), e);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	default:
		o7_case_fail(O7_REF(O7_REF(e)->type)->_._.id);
		break;
	}
}

static void Expression_Call_Predefined_Inc(struct GeneratorC_Generator *gen, struct Ast_RExpression *e1, struct Ast_Parameter_s *p2) {
	Expression(&(*gen), e1);
	if (o7_bl(O7_REF((*gen).opt)->checkArith)) {
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)" = o7_add(");
		Expression(&(*gen), e1);
		if (p2 == NULL) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)", 1)");
		} else {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			Expression(&(*gen), O7_REF(p2)->expr);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		}
	} else if (p2 == NULL) {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"++");
	} else {
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" += ");
		Expression(&(*gen), O7_REF(p2)->expr);
	}
}

static void Expression_Call_Predefined_Dec(struct GeneratorC_Generator *gen, struct Ast_RExpression *e1, struct Ast_Parameter_s *p2) {
	Expression(&(*gen), e1);
	if (o7_bl(O7_REF((*gen).opt)->checkArith)) {
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)" = o7_sub(");
		Expression(&(*gen), e1);
		if (p2 == NULL) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)", 1)");
		} else {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			Expression(&(*gen), O7_REF(p2)->expr);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		}
	} else if (p2 == NULL) {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"--");
	} else {
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" -= ");
		Expression(&(*gen), O7_REF(p2)->expr);
	}
}

static void Expression_Call_Predefined_Assert(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	o7_bool c11Assert;
	o7_char buf[5];
	memset(&buf, 0, sizeof(buf));

	c11Assert = false;
	if ((O7_REF(e)->value_ != NULL) && (O7_REF(e)->value_ != &Ast_ExprBooleanGet(false)->_)) {
		if (o7_cmp(O7_REF((*gen).opt)->std, GeneratorC_IsoC11_cnst) >= 0) {
			c11Assert = true;
			TextGenerator_Str(&(*gen)._, 14, (o7_char *)"static_assert(");
		} else {
			TextGenerator_Str(&(*gen)._, 17, (o7_char *)"O7_STATIC_ASSERT(");
		}
	} else if (o7_bl(O7_REF((*gen).opt)->o7Assert)) {
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)"O7_ASSERT(");
	} else {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"assert(");
	}
	CheckExpr(&(*gen), e);
	if (c11Assert) {
		buf[0] = (o7_char)',';
		buf[1] = (o7_char)' ';
		buf[2] = (o7_char)'"';
		buf[3] = (o7_char)'"';
		buf[4] = (o7_char)')';
		TextGenerator_Str(&(*gen)._, 5, buf);
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Call_Predefined(struct GeneratorC_Generator *gen, struct Ast_ExprCall_s *call) {
	struct Ast_RExpression *e1;
	struct Ast_Parameter_s *p2;

	e1 = O7_REF(O7_REF(call)->params)->expr;
	p2 = O7_REF(O7_REF(call)->params)->next;
	switch (O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id) {
	case 90:
		if (o7_cmp(O7_REF(O7_REF(call)->_._.type)->_._.id, Ast_IdInteger_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"abs(");
		} else if (o7_cmp(O7_REF(O7_REF(call)->_._.type)->_._.id, Ast_IdLongInt_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 8, (o7_char *)"O7_LABS(");
		} else {
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)"fabs(");
		}
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 109:
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		Factor(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)" % 2 == 1)");
		break;
	case 104:
		Expression_Call_Predefined_Len(&(*gen), e1);
		break;
	case 107:
		Expression_Call_Predefined_Shift(&(*gen), 4, (o7_char *)" << ", O7_REF(call)->params);
		break;
	case 91:
		Expression_Call_Predefined_Shift(&(*gen), 4, (o7_char *)" >> ", O7_REF(call)->params);
		break;
	case 114:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_ror(");
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression(&(*gen), O7_REF(p2)->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 99:
		TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_floor(");
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 100:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_flt(");
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 110:
		Expression_Call_Predefined_Ord(&(*gen), e1);
		break;
	case 96:
		if (o7_bl(O7_REF((*gen).opt)->checkArith) && (O7_REF(e1)->value_ == NULL)) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_chr(");
			Expression(&(*gen), e1);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		} else {
			TextGenerator_Str(&(*gen)._, 9, (o7_char *)"(o7_char)");
			Factor(&(*gen), e1);
		}
		break;
	case 101:
		Expression_Call_Predefined_Inc(&(*gen), e1, p2);
		break;
	case 97:
		Expression_Call_Predefined_Dec(&(*gen), e1, p2);
		break;
	case 102:
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)" |= 1u << ");
		Factor(&(*gen), O7_REF(p2)->expr);
		break;
	case 98:
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 12, (o7_char *)" &= ~(1u << ");
		Factor(&(*gen), O7_REF(p2)->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 108:
		Expression_Call_Predefined_New(&(*gen), e1);
		break;
	case 92:
		Expression_Call_Predefined_Assert(&(*gen), e1);
		break;
	case 111:
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)"o7_ldexp(&");
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression(&(*gen), O7_REF(p2)->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 116:
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)"o7_frexp(&");
		Expression(&(*gen), e1);
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)", &");
		Expression(&(*gen), O7_REF(p2)->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	default:
		o7_case_fail(O7_REF(O7_REF(O7_REF(call)->designator)->decl)->_.id);
		break;
	}
}

static void Expression_Call_ActualParam(struct GeneratorC_Generator *gen, struct Ast_Parameter_s **p, struct Ast_RDeclaration **fp);
static int Expression_Call_ActualParam_ArrayDeep(struct Ast_RType *t) {
	int d;

	d = 0;
	while (o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) == 0) {
		t = O7_REF(t)->_.type;
		d = o7_add(d, 1);
	}
	return d;
}

static void Expression_Call_ActualParam(struct GeneratorC_Generator *gen, struct Ast_Parameter_s **p, struct Ast_RDeclaration **fp) {
	struct Ast_RType *t;
	int i, j, dist;

	t = O7_REF((*fp))->type;
	if ((o7_cmp(O7_REF(t)->_._.id, Ast_IdByte_cnst) == 0) && (o7_in(O7_REF(O7_REF(O7_REF((*p))->expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst)))) && o7_bl(O7_REF((*gen).opt)->checkArith) && (O7_REF(O7_REF((*p))->expr)->value_ == NULL)) {
		if (o7_cmp(O7_REF(O7_REF(O7_REF((*p))->expr)->type)->_._.id, Ast_IdInteger_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_byte(");
		} else {
			TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_lbyte(");
		}
		Expression(&(*gen), O7_REF((*p))->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		j = 1;
		if (o7_cmp(O7_REF(O7_REF((*fp))->type)->_._.id, Ast_IdChar_cnst) != 0) {
			i =  - 1;
			t = O7_REF(O7_REF((*p))->expr)->type;
			while ((o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) == 0) && (O7_GUARD(Ast_RArray, &O7_REF((*fp))->type)->count == NULL)) {
				if ((i ==  - 1) && (o7_is(O7_REF((*p))->expr, Ast_Designator_s_tag))) {
					i = o7_sub(Expression_Call_ActualParam_ArrayDeep(O7_REF(O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->decl)->type), Expression_Call_ActualParam_ArrayDeep(O7_REF((*fp))->type));
					if (!(o7_is(O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->decl, Ast_FormalParam_s_tag))) {
						j = Expression_Call_ActualParam_ArrayDeep(O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->_._.type);
					}
				}
				if (O7_GUARD(Ast_RArray, &t)->count != NULL) {
					Expression(&(*gen), O7_GUARD(Ast_RArray, &t)->count);
				} else {
					Name(&(*gen), O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->decl);
					TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
					TextGenerator_Int(&(*gen)._, i);
				}
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				i = o7_add(i, 1);
				t = O7_REF(t)->_.type;
			}
			t = O7_REF((*fp))->type;
		}
		dist = o7_int(O7_REF((*p))->distance);
		if (((!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &(*fp))->access)) && !(o7_is(t, Ast_RArray_tag))) || (o7_is(t, Ast_Record_s_tag)) || (o7_cmp(O7_REF(t)->_._.id, Ast_IdPointer_cnst) == 0) && (dist > 0) && !o7_bl(O7_REF((*gen).opt)->plan9)) {
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x26");
		}
		O7_REF((*gen).opt)->lastSelectorDereference = false;
		O7_REF((*gen).opt)->expectArray = o7_cmp(O7_REF(O7_REF((*fp))->type)->_._.id, Ast_IdArray_cnst) == 0;
		Expression(&(*gen), O7_REF((*p))->expr);
		O7_REF((*gen).opt)->expectArray = false;

		if (!o7_bl(O7_REF((*gen).opt)->vla)) {
			while (j > 1) {
				j = o7_sub(j, 1);
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)"[0]");
			}
		}

		if ((dist > 0) && !o7_bl(O7_REF((*gen).opt)->plan9)) {
			if (o7_cmp(O7_REF(t)->_._.id, Ast_IdPointer_cnst) == 0) {
				dist = o7_sub(dist, 1);
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)"->_");
			}
			while (dist > 0) {
				dist = o7_sub(dist, 1);
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)"._");
			}
		}

		t = O7_REF(O7_REF((*p))->expr)->type;
		if ((o7_cmp(O7_REF(t)->_._.id, Ast_IdRecord_cnst) == 0) && (!o7_bl(O7_REF((*gen).opt)->skipUnusedTag) || Ast_IsNeedTag(O7_GUARD(Ast_FormalParam_s, &(*fp))))) {
			if (o7_bl(O7_REF((*gen).opt)->lastSelectorDereference)) {
				TextGenerator_Str(&(*gen)._, 6, (o7_char *)", NULL");
			} else {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				if ((o7_is(O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->decl, Ast_FormalParam_s_tag)) && (O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->sel == NULL)) {
					Name(&(*gen), O7_GUARD(Ast_Designator_s, &O7_REF((*p))->expr)->decl);
				} else {
					GlobalName(&(*gen), &t->_);
				}
				TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_tag");
			}
		}
	}

	(*p) = O7_REF((*p))->next;
	(*fp) = O7_REF((*fp))->next;
}

static void Expression_Call(struct GeneratorC_Generator *gen, struct Ast_ExprCall_s *call) {
	struct Ast_Parameter_s *p;
	struct Ast_RDeclaration *fp;

	if (o7_is(O7_REF(O7_REF(call)->designator)->decl, Ast_PredefinedProcedure_s_tag)) {
		Expression_Call_Predefined(&(*gen), call);
	} else {
		Designator(&(*gen), O7_REF(call)->designator);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		p = O7_REF(call)->params;
		fp = (&(O7_GUARD(Ast_RProcType, &O7_REF(O7_REF(call)->designator)->_._.type)->params)->_._);
		if (p != NULL) {
			Expression_Call_ActualParam(&(*gen), &p, &fp);
			while (p != NULL) {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				Expression_Call_ActualParam(&(*gen), &p, &fp);
			}
		}
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Relation(struct GeneratorC_Generator *gen, struct Ast_ExprRelation_s *rel);
static void Expression_Relation_Simple(struct GeneratorC_Generator *gen, struct Ast_ExprRelation_s *rel, int str_len0, o7_char str[/*len0*/]);
static void Expression_Relation_Simple_Expr(struct GeneratorC_Generator *gen, struct Ast_RExpression *e, int dist) {
	o7_bool brace;

	brace = (o7_in(O7_REF(O7_REF(e)->type)->_._.id, ((1u << Ast_IdSet_cnst) | (1u << Ast_IdBoolean_cnst)))) && !(o7_is(e, Ast_RFactor_tag));
	if (brace) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
	} else if ((dist > 0) && (o7_cmp(O7_REF(O7_REF(e)->type)->_._.id, Ast_IdPointer_cnst) == 0) && !o7_bl(O7_REF((*gen).opt)->plan9)) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x26");
	}
	Expression(&(*gen), e);
	if ((dist > 0) && !o7_bl(O7_REF((*gen).opt)->plan9)) {
		if (o7_cmp(O7_REF(O7_REF(e)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
			dist = o7_sub(dist, 1);
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)"->_");
		}
		while (dist > 0) {
			dist = o7_sub(dist, 1);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"._");
		}
	}
	if (brace) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Relation_Simple_Len(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	struct Ast_Designator_s *des;

	if (O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count != NULL) {
		Expression(&(*gen), O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count);
	} else {
		des = O7_GUARD(Ast_Designator_s, &e);
		ArrayDeclLen(&(*gen), O7_REF(des)->_._.type, O7_REF(des)->decl, O7_REF(des)->sel,  - 1);
	}
}

static void Expression_Relation_Simple(struct GeneratorC_Generator *gen, struct Ast_ExprRelation_s *rel, int str_len0, o7_char str[/*len0*/]) {
	if ((o7_cmp(O7_REF(O7_REF(O7_REF(rel)->exprs[0])->type)->_._.id, Ast_IdArray_cnst) == 0) && ((O7_REF(O7_REF(rel)->exprs[0])->value_ == NULL) || !o7_bl(O7_GUARD(Ast_ExprString_s, &O7_REF(O7_REF(rel)->exprs[0])->value_)->asChar))) {
		if (O7_REF(rel)->_.value_ != NULL) {
			Expression(&(*gen), &O7_REF(rel)->_.value_->_);
		} else {
			TextGenerator_Str(&(*gen)._, 10, (o7_char *)"o7_strcmp(");

			Expression_Relation_Simple_Len(&(*gen), O7_REF(rel)->exprs[0]);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[0], o7_sub(0, O7_REF(rel)->distance));

			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");

			Expression_Relation_Simple_Len(&(*gen), O7_REF(rel)->exprs[1]);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[1], O7_REF(rel)->distance);

			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			TextGenerator_Str(&(*gen)._, str_len0, str);
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x30");
		}
	} else if ((o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) && (O7_REF(rel)->_.value_ == NULL) && (o7_in(O7_REF(O7_REF(O7_REF(rel)->exprs[0])->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst)))) && (IsMayNotInited(O7_REF(rel)->exprs[0]) || IsMayNotInited(O7_REF(rel)->exprs[1]))) {
		if (o7_cmp(O7_REF(O7_REF(O7_REF(rel)->exprs[0])->type)->_._.id, Ast_IdInteger_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_cmp(");
		} else {
			TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_lcmp(");
		}
		Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[0], o7_sub(0, O7_REF(rel)->distance));
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[1], O7_REF(rel)->distance);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		TextGenerator_Str(&(*gen)._, str_len0, str);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x30");
	} else {
		Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[0], o7_sub(0, O7_REF(rel)->distance));
		TextGenerator_Str(&(*gen)._, str_len0, str);
		Expression_Relation_Simple_Expr(&(*gen), O7_REF(rel)->exprs[1], O7_REF(rel)->distance);
	}
}

static void Expression_Relation_In(struct GeneratorC_Generator *gen, struct Ast_ExprRelation_s *rel) {
	if ((O7_REF(O7_REF(rel)->exprs[0])->value_ != NULL) && (o7_in(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(rel)->exprs[0])->value_)->int_, O7_SET(0, TypeLimits_SetMax_cnst)))) {
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"!!(");
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)" (1u << ");
		Factor(&(*gen), O7_REF(rel)->exprs[0]);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)") & ");
		Factor(&(*gen), O7_REF(rel)->exprs[1]);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		if (O7_REF(rel)->_.value_ != NULL) {
			TextGenerator_Str(&(*gen)._, 6, (o7_char *)"O7_IN(");
		} else {
			TextGenerator_Str(&(*gen)._, 6, (o7_char *)"o7_in(");
		}
		Expression(&(*gen), O7_REF(rel)->exprs[0]);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression(&(*gen), O7_REF(rel)->exprs[1]);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Relation(struct GeneratorC_Generator *gen, struct Ast_ExprRelation_s *rel) {
	switch (O7_REF(rel)->relation) {
	case 21:
		Expression_Relation_Simple(&(*gen), rel, 4, (o7_char *)" == ");
		break;
	case 22:
		Expression_Relation_Simple(&(*gen), rel, 4, (o7_char *)" != ");
		break;
	case 23:
		Expression_Relation_Simple(&(*gen), rel, 3, (o7_char *)" < ");
		break;
	case 24:
		Expression_Relation_Simple(&(*gen), rel, 4, (o7_char *)" <= ");
		break;
	case 25:
		Expression_Relation_Simple(&(*gen), rel, 3, (o7_char *)" > ");
		break;
	case 26:
		Expression_Relation_Simple(&(*gen), rel, 4, (o7_char *)" >= ");
		break;
	case 27:
		Expression_Relation_In(&(*gen), rel);
		break;
	default:
		o7_case_fail(O7_REF(rel)->relation);
		break;
	}
}

static void Expression_Sum(struct GeneratorC_Generator *gen, struct Ast_ExprSum_s *sum) {
	o7_bool first;

	first = true;
	do {
		if (o7_cmp(O7_REF(sum)->add, Scanner_Minus_cnst) == 0) {
			if (o7_cmp(O7_REF(O7_REF(sum)->_.type)->_._.id, Ast_IdSet_cnst) != 0) {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" - ");
			} else if (first) {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)" ~");
			} else {
				TextGenerator_Str(&(*gen)._, 4, (o7_char *)" & ~");
			}
		} else if (o7_cmp(O7_REF(sum)->add, Scanner_Plus_cnst) == 0) {
			if (o7_cmp(O7_REF(O7_REF(sum)->_.type)->_._.id, Ast_IdSet_cnst) == 0) {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" | ");
			} else {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" + ");
			}
		} else if (o7_cmp(O7_REF(sum)->add, Scanner_Or_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" || ");
		}
		CheckExpr(&(*gen), O7_REF(sum)->term);
		sum = O7_REF(sum)->next;
		first = false;
	} while (!(sum == NULL));
}

static void Expression_SumCheck(struct GeneratorC_Generator *gen, struct Ast_ExprSum_s *sum);
static void Expression_SumCheck_GenArrOfAddOrSub(struct GeneratorC_Generator *gen, int arr_len0, struct Ast_ExprSum_s *arr[/*len0*/], int last, int add_len0, o7_char add[/*len0*/], int sub_len0, o7_char sub[/*len0*/]) {
	int i;

	i = last;
	while (i > 0) {
		switch (O7_REF(arr[o7_ind(arr_len0, i)])->add) {
		case 11:
			TextGenerator_Str(&(*gen)._, sub_len0, sub);
			break;
		case 10:
			TextGenerator_Str(&(*gen)._, add_len0, add);
			break;
		default:
			o7_case_fail(O7_REF(arr[o7_ind(arr_len0, i)])->add);
			break;
		}
		i = o7_sub(i, 1);
	}
	if (o7_cmp(O7_REF(arr[0])->add, Scanner_Minus_cnst) == 0) {
		TextGenerator_Str(&(*gen)._, sub_len0, sub);
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"0, ");
		Expression(&(*gen), O7_REF(arr[0])->term);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	} else {
		Expression(&(*gen), O7_REF(arr[0])->term);
	}
}

static void Expression_SumCheck(struct GeneratorC_Generator *gen, struct Ast_ExprSum_s *sum) {
	struct Ast_ExprSum_s *arr[TranslatorLimits_TermsInSum_cnst];
	int i, last;
	memset(&arr, 0, sizeof(arr));

	last =  - 1;
	do {
		last = o7_add(last, 1);
		arr[o7_ind(TranslatorLimits_TermsInSum_cnst, last)] = sum;
		sum = O7_REF(sum)->next;
	} while (!(sum == NULL));
	switch (O7_REF(O7_REF(arr[0])->_.type)->_._.id) {
	case 0:
		Expression_SumCheck_GenArrOfAddOrSub(&(*gen), TranslatorLimits_TermsInSum_cnst, arr, last, 7, (o7_char *)"o7_add(", 7, (o7_char *)"o7_sub(");
		break;
	case 1:
		Expression_SumCheck_GenArrOfAddOrSub(&(*gen), TranslatorLimits_TermsInSum_cnst, arr, last, 8, (o7_char *)"o7_ladd(", 8, (o7_char *)"o7_lsub(");
		break;
	case 5:
		Expression_SumCheck_GenArrOfAddOrSub(&(*gen), TranslatorLimits_TermsInSum_cnst, arr, last, 8, (o7_char *)"o7_fadd(", 8, (o7_char *)"o7_fsub(");
		break;
	case 6:
		Expression_SumCheck_GenArrOfAddOrSub(&(*gen), TranslatorLimits_TermsInSum_cnst, arr, last, 9, (o7_char *)"o7_faddf(", 9, (o7_char *)"o7_fsubf(");
		break;
	default:
		o7_case_fail(O7_REF(O7_REF(arr[0])->_.type)->_._.id);
		break;
	}
	i = 0;
	while (i < last) {
		i = o7_add(i, 1);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression(&(*gen), O7_REF(arr[o7_ind(TranslatorLimits_TermsInSum_cnst, i)])->term);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Term(struct GeneratorC_Generator *gen, struct Ast_ExprTerm_s *term) {
	do {
		CheckExpr(&(*gen), &O7_REF(term)->factor->_);
		switch (O7_REF(term)->mult) {
		case 150:
			if (o7_cmp(O7_REF(O7_REF(term)->_.type)->_._.id, Ast_IdSet_cnst) == 0) {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" & ");
			} else {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" * ");
			}
			break;
		case 151:
		case 153:
			if (o7_cmp(O7_REF(O7_REF(term)->_.type)->_._.id, Ast_IdSet_cnst) == 0) {
				O7_ASSERT(o7_cmp(O7_REF(term)->mult, Scanner_Slash_cnst) == 0);
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" ^ ");
			} else {
				TextGenerator_Str(&(*gen)._, 3, (o7_char *)" / ");
			}
			break;
		case 152:
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" && ");
			break;
		case 154:
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)" % ");
			break;
		default:
			o7_case_fail(O7_REF(term)->mult);
			break;
		}
		if (o7_is(O7_REF(term)->expr, Ast_ExprTerm_s_tag)) {
			term = O7_GUARD(Ast_ExprTerm_s, &O7_REF(term)->expr);
		} else {
			CheckExpr(&(*gen), O7_REF(term)->expr);
			term = NULL;
		}
	} while (!(term == NULL));
}

static void Expression_TermCheck(struct GeneratorC_Generator *gen, struct Ast_ExprTerm_s *term) {
	struct Ast_ExprTerm_s *arr[TranslatorLimits_FactorsInTerm_cnst];
	int i, last;
	memset(&arr, 0, sizeof(arr));

	arr[0] = term;
	i = 0;
	while (o7_is(O7_REF(term)->expr, Ast_ExprTerm_s_tag)) {
		i = o7_add(i, 1);
		term = O7_GUARD(Ast_ExprTerm_s, &O7_REF(term)->expr);
		arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)] = term;
	}
	last = i;
	switch (O7_REF(O7_REF(term)->_.type)->_._.id) {
	case 0:
		while (i >= 0) {
			switch (O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult) {
			case 150:
				TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_mul(");
				break;
			case 153:
				TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_div(");
				break;
			case 154:
				TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_mod(");
				break;
			default:
				o7_case_fail(O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult);
				break;
			}
			i = o7_sub(i, 1);
		}
		break;
	case 1:
		while (i >= 0) {
			switch (O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult) {
			case 150:
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_lmul(");
				break;
			case 153:
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_ldiv(");
				break;
			case 154:
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_lmod(");
				break;
			default:
				o7_case_fail(O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult);
				break;
			}
			i = o7_sub(i, 1);
		}
		break;
	case 5:
		while (i >= 0) {
			switch (O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult) {
			case 150:
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_fmul(");
				break;
			case 151:
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_fdiv(");
				break;
			default:
				o7_case_fail(O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult);
				break;
			}
			i = o7_sub(i, 1);
		}
		break;
	case 6:
		while (i >= 0) {
			switch (O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult) {
			case 150:
				TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_fmulf(");
				break;
			case 151:
				TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_fdivf(");
				break;
			default:
				o7_case_fail(O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->mult);
				break;
			}
			i = o7_sub(i, 1);
		}
		break;
	default:
		o7_case_fail(O7_REF(O7_REF(term)->_.type)->_._.id);
		break;
	}
	Expression(&(*gen), &O7_REF(arr[0])->factor->_);
	i = 0;
	while (i < last) {
		i = o7_add(i, 1);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		Expression(&(*gen), &O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, i)])->factor->_);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
	TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
	Expression(&(*gen), O7_REF(arr[o7_ind(TranslatorLimits_FactorsInTerm_cnst, last)])->expr);
	TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
}

static void Expression_Boolean(struct GeneratorC_Generator *gen, struct Ast_ExprBoolean_s *e) {
	if (o7_cmp(O7_REF((*gen).opt)->std, GeneratorC_IsoC90_cnst) == 0) {
		if (o7_bl(O7_REF(e)->bool_)) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"(0 < 1)");
		} else {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"(0 > 1)");
		}
	} else {
		if (o7_bl(O7_REF(e)->bool_)) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"true");
		} else {
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)"false");
		}
	}
}

static void Expression_CString(struct GeneratorC_Generator *gen, struct Ast_ExprString_s *e);
static o7_char Expression_CString_ToHex(int d) {
	O7_ASSERT(o7_in(d, O7_SET(0, 15)));
	if (d < 10) {
		d = o7_add(d, (int)(o7_char)'0');
	} else {
		d = o7_add(d, (int)(o7_char)'A' - 10);
	}
	return o7_chr(d);
}

static void Expression_CString(struct GeneratorC_Generator *gen, struct Ast_ExprString_s *e) {
	o7_char s1[6];
	o7_char s2[3];
	o7_char ch;
	struct StringStore_String w;
	memset(&s1, 0, sizeof(s1));
	memset(&s2, 0, sizeof(s2));
	StringStore_String_undef(&w);

	w = O7_REF(e)->string;
	Log_Str(11, (o7_char *)"e.asChar = ");
	Log_Bool(O7_REF(e)->asChar);
	Log_Str(15, (o7_char *)" expectArray = ");
	Log_Bool(O7_REF((*gen).opt)->expectArray);
	Log_Ln();
	if (o7_bl(O7_REF(e)->asChar) && !o7_bl(O7_REF((*gen).opt)->expectArray)) {
		ch = o7_chr(O7_REF(e)->_.int_);
		if (ch == (o7_char)'\'') {
			TextGenerator_Str(&(*gen)._, 13, (o7_char *)"(o7_char)'\\''");
		} else if (ch == (o7_char)'\\') {
			TextGenerator_Str(&(*gen)._, 13, (o7_char *)"(o7_char)'\\\\'");
		} else if ((ch >= (o7_char)' ') && (ch <= (o7_char)127)) {
			TextGenerator_Str(&(*gen)._, 9, (o7_char *)"(o7_char)");
			s2[0] = (o7_char)'\'';
			s2[1] = ch;
			s2[2] = (o7_char)'\'';
			TextGenerator_Str(&(*gen)._, 3, s2);
		} else {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"0x");
			s2[0] = Expression_CString_ToHex(o7_div(O7_REF(e)->_.int_, 16));
			s2[1] = Expression_CString_ToHex(o7_mod(O7_REF(e)->_.int_, 16));
			s2[2] = (o7_char)'u';
			TextGenerator_Str(&(*gen)._, 3, s2);
		}
	} else {
		if (!o7_bl((*gen).insideSizeOf)) {
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)"(o7_char *)");
		}
		if ((o7_cmp(w.ofs, 0) >= 0) && (O7_REF(w.block)->s[o7_ind(StringStore_BlockSize_cnst + 1, w.ofs)] == (o7_char)'"')) {
			TextGenerator_ScreeningString(&(*gen)._, &w);
		} else {
			s1[0] = (o7_char)'"';
			s1[1] = (o7_char)'\\';
			s1[2] = (o7_char)'x';
			s1[3] = Expression_CString_ToHex(o7_div(O7_REF(e)->_.int_, 16));
			s1[4] = Expression_CString_ToHex(o7_mod(O7_REF(e)->_.int_, 16));
			s1[5] = (o7_char)'"';
			TextGenerator_Str(&(*gen)._, 6, s1);
		}
	}
}

static void Expression_ExprInt(struct GeneratorC_Generator *gen, int int_) {
	if (int_ >= 0) {
		TextGenerator_Int(&(*gen)._, int_);
	} else {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"(-");
		TextGenerator_Int(&(*gen)._, o7_sub(0, int_));
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_ExprLongInt(struct GeneratorC_Generator *gen, int int_) {
	O7_ASSERT(false);
	if (o7_cmp(int_, 0) >= 0) {
		TextGenerator_Int(&(*gen)._, int_);
	} else {
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)"(-");
		TextGenerator_Int(&(*gen)._, o7_sub(0, int_));
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Set(struct GeneratorC_Generator *gen, struct Ast_ExprSet_s *set);
static void Expression_Set_Item(struct GeneratorC_Generator *gen, struct Ast_ExprSet_s *set) {
	if (O7_REF(set)->exprs[0] == NULL) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x30");
	} else {
		if (O7_REF(set)->exprs[1] == NULL) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"(1u << ");
			Factor(&(*gen), O7_REF(set)->exprs[0]);
		} else {
			if ((O7_REF(O7_REF(set)->exprs[0])->value_ == NULL) || (O7_REF(O7_REF(set)->exprs[1])->value_ == NULL)) {
				TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_set(");
			} else {
				TextGenerator_Str(&(*gen)._, 7, (o7_char *)"O7_SET(");
			}
			Expression(&(*gen), O7_REF(set)->exprs[0]);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			Expression(&(*gen), O7_REF(set)->exprs[1]);
		}
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_Set(struct GeneratorC_Generator *gen, struct Ast_ExprSet_s *set) {
	if (O7_REF(set)->next == NULL) {
		Expression_Set_Item(&(*gen), set);
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		Expression_Set_Item(&(*gen), set);
		do {
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)" | ");
			set = O7_REF(set)->next;
			Expression_Set_Item(&(*gen), set);
		} while (!(O7_REF(set)->next == NULL));
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void Expression_IsExtension(struct GeneratorC_Generator *gen, struct Ast_ExprIsExtension_s *is) {
	struct Ast_RDeclaration *decl;
	struct Ast_RType *extType;

	decl = O7_REF(O7_REF(is)->designator)->decl;
	extType = O7_REF(is)->extType;
	if (o7_cmp(O7_REF(O7_REF(O7_REF(is)->designator)->_._.type)->_._.id, Ast_IdPointer_cnst) == 0) {
		extType = O7_REF(extType)->_.type;
		O7_ASSERT(CheckStructName(&(*gen), O7_GUARD(Ast_Record_s, &extType)));
		TextGenerator_Str(&(*gen)._, 6, (o7_char *)"o7_is(");
		Expression(&(*gen), &O7_REF(is)->designator->_._);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
	} else {
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"o7_is_r(");
		GlobalName(&(*gen), decl);
		TextGenerator_Str(&(*gen)._, 6, (o7_char *)"_tag, ");
		GlobalName(&(*gen), decl);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
	}
	GlobalName(&(*gen), &extType->_);
	TextGenerator_Str(&(*gen)._, 5, (o7_char *)"_tag)");
}

static void Expression(struct GeneratorC_Generator *gen, struct Ast_RExpression *expr) {
	switch (O7_REF(expr)->_.id) {
	case 0:
		Expression_ExprInt(&(*gen), O7_GUARD(Ast_RExprInteger, &expr)->int_);
		break;
	case 1:
		Expression_ExprLongInt(&(*gen), O7_GUARD(Ast_RExprInteger, &expr)->int_);
		break;
	case 2:
		Expression_Boolean(&(*gen), O7_GUARD(Ast_ExprBoolean_s, &expr));
		break;
	case 5:
	case 6:
		if (StringStore_IsDefined(&O7_GUARD(Ast_ExprReal_s, &expr)->str)) {
			TextGenerator_String(&(*gen)._, &O7_GUARD(Ast_ExprReal_s, &expr)->str);
		} else {
			TextGenerator_Real(&(*gen)._, O7_GUARD(Ast_ExprReal_s, &expr)->real);
		}
		break;
	case 15:
		Expression_CString(&(*gen), O7_GUARD(Ast_ExprString_s, &expr));
		break;
	case 7:
		Expression_Set(&(*gen), O7_GUARD(Ast_ExprSet_s, &expr));
		break;
	case 25:
		Expression_Call(&(*gen), O7_GUARD(Ast_ExprCall_s, &expr));
		break;
	case 20:
		Log_Str(26, (o7_char *)"Expr Designator type.id = ");
		Log_Int(O7_REF(O7_REF(expr)->type)->_._.id);
		Log_Str(22, (o7_char *)" (expr.value # NIL) = ");
		Log_Bool(O7_REF(expr)->value_ != NULL);
		if (O7_REF(expr)->value_ != NULL) {
			Log_Str(17, (o7_char *)" expr.value.id = ");
			Log_Int(O7_REF(O7_REF(expr)->value_)->_._.id);
		}
		Log_Ln();
		if ((O7_REF(expr)->value_ != NULL) && (o7_cmp(O7_REF(O7_REF(expr)->value_)->_._.id, Ast_IdString_cnst) == 0)) {
			Expression_CString(&(*gen), O7_GUARD(Ast_ExprString_s, &O7_REF(expr)->value_));
		} else {
			Designator(&(*gen), O7_GUARD(Ast_Designator_s, &expr));
		}
		break;
	case 21:
		Expression_Relation(&(*gen), O7_GUARD(Ast_ExprRelation_s, &expr));
		break;
	case 22:
		if (o7_bl(O7_REF((*gen).opt)->checkArith) && (o7_in(O7_REF(O7_REF(expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdReal32_cnst)))) && (O7_REF(expr)->value_ == NULL)) {
			Expression_SumCheck(&(*gen), O7_GUARD(Ast_ExprSum_s, &expr));
		} else {
			Expression_Sum(&(*gen), O7_GUARD(Ast_ExprSum_s, &expr));
		}
		break;
	case 23:
		if (o7_bl(O7_REF((*gen).opt)->checkArith) && (o7_in(O7_REF(O7_REF(expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst) | (1u << Ast_IdReal_cnst) | (1u << Ast_IdReal32_cnst)))) && (O7_REF(expr)->value_ == NULL)) {
			Expression_TermCheck(&(*gen), O7_GUARD(Ast_ExprTerm_s, &expr));
		} else {
			Expression_Term(&(*gen), O7_GUARD(Ast_ExprTerm_s, &expr));
		}
		break;
	case 24:
		if (o7_in(O7_REF(O7_REF(expr)->type)->_._.id, ((1u << Ast_IdSet_cnst) | (1u << Ast_IdLongSet_cnst)))) {
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x7E");
			Expression(&(*gen), O7_GUARD(Ast_ExprNegate_s, &expr)->expr);
		} else {
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x21");
			CheckExpr(&(*gen), O7_GUARD(Ast_ExprNegate_s, &expr)->expr);
		}
		break;
	case 26:
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		Expression(&(*gen), O7_GUARD(Ast_ExprBraces_s, &expr)->expr);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
		break;
	case 9:
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"NULL");
		break;
	case 27:
		Expression_IsExtension(&(*gen), O7_GUARD(Ast_ExprIsExtension_s, &expr));
		break;
	default:
		o7_case_fail(O7_REF(expr)->_.id);
		break;
	}
}

static void Qualifier(struct GeneratorC_Generator *gen, struct Ast_RType *typ) {
	switch (O7_REF(typ)->_._.id) {
	case 0:
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"int");
		break;
	case 1:
		TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_long_t");
		break;
	case 7:
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"unsigned");
		break;
	case 8:
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)"o7_set64_t");
		break;
	case 2:
		if ((o7_cmp(O7_REF((*gen).opt)->std, GeneratorC_IsoC99_cnst) >= 0) && (o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) != 0)) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"bool");
		} else {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_bool");
		}
		break;
	case 3:
		TextGenerator_Str(&(*gen)._, 13, (o7_char *)"char unsigned");
		break;
	case 4:
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"o7_char");
		break;
	case 5:
		TextGenerator_Str(&(*gen)._, 6, (o7_char *)"double");
		break;
	case 6:
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)"float");
		break;
	case 9:
	case 13:
		GlobalName(&(*gen), &typ->_);
		break;
	default:
		o7_case_fail(O7_REF(typ)->_._.id);
		break;
	}
}

static void Invert(struct GeneratorC_Generator *gen) {
	O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)->invert = !o7_bl(O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)->invert);
}

static void ProcHead(struct GeneratorC_Generator *gen, struct Ast_RProcType *proc);
static void ProcHead_Parameters(struct GeneratorC_Generator *gen, struct Ast_RProcType *proc);
static void ProcHead_Parameters_Par(struct GeneratorC_Generator *gen, struct Ast_FormalParam_s *fp) {
	struct Ast_RType *t;
	int i;

	i = 0;
	t = O7_REF(fp)->_._.type;
	while ((o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) == 0) && (O7_GUARD(Ast_RArray, &t)->count == NULL)) {
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"int ");
		Name(&(*gen), &fp->_._);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
		TextGenerator_Int(&(*gen)._, i);
		TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		i = o7_add(i, 1);
		t = O7_REF(t)->_.type;
	}
	t = O7_REF(fp)->_._.type;
	declarator(&(*gen), &fp->_._, false, false, false);
	if ((o7_cmp(O7_REF(t)->_._.id, Ast_IdRecord_cnst) == 0) && (!o7_bl(O7_REF((*gen).opt)->skipUnusedTag) || Ast_IsNeedTag(fp))) {
		TextGenerator_Str(&(*gen)._, 11, (o7_char *)", o7_tag_t ");
		Name(&(*gen), &fp->_._);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_tag");
	}
}

static void ProcHead_Parameters(struct GeneratorC_Generator *gen, struct Ast_RProcType *proc) {
	struct Ast_RDeclaration *p;

	if (O7_REF(proc)->params == NULL) {
		TextGenerator_Str(&(*gen)._, 6, (o7_char *)"(void)");
	} else {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		p = (&(O7_REF(proc)->params)->_._);
		while (p != &O7_REF(proc)->end->_._) {
			ProcHead_Parameters_Par(&(*gen), O7_GUARD(Ast_FormalParam_s, &p));
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			p = O7_REF(p)->next;
		}
		ProcHead_Parameters_Par(&(*gen), O7_GUARD(Ast_FormalParam_s, &p));
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void ProcHead(struct GeneratorC_Generator *gen, struct Ast_RProcType *proc) {
	ProcHead_Parameters(&(*gen), proc);
	Invert(&(*gen));
	type(&(*gen), NULL, O7_REF(proc)->_._._.type, false, false);
	MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
}

static void Declarator(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, o7_bool typeDecl, o7_bool sameType, o7_bool global) {
	struct GeneratorC_Generator g;
	struct GeneratorC_MemoryOut *mo;
	GeneratorC_Generator_undef(&g);

	mo = PMemoryOutGet((*gen).opt);

	TextGenerator_Init(&g._, &mo->_);
	TextGenerator_SetTabs(&g._, &(*gen)._);
	g.module = (*gen).module;
	g.interface_ = o7_bl((*gen).interface_);
	g.opt = (*gen).opt;

	if ((o7_is(decl, Ast_FormalParam_s_tag)) && ((!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &decl)->access)) && !(o7_is(O7_REF(decl)->type, Ast_RArray_tag)) || (o7_is(O7_REF(decl)->type, Ast_Record_s_tag)))) {
		TextGenerator_Str(&g._, 1, (o7_char *)"\x2A");
	} else if (o7_is(decl, Ast_Const_s_tag)) {
		TextGenerator_Str(&g._, 6, (o7_char *)"const ");
	}
	if (global) {
		GlobalName(&g, decl);
	} else {
		Name(&g, decl);
	}
	if (o7_is(decl, Ast_RProcedure_tag)) {
		ProcHead(&g, O7_GUARD(Ast_RProcedure, &decl)->_.header);
	} else {
		O7_REF(mo)->invert = !o7_bl(O7_REF(mo)->invert);
		if (o7_is(decl, Ast_RType_tag)) {
			type(&g, decl, O7_GUARD(Ast_RType, &decl), typeDecl, false);
		} else {
			type(&g, decl, O7_REF(decl)->type, false, sameType);
		}
	}

	MemWriteDirect(&(*gen), &(*O7_REF(mo)));

	PMemoryOutBack((*gen).opt, mo);
}

static void RecordUndefHeader(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec, o7_bool interf) {
	if (o7_bl(O7_REF(rec)->_._._.mark) && !o7_bl(O7_REF((*gen).opt)->main_)) {
		TextGenerator_Str(&(*gen)._, 12, (o7_char *)"extern void ");
	} else {
		TextGenerator_Str(&(*gen)._, 12, (o7_char *)"static void ");
	}
	GlobalName(&(*gen), &rec->_._._);
	TextGenerator_Str(&(*gen)._, 14, (o7_char *)"_undef(struct ");
	GlobalName(&(*gen), &rec->_._._);
	if (interf) {
		TextGenerator_StrLn(&(*gen)._, 5, (o7_char *)" *r);");
	} else {
		TextGenerator_StrOpen(&(*gen)._, 6, (o7_char *)" *r) {");
	}
}

static o7_bool IsArrayTypeSimpleUndef(struct Ast_RType *typ, int *id, int *deep) {
	(*deep) = 0;
	while (o7_cmp(O7_REF(typ)->_._.id, Ast_IdArray_cnst) == 0) {
		(*deep) = o7_add((*deep), 1);
		typ = O7_REF(typ)->_.type;
	}
	(*id) = o7_int(O7_REF(typ)->_._.id);
	return o7_in((*id), ((1u << Ast_IdReal_cnst) | (1u << Ast_IdReal32_cnst) | (1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst) | (1u << Ast_IdBoolean_cnst)));
}

static void ArraySimpleUndef(struct GeneratorC_Generator *gen, int arrTypeId, struct Ast_RDeclaration *d, o7_bool inRec) {
	switch (arrTypeId) {
	case 0:
		TextGenerator_Str(&(*gen)._, 14, (o7_char *)"O7_INTS_UNDEF(");
		break;
	case 1:
		TextGenerator_Str(&(*gen)._, 15, (o7_char *)"O7_LONGS_UNDEF(");
		break;
	case 5:
		TextGenerator_Str(&(*gen)._, 17, (o7_char *)"O7_DOUBLES_UNDEF(");
		break;
	case 6:
		TextGenerator_Str(&(*gen)._, 16, (o7_char *)"O7_FLOATS_UNDEF(");
		break;
	case 2:
		TextGenerator_Str(&(*gen)._, 15, (o7_char *)"O7_BOOLS_UNDEF(");
		break;
	default:
		o7_case_fail(arrTypeId);
		break;
	}
	if (inRec) {
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"r->");
	}
	Name(&(*gen), d);
	TextGenerator_Str(&(*gen)._, 2, (o7_char *)");");
}

static void RecordUndefCall(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *var_) {
	GlobalName(&(*gen), &O7_REF(var_)->type->_);
	TextGenerator_Str(&(*gen)._, 8, (o7_char *)"_undef(&");
	GlobalName(&(*gen), var_);
	TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
}

static struct Ast_RType *TypeForUndef(struct Ast_RType *t) {
	if ((o7_cmp(O7_REF(t)->_._.id, Ast_IdRecord_cnst) != 0) || (O7_REF(t)->_._.ext == NULL) || !o7_bl(O7_GUARD(RecExt_s, &O7_REF(t)->_._.ext)->undef)) {
		t = NULL;
	}
	return t;
}

static void RecordUndef(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec);
static void RecordUndef_IteratorIfNeed(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *var_) {
	int id, deep;

	while ((var_ != NULL) && ((o7_cmp(O7_REF(O7_REF(var_)->type)->_._.id, Ast_IdArray_cnst) != 0) || IsArrayTypeSimpleUndef(O7_REF(var_)->type, &id, &deep) || (TypeForUndef(O7_REF(O7_REF(var_)->type)->_.type) == NULL))) {
		var_ = O7_REF(var_)->next;
	}
	if (var_ != NULL) {
		TextGenerator_StrLn(&(*gen)._, 11, (o7_char *)"o7_int_t i;");
	}
}

static void RecordUndef_Memset(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *var_) {
	TextGenerator_Str(&(*gen)._, 11, (o7_char *)"memset(&r->");
	Name(&(*gen), var_);
	TextGenerator_Str(&(*gen)._, 15, (o7_char *)", 0, sizeof(r->");
	Name(&(*gen), var_);
	TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)"));");
}

static void RecordUndef(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec) {
	struct Ast_RDeclaration *var_;
	int arrTypeId, arrDeep;
	struct Ast_RType *typeUndef;

	RecordUndefHeader(&(*gen), rec, false);
	RecordUndef_IteratorIfNeed(&(*gen), &O7_REF(rec)->vars->_);
	if (O7_REF(rec)->base != NULL) {
		GlobalName(&(*gen), &O7_REF(rec)->base->_._._);
		if (!o7_bl(O7_REF((*gen).opt)->plan9)) {
			TextGenerator_StrLn(&(*gen)._, 14, (o7_char *)"_undef(&r->_);");
		} else {
			TextGenerator_StrLn(&(*gen)._, 10, (o7_char *)"_undef(r);");
		}
	}
	O7_GUARD(RecExt_s, &O7_REF(rec)->_._._._.ext)->undef = true;
	var_ = (&(O7_REF(rec)->vars)->_);
	while (var_ != NULL) {
		if (!(o7_in(O7_REF(O7_REF(var_)->type)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdRecord_cnst))))) {
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)"r->");
			Name(&(*gen), var_);
			VarInit(&(*gen), var_, true);
			TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
		} else if (o7_cmp(O7_REF(O7_REF(var_)->type)->_._.id, Ast_IdArray_cnst) == 0) {
			typeUndef = TypeForUndef(O7_REF(O7_REF(var_)->type)->_.type);
			if (IsArrayTypeSimpleUndef(O7_REF(var_)->type, &arrTypeId, &arrDeep)) {
				ArraySimpleUndef(&(*gen), arrTypeId, var_, true);
			} else if (typeUndef != NULL) {
				TextGenerator_Str(&(*gen)._, 26, (o7_char *)"for (i = 0; i < O7_LEN(r->");
				Name(&(*gen), var_);
				TextGenerator_StrOpen(&(*gen)._, 12, (o7_char *)"); i += 1) {");
				GlobalName(&(*gen), &typeUndef->_);
				TextGenerator_Str(&(*gen)._, 10, (o7_char *)"_undef(r->");
				Name(&(*gen), var_);
				TextGenerator_StrLn(&(*gen)._, 6, (o7_char *)" + i);");

				TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
			} else {
				RecordUndef_Memset(&(*gen), var_);
			}
		} else if ((o7_cmp(O7_REF(O7_REF(var_)->type)->_._.id, Ast_IdRecord_cnst) == 0) && (O7_REF(O7_REF(var_)->type)->_._.ext != NULL)) {
			GlobalName(&(*gen), &O7_REF(var_)->type->_);
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)"_undef(&r->");
			Name(&(*gen), var_);
			TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
		} else {
			RecordUndef_Memset(&(*gen), var_);
		}
		var_ = O7_REF(var_)->next;
	}
	TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
}

static void EmptyLines(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *d) {
	if (o7_cmp(O7_REF(d)->_.emptyLines, 0) > 0) {
		TextGenerator_Ln(&(*gen)._);
	}
}

static void Type(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, struct Ast_RType *typ, o7_bool typeDecl, o7_bool sameType);
static void Type_Simple(struct GeneratorC_Generator *gen, int str_len0, o7_char str[/*len0*/]) {
	TextGenerator_Str(&(*gen)._, str_len0, str);
	MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
}

static void Type_Record(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec) {
	struct Ast_RDeclaration *v;

	O7_REF(rec)->_._._.module = (*gen).module;
	TextGenerator_Str(&(*gen)._, 7, (o7_char *)"struct ");
	if (CheckStructName(&(*gen), rec)) {
		GlobalName(&(*gen), &rec->_._._);
	}
	v = (&(O7_REF(rec)->vars)->_);
	if ((v == NULL) && (O7_REF(rec)->base == NULL) && !o7_bl(O7_REF((*gen).opt)->gnu)) {
		TextGenerator_Str(&(*gen)._, 18, (o7_char *)" { int nothing; } ");
	} else {
		TextGenerator_StrOpen(&(*gen)._, 2, (o7_char *)" {");

		if (O7_REF(rec)->base != NULL) {
			GlobalName(&(*gen), &O7_REF(rec)->base->_._._);
			if (o7_bl(O7_REF((*gen).opt)->plan9)) {
				TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
			} else {
				TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)" _;");
			}
		}

		while (v != NULL) {
			EmptyLines(&(*gen), v);
			Declarator(&(*gen), v, false, false, false);
			TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
			v = O7_REF(v)->next;
		}
		TextGenerator_StrClose(&(*gen)._, 2, (o7_char *)"} ");
	}
	MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
}

static void Type_Array(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, struct Ast_RArray *arr, o7_bool sameType) {
	struct Ast_RType *t;
	int i;

	t = O7_REF(arr)->_._._.type;
	MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
	if (O7_REF(arr)->count != NULL) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5B");
		Expression(&(*gen), O7_REF(arr)->count);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x5D");
	} else if (o7_bl(O7_REF((*gen).opt)->vla)) {
		i = 0;
		t = (&(arr)->_._);
		do {
			TextGenerator_Data(&(*gen)._, 8, (o7_char *)"[O7_VLA(", 0, o7_add(1, o7_mul((int)o7_bl(O7_REF((*gen).opt)->vlaMark), 8)));
			Name(&(*gen), decl);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"_len");
			TextGenerator_Int(&(*gen)._, i);
			TextGenerator_Data(&(*gen)._, 2, (o7_char *)")]", (int)!o7_bl(O7_REF((*gen).opt)->vlaMark), o7_sub(2, (int)!o7_bl(O7_REF((*gen).opt)->vlaMark)));
			t = O7_REF(t)->_.type;
			i = o7_add(i, 1);
		} while (!(o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) != 0));
	} else {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"[/*len0");
		i = 0;
		while (o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) == 0) {
			i = o7_add(i, 1);
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)", len");
			TextGenerator_Int(&(*gen)._, i);
			t = O7_REF(t)->_.type;
		}
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"*/]");
	}
	Invert(&(*gen));
	Type(&(*gen), decl, t, false, sameType);
}

static void Type(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *decl, struct Ast_RType *typ, o7_bool typeDecl, o7_bool sameType) {
	if (typ == NULL) {
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)"void ");
		MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
	} else {
		if (!typeDecl && StringStore_IsDefined(&O7_REF(typ)->_.name)) {
			if (sameType) {
				if ((o7_is(typ, Ast_RPointer_tag)) && StringStore_IsDefined(&O7_REF(O7_REF(typ)->_.type)->_.name)) {
					TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x2A");
				}
			} else {
				if ((o7_is(typ, Ast_RPointer_tag)) && StringStore_IsDefined(&O7_REF(O7_REF(typ)->_.type)->_.name)) {
					TextGenerator_Str(&(*gen)._, 7, (o7_char *)"struct ");
					GlobalName(&(*gen), &O7_REF(typ)->_.type->_);
					TextGenerator_Str(&(*gen)._, 2, (o7_char *)" *");
				} else if (o7_is(typ, Ast_Record_s_tag)) {
					TextGenerator_Str(&(*gen)._, 7, (o7_char *)"struct ");
					if (CheckStructName(&(*gen), O7_GUARD(Ast_Record_s, &typ))) {
						GlobalName(&(*gen), &typ->_);
						TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x20");
					}
				} else {
					GlobalName(&(*gen), &typ->_);
					TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x20");
				}
				if (o7_is((*gen)._.out, GeneratorC_MemoryOut_tag)) {
					MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
				}
			}
		} else if (!sameType || (o7_in(O7_REF(typ)->_._.id, ((1u << Ast_IdPointer_cnst) | (1u << Ast_IdArray_cnst) | (1u << Ast_IdProcType_cnst))))) {
			switch (O7_REF(typ)->_._.id) {
			case 0:
				Type_Simple(&(*gen), 4, (o7_char *)"int ");
				break;
			case 1:
				Type_Simple(&(*gen), 10, (o7_char *)"o7_long_t ");
				break;
			case 7:
				Type_Simple(&(*gen), 9, (o7_char *)"unsigned ");
				break;
			case 8:
				Type_Simple(&(*gen), 11, (o7_char *)"o7_set64_t ");
				break;
			case 2:
				if ((o7_cmp(O7_REF((*gen).opt)->std, GeneratorC_IsoC99_cnst) >= 0) && (o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) != 0)) {
					Type_Simple(&(*gen), 5, (o7_char *)"bool ");
				} else {
					Type_Simple(&(*gen), 8, (o7_char *)"o7_bool ");
				}
				break;
			case 3:
				Type_Simple(&(*gen), 14, (o7_char *)"char unsigned ");
				break;
			case 4:
				Type_Simple(&(*gen), 8, (o7_char *)"o7_char ");
				break;
			case 5:
				Type_Simple(&(*gen), 7, (o7_char *)"double ");
				break;
			case 6:
				Type_Simple(&(*gen), 6, (o7_char *)"float ");
				break;
			case 9:
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x2A");
				MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
				Invert(&(*gen));
				Type(&(*gen), decl, O7_REF(typ)->_.type, false, sameType);
				break;
			case 10:
				Type_Array(&(*gen), decl, O7_GUARD(Ast_RArray, &typ), sameType);
				break;
			case 11:
				Type_Record(&(*gen), O7_GUARD(Ast_Record_s, &typ));
				break;
			case 13:
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)"(*");
				MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
				ProcHead(&(*gen), O7_GUARD(Ast_RProcType, &typ));
				break;
			default:
				o7_case_fail(O7_REF(typ)->_._.id);
				break;
			}
		}
		if (o7_is((*gen)._.out, GeneratorC_MemoryOut_tag)) {
			MemWriteInvert(&(*O7_GUARD(GeneratorC_MemoryOut, &(*gen)._.out)));
		}
	}
}

static void RecordTag(struct GeneratorC_Generator *gen, struct Ast_Record_s *rec) {
	if (O7_REF(rec)->base == NULL) {
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"#define ");
		GlobalName(&(*gen), &rec->_._._);
		TextGenerator_StrLn(&(*gen)._, 16, (o7_char *)"_tag o7_base_tag");
	} else if (!o7_bl(O7_REF(rec)->needTag) && o7_bl(O7_REF((*gen).opt)->skipUnusedTag)) {
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"#define ");
		GlobalName(&(*gen), &rec->_._._);
		TextGenerator_Str(&(*gen)._, 5, (o7_char *)"_tag ");
		GlobalName(&(*gen), &O7_REF(rec)->base->_._._);
		TextGenerator_StrLn(&(*gen)._, 4, (o7_char *)"_tag");
	} else {
		if (!o7_bl(O7_REF(rec)->_._._.mark) || o7_bl(O7_REF((*gen).opt)->main_)) {
			TextGenerator_Str(&(*gen)._, 16, (o7_char *)"static o7_tag_t ");
		} else if (o7_bl((*gen).interface_)) {
			TextGenerator_Str(&(*gen)._, 16, (o7_char *)"extern o7_tag_t ");
		} else {
			TextGenerator_Str(&(*gen)._, 9, (o7_char *)"o7_tag_t ");
		}
		GlobalName(&(*gen), &rec->_._._);
		TextGenerator_StrLn(&(*gen)._, 5, (o7_char *)"_tag;");
	}
	if (!o7_bl(O7_REF(rec)->_._._.mark) || o7_bl(O7_REF((*gen).opt)->main_) || o7_bl((*gen).interface_)) {
		TextGenerator_Ln(&(*gen)._);
	}
}

static void TypeDecl(struct MOut *out, struct Ast_RType *typ);
static void TypeDecl_Typedef(struct GeneratorC_Generator *gen, struct Ast_RType *typ) {
	EmptyLines(&(*gen), &typ->_);
	TextGenerator_Str(&(*gen)._, 8, (o7_char *)"typedef ");
	Declarator(&(*gen), &typ->_, true, false, true);
	TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
}

static void TypeDecl_LinkRecord(struct GeneratorC_Options_s *opt, struct Ast_Record_s *rec) {
	struct RecExt_s *ext;

	O7_ASSERT(O7_REF(rec)->_._._._.ext == NULL);
	O7_NEW(&ext, RecExt_s);
	V_Init(&(*O7_REF(ext))._);
	StringStore_Undef(&O7_REF(ext)->anonName);
	O7_REF(ext)->next = NULL;
	O7_REF(ext)->undef = false;
	O7_REF(rec)->_._._._.ext = (&(ext)->_);

	if (O7_REF(opt)->records == NULL) {
		O7_REF(opt)->records = rec;
	} else {
		O7_GUARD(RecExt_s, &O7_REF(O7_REF(opt)->recordLast)->_._._._.ext)->next = rec;
	}
	O7_REF(opt)->recordLast = rec;
}

static void TypeDecl(struct MOut *out, struct Ast_RType *typ) {
	TypeDecl_Typedef(&(*out).g[o7_ind(2, (int)(o7_bl(O7_REF(typ)->_.mark) && !o7_bl(O7_REF((*out).opt)->main_)))], typ);
	if ((o7_cmp(O7_REF(typ)->_._.id, Ast_IdRecord_cnst) == 0) || (o7_cmp(O7_REF(typ)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(O7_REF(typ)->_.type)->_.next == NULL)) {
		if (o7_cmp(O7_REF(typ)->_._.id, Ast_IdPointer_cnst) == 0) {
			typ = O7_REF(typ)->_.type;
		}
		O7_REF(typ)->_.mark = o7_bl(O7_REF(typ)->_.mark) || (O7_GUARD(Ast_Record_s, &typ)->pointer != NULL) && (O7_REF(O7_GUARD(Ast_Record_s, &typ)->pointer)->_._._.mark);
		TypeDecl_LinkRecord((*out).opt, O7_GUARD(Ast_Record_s, &typ));
		if (o7_bl(O7_REF(typ)->_.mark) && !o7_bl(O7_REF((*out).opt)->main_)) {
			RecordTag(&(*out).g[Interface_cnst], O7_GUARD(Ast_Record_s, &typ));
			if (o7_cmp(O7_REF((*out).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) {
				RecordUndefHeader(&(*out).g[Interface_cnst], O7_GUARD(Ast_Record_s, &typ), true);
			}
		}
		if ((!o7_bl(O7_REF(typ)->_.mark) || o7_bl(O7_REF((*out).opt)->main_)) || (O7_GUARD(Ast_Record_s, &typ)->base != NULL) || !o7_bl(O7_GUARD(Ast_Record_s, &typ)->needTag)) {
			RecordTag(&(*out).g[Implementation_cnst], O7_GUARD(Ast_Record_s, &typ));
		}
		if (o7_cmp(O7_REF((*out).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) {
			RecordUndef(&(*out).g[Implementation_cnst], O7_GUARD(Ast_Record_s, &typ));
		}
	}
}

static void Mark(struct GeneratorC_Generator *gen, o7_bool mark) {
	if (o7_cmp((*gen).localDeep, 0) == 0) {
		if (mark && !o7_bl(O7_REF((*gen).opt)->main_)) {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"extern ");
		} else {
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"static ");
		}
	}
}

static void Comment(struct GeneratorC_Generator *gen, struct StringStore_String *com) {
	struct StringStore_Iterator i;
	o7_char prev;
	StringStore_Iterator_undef(&i);

	if (o7_bl(O7_REF((*gen).opt)->comment) && StringStore_GetIter(&i, &(*com), 0)) {
		do {
			prev = i.char_;
		} while (!(!StringStore_IterNext(&i) || (prev == (o7_char)'/') && (i.char_ == (o7_char)'*') || (prev == (o7_char)'*') && (i.char_ == (o7_char)'/')));

		if (i.char_ == 0x00u) {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"/*");
			TextGenerator_String(&(*gen)._, &(*com));
			TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)"*/");
		}
	}
}

static void Const(struct GeneratorC_Generator *gen, struct Ast_Const_s *const_) {
	Comment(&(*gen), &O7_REF(const_)->_._.comment);
	EmptyLines(&(*gen), &const_->_);
	TextGenerator_StrIgnoreIndent(&(*gen)._, 1, (o7_char *)"\x23");
	TextGenerator_Str(&(*gen)._, 7, (o7_char *)"define ");
	GlobalName(&(*gen), &const_->_);
	TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x20");
	if (o7_bl(O7_REF(const_)->_.mark) && (O7_REF(const_)->expr != NULL)) {
		Factor(&(*gen), &O7_REF(O7_REF(const_)->expr)->value_->_);
	} else {
		Factor(&(*gen), O7_REF(const_)->expr);
	}
	TextGenerator_Ln(&(*gen)._);
}

static void Var(struct MOut *out, struct Ast_RDeclaration *prev, struct Ast_RDeclaration *var_, o7_bool last) {
	o7_bool same, mark;

	mark = o7_bl(O7_REF(var_)->mark) && !o7_bl(O7_REF((*out).opt)->main_);
	Comment(&(*out).g[o7_ind(2, (int)o7_bl(mark))], &O7_REF(var_)->_.comment);
	EmptyLines(&(*out).g[o7_ind(2, (int)o7_bl(mark))], var_);
	same = (prev != NULL) && (O7_REF(prev)->mark == mark) && (O7_REF(prev)->type == O7_REF(var_)->type);
	if (!same) {
		if (prev != NULL) {
			TextGenerator_StrLn(&(*out).g[o7_ind(2, (int)o7_bl(mark))]._, 1, (o7_char *)"\x3B");
		}
		Mark(&(*out).g[o7_ind(2, (int)o7_bl(mark))], mark);
	} else {
		TextGenerator_Str(&(*out).g[o7_ind(2, (int)o7_bl(mark))]._, 2, (o7_char *)", ");
	}
	if (mark) {
		Declarator(&(*out).g[Interface_cnst], var_, false, same, true);
		if (last) {
			TextGenerator_StrLn(&(*out).g[Interface_cnst]._, 1, (o7_char *)"\x3B");
		}

		if (same) {
			TextGenerator_Str(&(*out).g[Implementation_cnst]._, 2, (o7_char *)", ");
		} else if (prev != NULL) {
			TextGenerator_StrLn(&(*out).g[Implementation_cnst]._, 1, (o7_char *)"\x3B");
		}
	}

	Declarator(&(*out).g[Implementation_cnst], var_, false, same, true);

	VarInit(&(*out).g[Implementation_cnst], var_, false);

	if (last) {
		TextGenerator_StrLn(&(*out).g[Implementation_cnst]._, 1, (o7_char *)"\x3B");
	}
}

static void ExprThenStats(struct GeneratorC_Generator *gen, struct Ast_RWhileIf **wi) {
	CheckExpr(&(*gen), O7_REF((*wi))->_.expr);
	TextGenerator_StrOpen(&(*gen)._, 3, (o7_char *)") {");
	statements(&(*gen), O7_REF((*wi))->stats);
	(*wi) = O7_REF((*wi))->elsif;
}

static o7_bool IsCaseElementWithRange(struct Ast_CaseElement_s *elem) {
	struct Ast_CaseLabel_s *r;

	r = O7_REF(elem)->labels;
	while ((r != NULL) && (O7_REF(r)->right == NULL)) {
		r = O7_REF(r)->next;
	}
	return r != NULL;
}

static void ExprSameType(struct GeneratorC_Generator *gen, struct Ast_RExpression *expr, struct Ast_RType *expectType) {
	o7_bool reref, brace;
	struct Ast_Record_s *base, *extend = NULL;

	base = NULL;
	reref = (o7_cmp(O7_REF(O7_REF(expr)->type)->_._.id, Ast_IdPointer_cnst) == 0) && (O7_REF(O7_REF(expr)->type)->_.type != O7_REF(expectType)->_.type) && (o7_cmp(O7_REF(expr)->_.id, Ast_IdPointer_cnst) != 0);
	brace = reref;
	if (!reref) {
		CheckExpr(&(*gen), expr);
		if (o7_cmp(O7_REF(O7_REF(expr)->type)->_._.id, Ast_IdRecord_cnst) == 0) {
			base = O7_GUARD(Ast_Record_s, &expectType);
			extend = O7_GUARD(Ast_Record_s, &O7_REF(expr)->type);
		}
	} else if (o7_bl(O7_REF((*gen).opt)->plan9)) {
		CheckExpr(&(*gen), expr);
		brace = false;
	} else {
		base = O7_GUARD(Ast_Record_s, &O7_REF(expectType)->_.type);
		extend = O7_GUARD(Ast_Record_s, &O7_REF(O7_REF(expr)->type)->_.type)->base;
		TextGenerator_Str(&(*gen)._, 3, (o7_char *)"(&(");
		Expression(&(*gen), expr);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)")->_");
	}
	if ((base != NULL) && (extend != base)) {
		if (o7_bl(O7_REF((*gen).opt)->plan9)) {
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x2E");
			GlobalName(&(*gen), &expectType->_);
		} else {
			while (extend != base) {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)"._");
				extend = O7_REF(extend)->base;
			}
		}
	}
	if (brace) {
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
	}
}

static void ExprForSize(struct GeneratorC_Generator *gen, struct Ast_RExpression *e) {
	(*gen).insideSizeOf = true;
	Expression(&(*gen), e);
	(*gen).insideSizeOf = false;
}

static void Statement(struct GeneratorC_Generator *gen, struct Ast_RStatement *st);
static void Statement_WhileIf(struct GeneratorC_Generator *gen, struct Ast_RWhileIf *wi);
static void Statement_WhileIf_Elsif(struct GeneratorC_Generator *gen, struct Ast_RWhileIf **wi) {
	while (((*wi) != NULL) && (O7_REF((*wi))->_.expr != NULL)) {
		TextGenerator_StrClose(&(*gen)._, 11, (o7_char *)"} else if (");
		ExprThenStats(&(*gen), &(*wi));
	}
}

static void Statement_WhileIf(struct GeneratorC_Generator *gen, struct Ast_RWhileIf *wi) {
	if (o7_is(wi, Ast_If_s_tag)) {
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)"if (");
		ExprThenStats(&(*gen), &wi);
		Statement_WhileIf_Elsif(&(*gen), &wi);
		if (wi != NULL) {
			TextGenerator_IndentClose(&(*gen)._);
			TextGenerator_StrOpen(&(*gen)._, 8, (o7_char *)"} else {");
			statements(&(*gen), O7_REF(wi)->stats);
		}
		TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
	} else if (O7_REF(wi)->elsif == NULL) {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"while (");
		ExprThenStats(&(*gen), &wi);
		TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
	} else {
		TextGenerator_Str(&(*gen)._, 14, (o7_char *)"while (1) if (");
		ExprThenStats(&(*gen), &wi);
		Statement_WhileIf_Elsif(&(*gen), &wi);
		TextGenerator_StrLnClose(&(*gen)._, 13, (o7_char *)"} else break;");
	}
}

static void Statement_Repeat(struct GeneratorC_Generator *gen, struct Ast_Repeat_s *st) {
	TextGenerator_StrOpen(&(*gen)._, 4, (o7_char *)"do {");
	statements(&(*gen), O7_REF(st)->stats);
	if (o7_cmp(O7_REF(O7_REF(st)->_.expr)->_.id, Ast_IdNegate_cnst) == 0) {
		TextGenerator_StrClose(&(*gen)._, 9, (o7_char *)"} while (");
		Expression(&(*gen), O7_GUARD(Ast_ExprNegate_s, &O7_REF(st)->_.expr)->expr);
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
	} else {
		TextGenerator_StrClose(&(*gen)._, 11, (o7_char *)"} while (!(");
		CheckExpr(&(*gen), O7_REF(st)->_.expr);
		TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)"));");
	}
}

static void Statement_For(struct GeneratorC_Generator *gen, struct Ast_For_s *st);
static o7_bool Statement_For_IsEndMinus1(struct Ast_ExprSum_s *sum) {
	return (O7_REF(sum)->next != NULL) && (O7_REF(O7_REF(sum)->next)->next == NULL) && (o7_cmp(O7_REF(O7_REF(sum)->next)->add, Scanner_Minus_cnst) == 0) && (O7_REF(O7_REF(O7_REF(sum)->next)->term)->value_ != NULL) && (o7_cmp(O7_GUARD(Ast_RExprInteger, &O7_REF(O7_REF(O7_REF(sum)->next)->term)->value_)->int_, 1) == 0);
}

static void Statement_For(struct GeneratorC_Generator *gen, struct Ast_For_s *st) {
	TextGenerator_Str(&(*gen)._, 5, (o7_char *)"for (");
	GlobalName(&(*gen), &O7_REF(st)->var_->_);
	TextGenerator_Str(&(*gen)._, 3, (o7_char *)" = ");
	Expression(&(*gen), O7_REF(st)->_.expr);
	TextGenerator_Str(&(*gen)._, 2, (o7_char *)"; ");
	GlobalName(&(*gen), &O7_REF(st)->var_->_);
	if (o7_cmp(O7_REF(st)->by, 0) > 0) {
		if ((o7_is(O7_REF(st)->to, Ast_ExprSum_s_tag)) && Statement_For_IsEndMinus1(O7_GUARD(Ast_ExprSum_s, &O7_REF(st)->to))) {
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)" < ");
			Expression(&(*gen), O7_GUARD(Ast_ExprSum_s, &O7_REF(st)->to)->term);
		} else {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" <= ");
			Expression(&(*gen), O7_REF(st)->to);
		}
		if (o7_cmp(O7_REF(st)->by, 1) == 0) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"; ++");
			GlobalName(&(*gen), &O7_REF(st)->var_->_);
		} else {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"; ");
			GlobalName(&(*gen), &O7_REF(st)->var_->_);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" += ");
			TextGenerator_Int(&(*gen)._, O7_REF(st)->by);
		}
	} else {
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" >= ");
		Expression(&(*gen), O7_REF(st)->to);
		if (o7_cmp(O7_REF(st)->by,  - 1) == 0) {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"; --");
			GlobalName(&(*gen), &O7_REF(st)->var_->_);
		} else {
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)"; ");
			GlobalName(&(*gen), &O7_REF(st)->var_->_);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" -= ");
			TextGenerator_Int(&(*gen)._, o7_sub(0, O7_REF(st)->by));
		}
	}
	TextGenerator_StrOpen(&(*gen)._, 3, (o7_char *)") {");
	statements(&(*gen), O7_REF(st)->stats);
	TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
}

static void Statement_Assign(struct GeneratorC_Generator *gen, struct Ast_Assign_s *st);
static void Statement_Assign_AssertArraySize(struct GeneratorC_Generator *gen, struct Ast_Designator_s *des, struct Ast_RExpression *e) {
	if (o7_bl(O7_REF((*gen).opt)->checkIndex) && ((O7_GUARD(Ast_RArray, &O7_REF(des)->_._.type)->count == NULL) || (O7_GUARD(Ast_RArray, &O7_REF(e)->type)->count == NULL))) {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"assert(");
		ArrayLen(&(*gen), &des->_._);
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" >= ");
		ArrayLen(&(*gen), e);
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
	}
}

static void Statement_Assign(struct GeneratorC_Generator *gen, struct Ast_Assign_s *st) {
	o7_bool retain, toByte;

	toByte = (o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdByte_cnst) == 0) && (o7_in(O7_REF(O7_REF(O7_REF(st)->_.expr)->type)->_._.id, ((1u << Ast_IdInteger_cnst) | (1u << Ast_IdLongInt_cnst)))) && o7_bl(O7_REF((*gen).opt)->checkArith) && (O7_REF(O7_REF(st)->_.expr)->value_ == NULL);
	retain = (o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdPointer_cnst) == 0) && (o7_cmp(O7_REF((*gen).opt)->memManager, GeneratorC_MemManagerCounter_cnst) == 0);
	if (retain && (o7_cmp(O7_REF(O7_REF(st)->_.expr)->_.id, Ast_IdPointer_cnst) == 0)) {
		TextGenerator_Str(&(*gen)._, 9, (o7_char *)"O7_NULL(&");
		Designator(&(*gen), O7_REF(st)->designator);
	} else {
		if (retain) {
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)"O7_ASSIGN(&");
			Designator(&(*gen), O7_REF(st)->designator);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
		} else if ((o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdArray_cnst) == 0)) {
			Statement_Assign_AssertArraySize(&(*gen), O7_REF(st)->designator, O7_REF(st)->_.expr);
			TextGenerator_Str(&(*gen)._, 7, (o7_char *)"memcpy(");
			Designator(&(*gen), O7_REF(st)->designator);
			TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
			O7_REF((*gen).opt)->expectArray = true;
		} else if (toByte) {
			Designator(&(*gen), O7_REF(st)->designator);
			if (o7_cmp(O7_REF(O7_REF(O7_REF(st)->_.expr)->type)->_._.id, Ast_IdInteger_cnst) == 0) {
				TextGenerator_Str(&(*gen)._, 11, (o7_char *)" = o7_byte(");
			} else {
				TextGenerator_Str(&(*gen)._, 12, (o7_char *)" = o7_lbyte(");
			}
		} else {
			Designator(&(*gen), O7_REF(st)->designator);
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)" = ");
		}
		ExprSameType(&(*gen), O7_REF(st)->_.expr, O7_REF(O7_REF(st)->designator)->_._.type);
		O7_REF((*gen).opt)->expectArray = false;
		if (o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdArray_cnst) != 0) {
		} else if ((O7_GUARD(Ast_RArray, &O7_REF(O7_REF(st)->_.expr)->type)->count != NULL) && !Ast_IsFormalParam(O7_REF(st)->_.expr)) {
			if ((o7_is(O7_REF(st)->_.expr, Ast_ExprString_s_tag)) && o7_bl(O7_GUARD(Ast_ExprString_s, &O7_REF(st)->_.expr)->asChar)) {
				TextGenerator_Str(&(*gen)._, 2, (o7_char *)", ");
				ArrayLen(&(*gen), O7_REF(st)->_.expr);
			} else {
				TextGenerator_Str(&(*gen)._, 9, (o7_char *)", sizeof(");
				ExprForSize(&(*gen), O7_REF(st)->_.expr);
				TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
			}
		} else {
			TextGenerator_Str(&(*gen)._, 3, (o7_char *)", (");
			ArrayLen(&(*gen), O7_REF(st)->_.expr);
			TextGenerator_Str(&(*gen)._, 11, (o7_char *)") * sizeof(");
			ExprForSize(&(*gen), O7_REF(st)->_.expr);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)"[0])");
		}
	}
	switch (o7_add(o7_add((int)o7_bl(retain), (int)o7_bl(toByte)), (int)((o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdArray_cnst) == 0) && (o7_cmp(O7_REF(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_.type)->_._.id, Ast_IdString_cnst) != 0)))) {
	case 0:
		TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
		break;
	case 1:
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
		break;
	case 2:
		TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)"));");
		break;
	default:
		o7_case_fail(o7_add(o7_add((int)o7_bl(retain), (int)o7_bl(toByte)), (int)((o7_cmp(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_._.id, Ast_IdArray_cnst) == 0) && (o7_cmp(O7_REF(O7_REF(O7_REF(O7_REF(st)->designator)->_._.type)->_.type)->_._.id, Ast_IdString_cnst) != 0))));
		break;
	}
}

static void Statement_Case(struct GeneratorC_Generator *gen, struct Ast_Case_s *st);
static void Statement_Case_CaseElement(struct GeneratorC_Generator *gen, struct Ast_CaseElement_s *elem) {
	struct Ast_CaseLabel_s *r;

	if (o7_bl(O7_REF((*gen).opt)->gnu) || !IsCaseElementWithRange(elem)) {
		r = O7_REF(elem)->labels;
		while (r != NULL) {
			TextGenerator_Str(&(*gen)._, 5, (o7_char *)"case ");
			TextGenerator_Int(&(*gen)._, O7_REF(r)->value_);
			if (O7_REF(r)->right != NULL) {
				O7_ASSERT(o7_bl(O7_REF((*gen).opt)->gnu));
				TextGenerator_Str(&(*gen)._, 5, (o7_char *)" ... ");
				TextGenerator_Int(&(*gen)._, O7_REF(O7_REF(r)->right)->value_);
			}
			TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3A");

			r = O7_REF(r)->next;
		}
		TextGenerator_IndentOpen(&(*gen)._);
		statements(&(*gen), O7_REF(elem)->stats);
		TextGenerator_StrLn(&(*gen)._, 6, (o7_char *)"break;");
		TextGenerator_IndentClose(&(*gen)._);
	}
}

static void Statement_Case_CaseElementAsIf(struct GeneratorC_Generator *gen, struct Ast_CaseElement_s *elem, struct Ast_RExpression *caseExpr);
static void Statement_Case_CaseElementAsIf_CaseRange(struct GeneratorC_Generator *gen, struct Ast_CaseLabel_s *r, struct Ast_RExpression *caseExpr) {
	if (O7_REF(r)->right == NULL) {
		if (caseExpr == NULL) {
			TextGenerator_Str(&(*gen)._, 17, (o7_char *)"(o7_case_expr == ");
		} else {
			TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
			Expression(&(*gen), caseExpr);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" == ");
		}
		TextGenerator_Int(&(*gen)._, O7_REF(r)->value_);
	} else {
		O7_ASSERT(o7_cmp(O7_REF(r)->value_, O7_REF(O7_REF(r)->right)->value_) <= 0);
		TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x28");
		TextGenerator_Int(&(*gen)._, O7_REF(r)->value_);
		if (caseExpr == NULL) {
			TextGenerator_Str(&(*gen)._, 36, (o7_char *)" <= o7_case_expr && o7_case_expr <= ");
		} else {
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" <= ");
			Expression(&(*gen), caseExpr);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" && ");
			Expression(&(*gen), caseExpr);
			TextGenerator_Str(&(*gen)._, 4, (o7_char *)" <= ");
		}
		TextGenerator_Int(&(*gen)._, O7_REF(O7_REF(r)->right)->value_);
	}
	TextGenerator_Str(&(*gen)._, 1, (o7_char *)"\x29");
}

static void Statement_Case_CaseElementAsIf(struct GeneratorC_Generator *gen, struct Ast_CaseElement_s *elem, struct Ast_RExpression *caseExpr) {
	struct Ast_CaseLabel_s *r;

	TextGenerator_Str(&(*gen)._, 4, (o7_char *)"if (");
	r = O7_REF(elem)->labels;
	O7_ASSERT(r != NULL);
	Statement_Case_CaseElementAsIf_CaseRange(&(*gen), r, caseExpr);
	while (O7_REF(r)->next != NULL) {
		r = O7_REF(r)->next;
		TextGenerator_Str(&(*gen)._, 4, (o7_char *)" || ");
		Statement_Case_CaseElementAsIf_CaseRange(&(*gen), r, caseExpr);
	}
	TextGenerator_StrOpen(&(*gen)._, 3, (o7_char *)") {");
	statements(&(*gen), O7_REF(elem)->stats);
	TextGenerator_StrClose(&(*gen)._, 1, (o7_char *)"\x7D");
}

static void Statement_Case(struct GeneratorC_Generator *gen, struct Ast_Case_s *st) {
	struct Ast_CaseElement_s *elem, *elemWithRange;
	struct Ast_RExpression *caseExpr;

	if (o7_bl(O7_REF((*gen).opt)->gnu)) {
		elemWithRange = NULL;
	} else {
		elemWithRange = O7_REF(st)->elements;
		while ((elemWithRange != NULL) && !IsCaseElementWithRange(elemWithRange)) {
			elemWithRange = O7_REF(elemWithRange)->next;
		}
	}
	if ((elemWithRange != NULL) && (O7_REF(O7_REF(st)->_.expr)->value_ == NULL) && (!(o7_is(O7_REF(st)->_.expr, Ast_Designator_s_tag)) || (O7_GUARD(Ast_Designator_s, &O7_REF(st)->_.expr)->sel != NULL))) {
		caseExpr = NULL;
		TextGenerator_Str(&(*gen)._, 21, (o7_char *)"{ int o7_case_expr = ");
		Expression(&(*gen), O7_REF(st)->_.expr);
		TextGenerator_StrOpen(&(*gen)._, 1, (o7_char *)"\x3B");
		TextGenerator_StrLn(&(*gen)._, 23, (o7_char *)"switch (o7_case_expr) {");
	} else {
		caseExpr = O7_REF(st)->_.expr;
		TextGenerator_Str(&(*gen)._, 8, (o7_char *)"switch (");
		Expression(&(*gen), caseExpr);
		TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)") {");
	}
	elem = O7_REF(st)->elements;
	do {
		Statement_Case_CaseElement(&(*gen), elem);
		elem = O7_REF(elem)->next;
	} while (!(elem == NULL));
	TextGenerator_StrOpen(&(*gen)._, 8, (o7_char *)"default:");
	if (elemWithRange != NULL) {
		elem = elemWithRange;
		Statement_Case_CaseElementAsIf(&(*gen), elem, caseExpr);
		elem = O7_REF(elem)->next;
		while (elem != NULL) {
			if (IsCaseElementWithRange(elem)) {
				TextGenerator_Str(&(*gen)._, 6, (o7_char *)" else ");
				Statement_Case_CaseElementAsIf(&(*gen), elem, caseExpr);
			}
			elem = O7_REF(elem)->next;
		}
		if (!o7_bl(O7_REF((*gen).opt)->caseAbort)) {
		} else if (caseExpr == NULL) {
			TextGenerator_StrLn(&(*gen)._, 33, (o7_char *)" else o7_case_fail(o7_case_expr);");
		} else {
			TextGenerator_Str(&(*gen)._, 19, (o7_char *)" else o7_case_fail(");
			Expression(&(*gen), caseExpr);
			TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
		}
	} else if (!o7_bl(O7_REF((*gen).opt)->caseAbort)) {
	} else if (caseExpr == NULL) {
		TextGenerator_StrLn(&(*gen)._, 27, (o7_char *)"o7_case_fail(o7_case_expr);");
	} else {
		TextGenerator_Str(&(*gen)._, 13, (o7_char *)"o7_case_fail(");
		Expression(&(*gen), caseExpr);
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
	}
	TextGenerator_StrLn(&(*gen)._, 6, (o7_char *)"break;");
	TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
	if (caseExpr == NULL) {
		TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
	}
}

static void Statement(struct GeneratorC_Generator *gen, struct Ast_RStatement *st) {
	Comment(&(*gen), &O7_REF(st)->_.comment);
	if (o7_cmp(O7_REF(st)->_.emptyLines, 0) > 0) {
		TextGenerator_Ln(&(*gen)._);
	}
	if (o7_is(st, Ast_Assign_s_tag)) {
		Statement_Assign(&(*gen), O7_GUARD(Ast_Assign_s, &st));
	} else if (o7_is(st, Ast_Call_s_tag)) {
		(*gen).expressionSemicolon = true;
		Expression(&(*gen), O7_REF(st)->expr);
		if (o7_bl((*gen).expressionSemicolon)) {
			TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
		} else {
			TextGenerator_Ln(&(*gen)._);
		}
	} else if (o7_is(st, Ast_RWhileIf_tag)) {
		Statement_WhileIf(&(*gen), O7_GUARD(Ast_RWhileIf, &st));
	} else if (o7_is(st, Ast_Repeat_s_tag)) {
		Statement_Repeat(&(*gen), O7_GUARD(Ast_Repeat_s, &st));
	} else if (o7_is(st, Ast_For_s_tag)) {
		Statement_For(&(*gen), O7_GUARD(Ast_For_s, &st));
	} else {
		O7_ASSERT(o7_is(st, Ast_Case_s_tag));
		Statement_Case(&(*gen), O7_GUARD(Ast_Case_s, &st));
	}
}

static void Statements(struct GeneratorC_Generator *gen, struct Ast_RStatement *stats) {
	while (stats != NULL) {
		Statement(&(*gen), stats);
		stats = O7_REF(stats)->next;
	}
}

static void ProcDecl(struct GeneratorC_Generator *gen, struct Ast_RProcedure *proc) {
	if (o7_bl(O7_REF(proc)->_._._.mark) && !o7_bl(O7_REF((*gen).opt)->main_)) {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"extern ");
	} else {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"static ");
	}
	Declarator(&(*gen), &proc->_._._, false, false, true);
	TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
}

static void Procedure(struct MOut *out, struct Ast_RProcedure *proc);
static void Procedure_Implement(struct MOut *out, struct GeneratorC_Generator *gen, struct Ast_RProcedure *proc);
static void Procedure_Implement_CloseConsts(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *consts) {
	while ((consts != NULL) && (o7_is(consts, Ast_Const_s_tag))) {
		TextGenerator_StrIgnoreIndent(&(*gen)._, 1, (o7_char *)"\x23");
		TextGenerator_Str(&(*gen)._, 6, (o7_char *)"undef ");
		Name(&(*gen), consts);
		TextGenerator_Ln(&(*gen)._);
		consts = O7_REF(consts)->next;
	}
}

static struct Ast_RDeclaration *Procedure_Implement_SearchRetain(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *fp) {
	while ((fp != NULL) && ((o7_cmp(O7_REF(O7_REF(fp)->type)->_._.id, Ast_IdPointer_cnst) != 0) || (!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &fp)->access)))) {
		fp = O7_REF(fp)->next;
	}
	return fp;
}

static void Procedure_Implement_RetainParams(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *fp) {
	if (fp != NULL) {
		TextGenerator_Str(&(*gen)._, 10, (o7_char *)"o7_retain(");
		Name(&(*gen), fp);
		fp = O7_REF(fp)->next;
		while (fp != NULL) {
			if ((o7_cmp(O7_REF(O7_REF(fp)->type)->_._.id, Ast_IdPointer_cnst) == 0) && !(!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &fp)->access))) {
				TextGenerator_Str(&(*gen)._, 13, (o7_char *)"); o7_retain(");
				Name(&(*gen), fp);
			}
			fp = O7_REF(fp)->next;
		}
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
	}
}

static void Procedure_Implement_ReleaseParams(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *fp) {
	if (fp != NULL) {
		TextGenerator_Str(&(*gen)._, 11, (o7_char *)"o7_release(");
		Name(&(*gen), fp);
		fp = O7_REF(fp)->next;
		while (fp != NULL) {
			if ((o7_cmp(O7_REF(O7_REF(fp)->type)->_._.id, Ast_IdPointer_cnst) == 0) && !(!!( (1u << Ast_ParamOut_cnst) & O7_GUARD(Ast_FormalParam_s, &fp)->access))) {
				TextGenerator_Str(&(*gen)._, 14, (o7_char *)"); o7_release(");
				Name(&(*gen), fp);
			}
			fp = O7_REF(fp)->next;
		}
		TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
	}
}

static void Procedure_Implement_ReleaseVars(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *var_) {
	o7_bool first;

	if (o7_cmp(O7_REF((*gen).opt)->memManager, GeneratorC_MemManagerCounter_cnst) == 0) {
		first = true;
		while ((var_ != NULL) && (o7_is(var_, Ast_RVar_tag))) {
			if (o7_cmp(O7_REF(O7_REF(var_)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
				if (first) {
					first = false;
					TextGenerator_Str(&(*gen)._, 11, (o7_char *)"o7_release(");
				} else {
					TextGenerator_Str(&(*gen)._, 14, (o7_char *)"); o7_release(");
				}
				Name(&(*gen), var_);
			}
			var_ = O7_REF(var_)->next;
		}
		if (!first) {
			TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
		}
	}
}

static void Procedure_Implement(struct MOut *out, struct GeneratorC_Generator *gen, struct Ast_RProcedure *proc) {
	struct Ast_RDeclaration *retainParams;

	Comment(&(*gen), &O7_REF(proc)->_._._._.comment);
	Mark(&(*gen), O7_REF(proc)->_._._.mark);
	Declarator(&(*gen), &proc->_._._, false, false, true);
	TextGenerator_StrOpen(&(*gen)._, 2, (o7_char *)" {");

	(*gen).localDeep = o7_add((*gen).localDeep, 1);

	(*gen).fixedLen = o7_int((*gen)._.len);

	if (o7_cmp(O7_REF((*gen).opt)->memManager, GeneratorC_MemManagerCounter_cnst) != 0) {
		retainParams = NULL;
	} else {
		retainParams = Procedure_Implement_SearchRetain(&(*gen), &O7_REF(O7_REF(proc)->_.header)->params->_._);
		if (O7_REF(proc)->_.return_ != NULL) {
			Qualifier(&(*gen), O7_REF(O7_REF(proc)->_.return_)->type);
			if (o7_cmp(O7_REF(O7_REF(O7_REF(proc)->_.return_)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
				TextGenerator_StrLn(&(*gen)._, 18, (o7_char *)" o7_return = NULL;");
			} else {
				TextGenerator_StrLn(&(*gen)._, 11, (o7_char *)" o7_return;");
			}
		}
	}
	declarations(&(*out), &proc->_._);

	Procedure_Implement_RetainParams(&(*gen), retainParams);

	Statements(&(*gen), O7_REF(proc)->_._.stats);

	if (O7_REF(proc)->_.return_ == NULL) {
		Procedure_Implement_ReleaseVars(&(*gen), &O7_REF(proc)->_._.vars->_);
		Procedure_Implement_ReleaseParams(&(*gen), retainParams);
	} else if (o7_cmp(O7_REF((*gen).opt)->memManager, GeneratorC_MemManagerCounter_cnst) == 0) {
		if (o7_cmp(O7_REF(O7_REF(O7_REF(proc)->_.return_)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
			TextGenerator_Str(&(*gen)._, 22, (o7_char *)"O7_ASSIGN(&o7_return, ");
			Expression(&(*gen), O7_REF(proc)->_.return_);
			TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)");");
		} else {
			TextGenerator_Str(&(*gen)._, 12, (o7_char *)"o7_return = ");
			CheckExpr(&(*gen), O7_REF(proc)->_.return_);
			TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
		}
		Procedure_Implement_ReleaseVars(&(*gen), &O7_REF(proc)->_._.vars->_);
		Procedure_Implement_ReleaseParams(&(*gen), retainParams);
		if (o7_cmp(O7_REF(O7_REF(O7_REF(proc)->_.return_)->type)->_._.id, Ast_IdPointer_cnst) == 0) {
			TextGenerator_StrLn(&(*gen)._, 21, (o7_char *)"o7_unhold(o7_return);");
		}
		TextGenerator_StrLn(&(*gen)._, 17, (o7_char *)"return o7_return;");
	} else {
		TextGenerator_Str(&(*gen)._, 7, (o7_char *)"return ");
		ExprSameType(&(*gen), O7_REF(proc)->_.return_, O7_REF(O7_REF(proc)->_.header)->_._._.type);
		TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x3B");
	}

	(*gen).localDeep = o7_sub((*gen).localDeep, 1);
	Procedure_Implement_CloseConsts(&(*gen), O7_REF(proc)->_._.start);
	TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
	TextGenerator_Ln(&(*gen)._);
}

static void Procedure_LocalProcs(struct MOut *out, struct Ast_RProcedure *proc) {
	struct Ast_RDeclaration *p, *t;

	t = (&(O7_REF(proc)->_._.types)->_);
	while ((t != NULL) && (o7_is(t, Ast_RType_tag))) {
		TypeDecl(&(*out), O7_GUARD(Ast_RType, &t));
		t = O7_REF(t)->next;
	}
	p = (&(O7_REF(proc)->_._.procedures)->_._._);
	if ((p != NULL) && !o7_bl(O7_REF((*out).opt)->procLocal)) {
		if (!o7_bl(O7_REF(proc)->_._._.mark)) {
			ProcDecl(&(*out).g[Implementation_cnst], proc);
		}
		do {
			Procedure(&(*out), O7_GUARD(Ast_RProcedure, &p));
			p = O7_REF(p)->next;
		} while (!(p == NULL));
	}
}

static void Procedure(struct MOut *out, struct Ast_RProcedure *proc) {
	Procedure_LocalProcs(&(*out), proc);
	if (o7_bl(O7_REF(proc)->_._._.mark) && !o7_bl(O7_REF((*out).opt)->main_)) {
		ProcDecl(&(*out).g[Interface_cnst], proc);
	}
	Procedure_Implement(&(*out), &(*out).g[Implementation_cnst], proc);
}

static void LnIfWrote(struct MOut *out);
static void LnIfWrote_Write(struct GeneratorC_Generator *gen) {
	if (o7_cmp((*gen).fixedLen, (*gen)._.len) != 0) {
		TextGenerator_Ln(&(*gen)._);
		(*gen).fixedLen = o7_int((*gen)._.len);
	}
}

static void LnIfWrote(struct MOut *out) {
	if (!o7_bl(O7_REF((*out).opt)->main_)) {
		LnIfWrote_Write(&(*out).g[Interface_cnst]);
	}
	LnIfWrote_Write(&(*out).g[Implementation_cnst]);
}

static void VarsInit(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *d) {
	int arrDeep, arrTypeId = O7_INT_UNDEF;

	while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
		if (o7_in(O7_REF(O7_REF(d)->type)->_._.id, ((1u << Ast_IdArray_cnst) | (1u << Ast_IdRecord_cnst)))) {
			if ((o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) && (O7_REF(O7_REF(d)->type)->_._.ext != NULL)) {
				RecordUndefCall(&(*gen), d);
			} else if ((o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitZero_cnst) == 0) || (o7_cmp(O7_REF(O7_REF(d)->type)->_._.id, Ast_IdRecord_cnst) == 0) || (o7_cmp(O7_REF(O7_REF(d)->type)->_._.id, Ast_IdArray_cnst) == 0) && !IsArrayTypeSimpleUndef(O7_REF(d)->type, &arrTypeId, &arrDeep)) {
				TextGenerator_Str(&(*gen)._, 8, (o7_char *)"memset(&");
				Name(&(*gen), d);
				TextGenerator_Str(&(*gen)._, 12, (o7_char *)", 0, sizeof(");
				Name(&(*gen), d);
				TextGenerator_StrLn(&(*gen)._, 3, (o7_char *)"));");
			} else {
				O7_ASSERT(o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0);
				ArraySimpleUndef(&(*gen), arrTypeId, d, false);
			}
		}
		d = O7_REF(d)->next;
	}
}

static void Declarations(struct MOut *out, struct Ast_RDeclarations *ds) {
	struct Ast_RDeclaration *d, *prev;

	d = O7_REF(ds)->start;
	O7_ASSERT((d == NULL) || !(o7_is(d, Ast_RModule_tag)));
	while ((d != NULL) && (o7_is(d, Ast_Import_s_tag))) {
		Import(&(*out).g[o7_ind(2, (int)!o7_bl(O7_REF((*out).opt)->main_))], d);
		d = O7_REF(d)->next;
	}
	LnIfWrote(&(*out));

	while ((d != NULL) && (o7_is(d, Ast_Const_s_tag))) {
		Const(&(*out).g[o7_ind(2, (int)(o7_bl(O7_REF(d)->mark) && !o7_bl(O7_REF((*out).opt)->main_)))], O7_GUARD(Ast_Const_s, &d));
		d = O7_REF(d)->next;
	}
	LnIfWrote(&(*out));

	if (o7_is(ds, Ast_RModule_tag)) {
		while ((d != NULL) && (o7_is(d, Ast_RType_tag))) {
			TypeDecl(&(*out), O7_GUARD(Ast_RType, &d));
			d = O7_REF(d)->next;
		}
		LnIfWrote(&(*out));

		while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
			Var(&(*out), NULL, d, true);
			d = O7_REF(d)->next;
		}
	} else {
		d = (&(O7_REF(ds)->vars)->_);

		prev = NULL;
		while ((d != NULL) && (o7_is(d, Ast_RVar_tag))) {
			Var(&(*out), prev, d, (O7_REF(d)->next == NULL) || !(o7_is(O7_REF(d)->next, Ast_RVar_tag)));
			prev = d;
			d = O7_REF(d)->next;
		}
		if (o7_cmp(O7_REF((*out).opt)->varInit, GeneratorC_VarInitNo_cnst) != 0) {
			VarsInit(&(*out).g[Implementation_cnst], &O7_REF(ds)->vars->_);
		}

		d = (&(O7_REF(ds)->procedures)->_._._);
	}
	LnIfWrote(&(*out));

	if (o7_bl(O7_REF((*out).opt)->procLocal) || (o7_is(ds, Ast_RModule_tag))) {
		while (d != NULL) {
			Procedure(&(*out), O7_GUARD(Ast_RProcedure, &d));
			d = O7_REF(d)->next;
		}
	}
}

extern struct GeneratorC_Options_s *GeneratorC_DefaultOptions(void) {
	struct GeneratorC_Options_s *o;

	O7_NEW(&o, GeneratorC_Options_s);
	if (o != NULL) {
		V_Init(&(*O7_REF(o))._);

		O7_REF(o)->std = GeneratorC_IsoC90_cnst;
		O7_REF(o)->gnu = false;
		O7_REF(o)->plan9 = false;
		O7_REF(o)->procLocal = false;
		O7_REF(o)->checkIndex = true;
		O7_REF(o)->vla = false && (o7_cmp(O7_REF(o)->std, GeneratorC_IsoC99_cnst) >= 0);
		O7_REF(o)->vlaMark = true;
		O7_REF(o)->checkArith = true;
		O7_REF(o)->caseAbort = true;
		O7_REF(o)->checkNil = true;
		O7_REF(o)->o7Assert = true;
		O7_REF(o)->skipUnusedTag = true;
		O7_REF(o)->comment = true;
		O7_REF(o)->generatorNote = true;
		O7_REF(o)->varInit = GeneratorC_VarInitUndefined_cnst;
		O7_REF(o)->memManager = GeneratorC_MemManagerNoFree_cnst;

		O7_REF(o)->expectArray = false;

		O7_REF(o)->main_ = false;

		O7_REF(o)->memOuts = NULL;
	}
	return o;
}

static void MarkExpression(struct Ast_RExpression *e) {
	if (e != NULL) {
		if (o7_cmp(O7_REF(e)->_.id, Ast_IdRelation_cnst) == 0) {
			MarkExpression(O7_GUARD(Ast_ExprRelation_s, &e)->exprs[0]);
			MarkExpression(O7_GUARD(Ast_ExprRelation_s, &e)->exprs[1]);
		} else if (o7_cmp(O7_REF(e)->_.id, Ast_IdTerm_cnst) == 0) {
			MarkExpression(&O7_GUARD(Ast_ExprTerm_s, &e)->factor->_);
			MarkExpression(O7_GUARD(Ast_ExprTerm_s, &e)->expr);
		} else if (o7_cmp(O7_REF(e)->_.id, Ast_IdSum_cnst) == 0) {
			MarkExpression(O7_GUARD(Ast_ExprSum_s, &e)->term);
			MarkExpression(&O7_GUARD(Ast_ExprSum_s, &e)->next->_);
		} else if ((o7_cmp(O7_REF(e)->_.id, Ast_IdDesignator_cnst) == 0) && !o7_bl(O7_REF(O7_GUARD(Ast_Designator_s, &e)->decl)->mark)) {
			O7_REF(O7_GUARD(Ast_Designator_s, &e)->decl)->mark = true;
			MarkExpression(O7_GUARD(Ast_Const_s, &O7_GUARD(Ast_Designator_s, &e)->decl)->expr);
		}
	}
}

static void MarkType(struct Ast_RType *t) {
	struct Ast_RDeclaration *d;

	while ((t != NULL) && !o7_bl(O7_REF(t)->_.mark)) {
		O7_REF(t)->_.mark = true;
		if (o7_cmp(O7_REF(t)->_._.id, Ast_IdArray_cnst) == 0) {
			MarkExpression(O7_GUARD(Ast_RArray, &t)->count);
			t = O7_REF(t)->_.type;
		} else if (o7_in(O7_REF(t)->_._.id, ((1u << Ast_IdRecord_cnst) | (1u << Ast_IdPointer_cnst)))) {
			if (o7_cmp(O7_REF(t)->_._.id, Ast_IdPointer_cnst) == 0) {
				t = O7_REF(t)->_.type;
				O7_REF(t)->_.mark = true;
				O7_ASSERT(O7_REF(t)->_.module != NULL);
			}
			d = (&(O7_GUARD(Ast_Record_s, &t)->vars)->_);
			while (d != NULL) {
				MarkType(O7_REF(d)->type);
				d = O7_REF(d)->next;
			}
			t = (&(O7_GUARD(Ast_Record_s, &t)->base)->_._);
		} else {
			t = NULL;
		}
	}
}

static void MarkUsedInMarked(struct Ast_RModule *m);
static void MarkUsedInMarked_Consts(struct Ast_RDeclaration *c) {
	while ((c != NULL) && (o7_is(c, Ast_Const_s_tag))) {
		if (o7_bl(O7_REF(c)->mark)) {
			MarkExpression(O7_GUARD(Ast_Const_s, &c)->expr);
		}
		c = O7_REF(c)->next;
	}
}

static void MarkUsedInMarked_Types(struct Ast_RDeclaration *t) {
	while ((t != NULL) && (o7_is(t, Ast_RType_tag))) {
		if (o7_bl(O7_REF(t)->mark)) {
			O7_REF(t)->mark = false;
			MarkType(O7_GUARD(Ast_RType, &t));
		}
		t = O7_REF(t)->next;
	}
}

static void MarkUsedInMarked_Procs(struct Ast_RDeclaration *p) {
	struct Ast_RDeclaration *fp;

	while ((p != NULL) && (o7_is(p, Ast_RProcedure_tag))) {
		if (o7_bl(O7_REF(p)->mark)) {
			fp = (&(O7_REF(O7_GUARD(Ast_RProcedure, &p)->_.header)->params)->_._);
			while (fp != NULL) {
				MarkType(O7_REF(fp)->type);
				fp = O7_REF(fp)->next;
			}
		}
		p = O7_REF(p)->next;
	}
}

static void MarkUsedInMarked(struct Ast_RModule *m) {
	struct Ast_RDeclaration *imp;

	imp = (&(O7_REF(m)->import_)->_);
	while ((imp != NULL) && (o7_is(imp, Ast_Import_s_tag))) {
		MarkUsedInMarked(O7_REF(imp)->module);
		imp = O7_REF(imp)->next;
	}
	MarkUsedInMarked_Consts(&O7_REF(m)->_.consts->_);
	MarkUsedInMarked_Types(&O7_REF(m)->_.types->_);
	MarkUsedInMarked_Procs(&O7_REF(m)->_.procedures->_._._);
}

static void ImportInit(struct GeneratorC_Generator *gen, struct Ast_RDeclaration *imp) {
	if (imp != NULL) {
		O7_ASSERT(o7_is(imp, Ast_Import_s_tag));

		do {
			Name(&(*gen), &O7_REF(imp)->module->_._);
			TextGenerator_StrLn(&(*gen)._, 8, (o7_char *)"_init();");

			imp = O7_REF(imp)->next;
		} while (!((imp == NULL) || !(o7_is(imp, Ast_Import_s_tag))));
		TextGenerator_Ln(&(*gen)._);
	}
}

static void TagsInit(struct GeneratorC_Generator *gen) {
	struct Ast_Record_s *r;

	r = NULL;
	while (O7_REF((*gen).opt)->records != NULL) {
		r = O7_REF((*gen).opt)->records;
		O7_REF((*gen).opt)->records = O7_GUARD(RecExt_s, &O7_REF(r)->_._._._.ext)->next;
		O7_GUARD(RecExt_s, &O7_REF(r)->_._._._.ext)->next = NULL;

		if ((O7_REF(r)->base != NULL) && (o7_bl(O7_REF(r)->needTag) || !o7_bl(O7_REF((*gen).opt)->skipUnusedTag))) {
			TextGenerator_Str(&(*gen)._, 12, (o7_char *)"o7_tag_init(");
			GlobalName(&(*gen), &r->_._._);
			TextGenerator_Str(&(*gen)._, 6, (o7_char *)"_tag, ");
			GlobalName(&(*gen), &O7_REF(r)->base->_._._);
			TextGenerator_StrLn(&(*gen)._, 6, (o7_char *)"_tag);");
		}
	}
	if (r != NULL) {
		TextGenerator_Ln(&(*gen)._);
	}
}

static void Generate_Init(struct GeneratorC_Generator *gen, struct VDataStream_Out *out, struct Ast_RModule *module, struct GeneratorC_Options_s *opt, o7_bool interface_) {
	TextGenerator_Init(&(*gen)._, out);
	(*gen).module = module;
	(*gen).localDeep = 0;

	(*gen).opt = opt;

	(*gen).fixedLen = o7_int((*gen)._.len);

	(*gen).interface_ = interface_;

	(*gen).insideSizeOf = false;
}

static void Generate_Includes(struct GeneratorC_Generator *gen) {
	if (o7_cmp(O7_REF((*gen).opt)->std, GeneratorC_IsoC99_cnst) >= 0) {
		TextGenerator_StrLn(&(*gen)._, 20, (o7_char *)"#include <stdbool.h>");
	}
	TextGenerator_Ln(&(*gen)._);
	if (o7_cmp(O7_REF((*gen).opt)->varInit, GeneratorC_VarInitUndefined_cnst) == 0) {
		TextGenerator_StrLn(&(*gen)._, 25, (o7_char *)"#define O7_BOOL_UNDEFINED");
	}
	TextGenerator_StrLn(&(*gen)._, 15, (o7_char *)"#include <o7.h>");
	TextGenerator_Ln(&(*gen)._);
}

static void Generate_HeaderGuard(struct GeneratorC_Generator *gen) {
	TextGenerator_Str(&(*gen)._, 26, (o7_char *)"#if !defined(HEADER_GUARD_");
	TextGenerator_String(&(*gen)._, &O7_REF((*gen).module)->_._.name);
	TextGenerator_StrLn(&(*gen)._, 1, (o7_char *)"\x29");
	TextGenerator_Str(&(*gen)._, 21, (o7_char *)"#define HEADER_GUARD_");
	TextGenerator_String(&(*gen)._, &O7_REF((*gen).module)->_._.name);
	TextGenerator_StrLn(&(*gen)._, 2, (o7_char *)" 1");
	TextGenerator_Ln(&(*gen)._);
}

static void Generate_ModuleInit(struct GeneratorC_Generator *interf, struct GeneratorC_Generator *impl, struct Ast_RModule *module) {
	if ((O7_REF(module)->import_ == NULL) && (O7_REF(module)->_.stats == NULL) && (O7_REF((*impl).opt)->records == NULL)) {
		if (o7_cmp(O7_REF((*impl).opt)->std, GeneratorC_IsoC99_cnst) >= 0) {
			TextGenerator_Str(&(*interf)._, 19, (o7_char *)"static inline void ");
		} else {
			TextGenerator_Str(&(*interf)._, 15, (o7_char *)"O7_INLINE void ");
		}
		Name(&(*interf), &module->_._);
		TextGenerator_StrLn(&(*interf)._, 17, (o7_char *)"_init(void) { ; }");
	} else {
		TextGenerator_Str(&(*interf)._, 12, (o7_char *)"extern void ");
		Name(&(*interf), &module->_._);
		TextGenerator_StrLn(&(*interf)._, 12, (o7_char *)"_init(void);");

		TextGenerator_Str(&(*impl)._, 12, (o7_char *)"extern void ");
		Name(&(*impl), &module->_._);
		TextGenerator_StrOpen(&(*impl)._, 13, (o7_char *)"_init(void) {");
		TextGenerator_StrLn(&(*impl)._, 27, (o7_char *)"static int initialized = 0;");
		TextGenerator_StrOpen(&(*impl)._, 23, (o7_char *)"if (0 == initialized) {");
		ImportInit(&(*impl), &O7_REF(module)->import_->_);
		TagsInit(&(*impl));
		Statements(&(*impl), O7_REF(module)->_.stats);
		TextGenerator_StrLnClose(&(*impl)._, 1, (o7_char *)"\x7D");
		TextGenerator_StrLn(&(*impl)._, 14, (o7_char *)"++initialized;");
		TextGenerator_StrLnClose(&(*impl)._, 1, (o7_char *)"\x7D");
		TextGenerator_Ln(&(*impl)._);
	}
}

static void Generate_Main(struct GeneratorC_Generator *gen, struct Ast_RModule *module, struct Ast_RStatement *cmd) {
	TextGenerator_StrOpen(&(*gen)._, 41, (o7_char *)"extern int main(int argc, char *argv[]) {");
	TextGenerator_StrLn(&(*gen)._, 20, (o7_char *)"o7_init(argc, argv);");
	ImportInit(&(*gen), &O7_REF(module)->import_->_);
	TagsInit(&(*gen));
	if (O7_REF(module)->_.stats != NULL) {
		Statements(&(*gen), O7_REF(module)->_.stats);
	}
	while (cmd != NULL) {
		Statement(&(*gen), cmd);
		cmd = O7_REF(cmd)->next;
	}
	TextGenerator_StrLn(&(*gen)._, 20, (o7_char *)"return o7_exit_code;");
	TextGenerator_StrLnClose(&(*gen)._, 1, (o7_char *)"\x7D");
}

static void Generate_GeneratorNotify(struct GeneratorC_Generator *gen) {
	if (o7_bl(O7_REF((*gen).opt)->generatorNote)) {
		TextGenerator_StrLn(&(*gen)._, 48, (o7_char *)"/* Generated by Vostok - Oberon-07 translator */");
		TextGenerator_Ln(&(*gen)._);
	}
}

extern void GeneratorC_Generate(struct VDataStream_Out *interface_, struct VDataStream_Out *implementation, struct Ast_RModule *module, struct Ast_RStatement *cmd, struct GeneratorC_Options_s *opt) {
	struct MOut out;
	MOut_undef(&out);

	O7_ASSERT(!Ast_HasError(module));

	if (opt == NULL) {
		opt = GeneratorC_DefaultOptions();
	}
	out.opt = opt;

	O7_REF(opt)->records = NULL;
	O7_REF(opt)->recordLast = NULL;
	O7_REF(opt)->index = 0;

	O7_REF(opt)->main_ = interface_ == NULL;

	if (!o7_bl(O7_REF(opt)->main_)) {
		MarkUsedInMarked(module);
	}

	if (interface_ != NULL) {
		Generate_Init(&out.g[Interface_cnst], interface_, module, opt, true);
		Generate_GeneratorNotify(&out.g[Interface_cnst]);
	}

	Generate_Init(&out.g[Implementation_cnst], implementation, module, opt, false);
	Generate_GeneratorNotify(&out.g[Implementation_cnst]);

	Comment(&out.g[o7_ind(2, (int)!o7_bl(O7_REF(opt)->main_))], &O7_REF(module)->_._._.comment);

	Generate_Includes(&out.g[Implementation_cnst]);

	if (!o7_bl(O7_REF(opt)->main_)) {
		Generate_HeaderGuard(&out.g[Interface_cnst]);
		Import(&out.g[Implementation_cnst], &module->_._);
	}

	Declarations(&out, &module->_);

	if (o7_bl(O7_REF(opt)->main_)) {
		Generate_Main(&out.g[Implementation_cnst], module, cmd);
	} else {
		Generate_ModuleInit(&out.g[Interface_cnst], &out.g[Implementation_cnst], module);
		TextGenerator_StrLn(&out.g[Interface_cnst]._, 6, (o7_char *)"#endif");
	}
}

extern void GeneratorC_init(void) {
	static int initialized = 0;
	if (0 == initialized) {
		Ast_init();
		StringStore_init();
		Scanner_init();
		TextGenerator_init();
		Log_init();

		o7_tag_init(GeneratorC_MemoryOut_tag, VDataStream_Out_tag);
		o7_tag_init(RecExt_s_tag, V_Base_tag);

		type = Type;
		declarator = Declarator;
		declarations = Declarations;
		statements = Statements;
		expression = Expression;
	}
	++initialized;
}

