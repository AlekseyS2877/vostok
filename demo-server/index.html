<!DOCTYPE html>
<html lang="en">
<head>
<title>Vostok translator</title>
<style type="text/css" media="screen">
  #editor {
    width: 600px;
    height: 600px;
    font-size: 14px;
    float: left;
  }
  #log {
    width: 600px;
    height: 600px;
    overflow: auto;
    float:right;
    background-color: #EEEEEE;
  }
</style>
</head>

<body>

<div style='width:1200px'>
  <div id='editor'>MODULE Hello;

 IMPORT Out;

 PROCEDURE Come*;
 BEGIN
   Out.String("Добро пожаловать."); Out.Ln
 END Come;

 PROCEDURE Gone*;
 BEGIN
   Out.String("До скорой встречи."); Out.Ln
 END Gone;

END Hello.
</div>

  <div id='log'></div>

</div>

<div id='runners'></div>

<div>
  <input type='text' id='script' value='Hello.Come'/>
  <button onclick='requestRun(script.value)'>Run</button>
  <button onclick='addRunner()'>Add</button>
</div>

<script src="https://ajaxorg.github.io/ace-builds/src-min-noconflict/ace.js"
        type="text/javascript" charset="utf-8">
</script>

<script>
  var editor, session, script, runners, mlog;

  script  = document.getElementById('script');
  runners = document.getElementById('runners');
  mlog = document.getElementById('log');

  editor = ace.edit('editor');
  editor.setDisplayIndentGuides(true);
  session = editor.getSession();
  session.setOptions({ tabSize: 2, useSoftTabs: true, navigateWithinSoftTabs: true});

  function requestRun(scr) {
    var req, data, pre;
    req = new XMLHttpRequest();
    req.onreadystatechange = function() {
      if (req.readyState == XMLHttpRequest.DONE && req.status == 200) {
        pre = document.createElement("pre");
        pre.innerText = req.responseText;
        mlog.appendChild(pre);
        pre.scrollIntoView();
      }
    }
    req.open("POST", "/run");
    data = new FormData();
    data.append("module", session.getValue());
    data.append("script", scr);
    req.send(data);
  }

  function addRunner() {
    var div, inp, run, del;
    div = document.createElement('div');
    inp = document.createElement('input', 'type="text"');
    inp.value = script.value;
    run = document.createElement('button');
    run.innerText = 'Run';
    run.onclick = function() {
      requestRun(inp.value);
    }
    del = document.createElement('button');
    del.innerText = 'Del';
    del.onclick = function() {
      runners.removeChild(div);
    }

    div.appendChild(inp);
    div.appendChild(run);
    div.appendChild(del);

    runners.appendChild(div);
  }
</script>

</body>
</html>
